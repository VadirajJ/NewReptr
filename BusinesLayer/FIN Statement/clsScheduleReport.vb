
Public Class clsScheduleReport
    Private objDBL As New DatabaseLayer.DBHelper
    Dim objGen As New clsGRACeGeneral
    Private objclsGeneralFunctions As New clsGeneralFunctions
    Private objclsUSEntry As New clsUploadStockEntry
    Public sPandLAmount As String
    Dim sSession As New AllSession
    Private objclsGRACeGeneral As New clsGRACeGeneral


    'Public Function loadTrainlbalancedata(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iCompanyTypeid As Integer) As DataTable
    '    Dim sSql As String : Dim dt, dtdetails As New DataTable
    '    Dim dr As DataRow
    '    Dim totalSh As Decimal = 0
    '    Dim totali As Decimal = 0
    '    Dim tempSheadingid1 As Integer = 0
    '    Dim tempSheadingid2 As Integer = 0
    '    Dim tempItemid1 As Integer = 0
    '    Dim tempItemid2 As Integer = 0
    '    Dim dtheading As New DataTable
    '    Dim dtItemsheading As DataTable
    '    Try
    '        dt.Columns.Add("ID")
    '        dt.Columns.Add("Headingname")
    '        dt.Columns.Add("HeaderSLNo")
    '        'sSql = "select  distinct(ATBUD_Headingid) as ID,c.ASH_Name as Heading_name from Acc_TrailBalance_Upload_Details"
    '        'sSql = sSql & " left join ACC_ScheduleHeading c on c.ASH_ID = ATBUD_Headingid"
    '        'sSql = sSql & " where ATBUD_Headingid<>0 or ATBUD_Subheading<>0 or ATBUD_itemid<>0"
    '        'sSql = sSql & " And ATBUD_CustId= " & ICustid & " and ATBUD_SChedule_Type= " & iSchedulrTypeIdd & " and ATBUD_Company_Type= " & iCompanyTypeid & ""
    '        'dtdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        sSql = "select ATBUD_ID,ATBUD_Headingid,c.ASH_Name as Heading_name,ATBUD_Subheading,d.ASSH_Name as Subheading_name,ATBUD_itemid,e.ASI_Name as Item_name,Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_Opening_Credit_Amount+ATBU_Opening_Debit_Amount+ATBU_TR_Credit_Amount+ATBU_TR_Debit_Amount) as Total from Acc_TrailBalance_Upload_Details"
    '        sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID = ATBUD_Masid"
    '        sSql = sSql & " left join ACC_ScheduleHeading c on c.ASH_ID = ATBUD_Headingid"
    '        sSql = sSql & " left join ACC_ScheduleSubHeading d on d.ASSH_ID=ATBUD_Subheading"
    '        sSql = sSql & " left join ACC_ScheduleItems e on e.ASI_ID = ATBUD_itemid"
    '        sSql = sSql & " where ATBUD_CustId=" & ICustid & " and ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_Company_Type=" & iCompanyTypeid & ""
    '        sSql = sSql & " And ATBUD_YEARId=" & IyearID & " and ATBUD_CompId=" & iACID & " and (ATBUD_Headingid<>0) group by ATBUD_ID,ATBUD_Headingid,c.ASH_Name ,ATBUD_Subheading,d.ASSH_Name ,ATBUD_itemid,e.ASI_Name order by ATBUD_ID"
    '        dtdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        If dtdetails.Rows.Count > 0 Then
    '            For i = 0 To dtdetails.Rows.Count - 1
    '                dr = dt.NewRow
    '                If IsDBNull(dtdetails.Rows(i)("ATBUD_ID").ToString()) = False Then
    '                    dr("ID") = dtdetails.Rows(i)("ATBUD_ID").ToString()
    '                End If
    '                If IsDBNull(dtdetails.Rows(i)("Heading_name").ToString()) = False Then
    '                    dr("Headingname") = dtdetails.Rows(i)("Heading_name").ToString()
    '                End If
    '                If IsDBNull(dtdetails.Rows(i)("Total").ToString()) = False Then
    '                    dr("HeaderSLNo") = dtdetails.Rows(i)("Total").ToString()
    '                End If
    '                If dtdetails.Rows(i)("ATBUD_Subheading").ToString() <> 0 Then
    '                    dtheading = loadsubHeadings(sAC, iACID, IyearID, ICustid, iSchedulrTypeIdd, iCompanyTypeid, dtdetails.Rows(i)("ATBUD_Headingid"), dtdetails.Rows(i)("ATBUD_ID"))
    '                    If dtheading.Rows.Count > 0 Then
    '                        For j = 0 To dtheading.Rows.Count - 1
    '                            dt.Rows.Add(dr)
    '                            dr = dt.NewRow
    '                            If IsDBNull(dtheading.Rows(j)("ID").ToString()) = False Then
    '                                dr("ID") = dtheading.Rows(j)("ID").ToString()
    '                            End If
    '                            If IsDBNull(dtheading.Rows(j)("Headingname").ToString()) = False Then
    '                                dr("Headingname") = dtheading.Rows(j)("Headingname").ToString()
    '                            End If
    '                            If IsDBNull(dtheading.Rows(j)("Total").ToString()) = False Then
    '                                dr("HeaderSLNo") = dtheading.Rows(j)("Total").ToString()
    '                            End If
    '                        Next
    '                    End If
    '                End If
    '                If dtdetails.Rows(i)("ATBUD_itemid").ToString() <> 0 Then
    '                    dtItemsheading = loadItems(sAC, iACID, IyearID, ICustid, iSchedulrTypeIdd, iCompanyTypeid, dtdetails.Rows(i)("ATBUD_Headingid"), dtdetails.Rows(i)("ATBUD_ID"))
    '                    If dtItemsheading.Rows.Count > 0 Then
    '                        For j = 0 To dtItemsheading.Rows.Count - 1
    '                            dt.Rows.Add(dr)
    '                            dr = dt.NewRow
    '                            If IsDBNull(dtItemsheading.Rows(j)("Id").ToString()) = False Then
    '                                dr("ID") = dtItemsheading.Rows(j)("ID").ToString()
    '                            End If
    '                            If IsDBNull(dtItemsheading.Rows(j)("Headingname").ToString()) = False Then
    '                                dr("Headingname") = dtItemsheading.Rows(j)("Headingname").ToString()
    '                            End If
    '                            If IsDBNull(dtItemsheading.Rows(j)("TOtal").ToString()) = False Then
    '                                dr("HeaderSLNo") = dtItemsheading.Rows(j)("TOtal").ToString()
    '                            End If
    '                        Next
    '                    End If
    '                End If
    '                dt.Rows.Add(dr)
    '                'If tempheadingid1 <> tempheadingid2 Then
    '                '        dr("SrNo") = tempheadingid2

    '                '    If dtheading.Rows.Count > 0 Then
    '                '            For j = 0 To dtheading.Rows.Count - 1
    '                '                dt.Rows.Add(dr)
    '                '                dr = dt.NewRow
    '                '                dr("SrNo") = ""
    '                '                If IsDBNull(dtheading.Rows(j)("ID").ToString()) = False Then
    '                '                    dr("ID") = ""
    '                '                End If
    '                '                If IsDBNull(dtheading.Rows(j)("Headingname").ToString()) = False Then
    '                '                    dr("Headingname") = dtheading.Rows(j)("Headingname").ToString()
    '                '                End If
    '                '                dr("HeaderSLNo") = dtheading.Rows(j)("Total").ToString()
    '                '            Next
    '                '        End If
    '                '        dr("HeaderSLNo") = dtdetails.Rows(i)("Total").ToString()
    '                '        
    '                '    End If
    '                '    tempheadingid2 = tempheadingid1
    '            Next
    '        End If

    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    'Function loadItems(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal headingid As Integer, ByVal descid As Integer) As DataTable
    '    Dim sSql As String : Dim dt, dtdetails As New DataTable
    '    Dim dr As DataRow
    '    Dim dtheading As New DataTable
    '    Dim tempheadingid1 As Integer = 0
    '    Dim tempheadingid2 As Integer = 0
    '    Try
    '        dt.Columns.Add("ID")
    '        dt.Columns.Add("Headingname")
    '        dt.Columns.Add("TOtal")
    '        sSql = "select ATBUD_ID,ATBUD_itemid,c.ASI_Name as Itemname,ATBUD_Subheading as subheading,Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+"
    '        sSql = sSql & "b.ATBU_Opening_Credit_Amount+ATBU_Opening_Debit_Amount+ATBU_TR_Credit_Amount+ATBU_TR_Debit_Amount) as Total from Acc_TrailBalance_Upload_Details"
    '        sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID = ATBUD_Masid "
    '        sSql = sSql & " left join ACC_ScheduleItems c on c.ASI_ID = ATBUD_itemid"
    '        sSql = sSql & " where ATBUD_CustId=" & ICustid & " and ATBUD_SChedule_Type= " & iSchedulrTypeIdd & " and ATBUD_Company_Type= " & 0 & " And ATBUD_Headingid=" & headingid & " and ATBUD_Headingid<>0 And ATBUD_ID=" & descid & ""
    '        sSql = sSql & "group by ATBUD_ID,ATBUD_itemid,c.ASI_Name,ATBUD_Subheading order by ATBUD_ID"
    '        dtdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        If dtdetails.Rows.Count Then
    '            For i = 0 To dtdetails.Rows.Count - 1
    '                dr = dt.NewRow
    '                If IsDBNull(dtdetails.Rows(i)("ATBUD_itemid").ToString()) = False Then
    '                    dr("ID") = dtdetails.Rows(i)("ATBUD_itemid").ToString()
    '                End If
    '                If IsDBNull(dtdetails.Rows(i)("Itemname").ToString()) = False Then
    '                    dr("Headingname") = dtdetails.Rows(i)("Itemname").ToString()
    '                End If
    '                If IsDBNull(dtdetails.Rows(i)("TOtal").ToString()) = False Then
    '                    dr("TOtal") = dtdetails.Rows(i)("TOtal").ToString()
    '                End If
    '                dt.Rows.Add(dr)
    '            Next
    '        End If
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    'Function loadsubHeadings(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal Iheadingid As Integer, ByVal descid As Integer) As DataTable
    '    Dim sSql As String : Dim dt, dtdetails As New DataTable
    '    Dim dr As DataRow
    '    Dim dtheading As New DataTable
    '    Try
    '        dt.Columns.Add("ID")
    '        dt.Columns.Add("Headingname")
    '        dt.Columns.Add("TOtal")
    '        sSql = "select ATBUD_Subheading,b.ASSH_Name as Name,ATBUD_itemid,ATBUD_Headingid,Sum(c.ATBU_Closing_Credit_Amount+c.ATBU_Closing_Debit_Amount+c.ATBU_Opening_Credit_Amount+c.ATBU_Opening_Debit_Amount+c.ATBU_TR_Credit_Amount+c.ATBU_TR_Debit_Amount) as Total   from Acc_TrailBalance_Upload_Details"
    '        sSql = sSql & " left join Acc_TrailBalance_Upload c on c.ATBU_ID=ATBUD_Masid "
    '        sSql = sSql & " left join ACC_ScheduleSubHeading b on b.ASSH_ID = ATBUD_Subheading"
    '        sSql = sSql & " where ATBUD_CustId=" & ICustid & " and ATBUD_SChedule_Type= " & iSchedulrTypeIdd & " and ATBUD_Company_Type= " & iCompanyTypeid & " And ATBUD_Headingid=" & Iheadingid & " and ATBUD_Headingid<>0 And ATBUD_ID=" & descid & ""
    '        sSql = sSql & " group by ATBUD_Subheading,b.ASSH_Name,ATBUD_itemid,ATBUD_Headingid"
    '        dtdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        If dtdetails.Rows.Count Then
    '            For i = 0 To dtdetails.Rows.Count - 1
    '                dr = dt.NewRow
    '                If IsDBNull(dtdetails.Rows(i)("ATBUD_Subheading").ToString()) = False Then
    '                    dr("ID") = dtdetails.Rows(i)("ATBUD_Subheading").ToString()
    '                End If
    '                If IsDBNull(dtdetails.Rows(i)("Name").ToString()) = False Then
    '                    dr("Headingname") = dtdetails.Rows(i)("Name").ToString()
    '                End If
    '                If IsDBNull(dtdetails.Rows(i)("TOtal").ToString()) = False Then
    '                    dr("TOtal") = dtdetails.Rows(i)("TOtal").ToString()
    '                End If
    '                dt.Rows.Add(dr)
    '            Next
    '        End If
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function GetHeading(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal HeadingName As String) As Integer
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim dr As DataRow
        Dim iret As Integer
        Try

            sSql = "select Count(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount) as Total from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid "
            sSql = sSql & " left join ACC_ScheduleHeading c on c.ASH_ID =ATBUD_Headingid"
            sSql = sSql & " where c.ASH_Name='" & HeadingName & "'"
            iret = objDBL.SQLExecuteScalarInt(sAC, sSql)
            If iret <> 0 Then
                Return 1
            ElseIf iret = 0 Then
                sSql = "select Count(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount) as Total from Acc_TrailBalance_Upload_Details"
                sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid "
                sSql = sSql & " left join ACC_ScheduleSubHeading c on c.ASSH_ID =ATBUD_subHeading"
                sSql = sSql & " where c.ASSH_Name='" & HeadingName & "'"
                iret = objDBL.SQLExecuteScalarInt(sAC, sSql)
                If iret <> 0 Then
                    Return 2
                Else
                    GoTo Next1
                End If
Next1:      Else
                sSql = "select Count(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount) as Total from Acc_TrailBalance_Upload_Details"
                sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid "
                sSql = sSql & " ACC_ScheduleItems c on c.ASI_ID =ATBUD_itemid"
                sSql = sSql & " where c.ASI_Name='" & HeadingName & "'"
                iret = objDBL.SQLExecuteScalarInt(sAC, sSql)
                Return 3
            End If
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function TotalHeadinhg(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal HeadingName As String) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)   as Total from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid"
            sSql = sSql & " left join ACC_ScheduleHeading c on c.ASH_ID =ATBUD_Headingid"
            sSql = sSql & " where c.ASH_Name='" & HeadingName & "'"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function TotalSubHeadinhg(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal HeadingName As String) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Try
            sSql = "select  ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)  as Total from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid "
            sSql = sSql & " left join ACC_ScheduleSubHeading c on c.ASSH_ID =ATBUD_subHeading"
            sSql = sSql & " where c.ASSH_Name='" & HeadingName & "'"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function TotalItem(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal HeadingName As String) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Try
            sSql = "select ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)  as Total from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid "
            sSql = sSql & " left join ACC_ScheduleItems c on c.ASI_ID =ATBUD_itemid"
            sSql = sSql & " where c.ASI_Name='" & HeadingName & "'"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetHeadingswithNosubheadingsandItems(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select atbud_id, b.ASH_Name as Headingname,Sum(e.ATBU_TR_Credit_Amount+e.ATBU_TR_Debit_Amount
+e.ATBU_Opening_Credit_Amount+e.ATBU_Opening_Debit_Amount
+e.ATBU_Closing_Credit_Amount+e.ATBU_Closing_Debit_Amount) as Total from Acc_TrailBalance_Upload_Details "
            sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID= ATBUD_Masid"
            sSql = sSql & " left join ACC_ScheduleHeading b on b.ASH_ID=ATBUD_Headingid "
            sSql = sSql & " left join ACC_ScheduleSubHeading c on c.ASSH_ID=ATBUD_Subheading left join ACC_ScheduleItems d on d.ASI_ID= ATBUD_itemid "
            sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Subheading=0 and ATBUD_itemid=0 and ATBUD_CustId=" & ICustid & " group by atbud_id, b.ASH_Name"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetHeadingdwithsubheadingNoitems(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select atbud_id, c.ASSH_Name as Headingname from Acc_TrailBalance_Upload_Details "
            sSql = sSql & " left join ACC_ScheduleHeading b on b.ASH_ID=ATBUD_Headingid "
            sSql = sSql & " left join ACC_ScheduleSubHeading c on c.ASSH_ID=ATBUD_Subheading left join ACC_ScheduleItems d on d.ASI_ID= ATBUD_itemid "
            sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Subheading<>0 and ATBUD_itemid=0 and ATBUD_CustId=" & ICustid & ""
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetheadingswithHeadingsandsubheadingtoitems(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select  atbud_id, d.ASI_Name as Headingname,b.ASH_ID as ID,Sum(e.ATBU_TR_Credit_Amount+e.ATBU_TR_Debit_Amount+e.ATBU_Opening_Credit_Amount+e.ATBU_Opening_Debit_Amount+e.ATBU_Closing_Credit_Amount+e.ATBU_Closing_Debit_Amount) as Total from Acc_TrailBalance_Upload_Details "
            sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID= ATBUD_Masid"
            sSql = sSql & " left join ACC_ScheduleHeading b on b.ASH_ID=ATBUD_Headingid "
            sSql = sSql & " left join ACC_ScheduleSubHeading c on c.ASSH_ID=ATBUD_Subheading left join ACC_ScheduleItems d on d.ASI_ID= ATBUD_itemid "
            sSql = sSql & " Where ATBUD_Headingid<>0 and ATBUD_Subheading<>0 and ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by atbud_id,d.ASI_Name,b.ASH_ID"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetheadingswithHeadingsandNosubheadingtoitems(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select  atbud_id, d.ASI_Name as Headingname,b.ASH_ID as ID,Sum(e.ATBU_TR_Credit_Amount+e.ATBU_TR_Debit_Amount
+e.ATBU_Opening_Credit_Amount+e.ATBU_Opening_Debit_Amount
+e.ATBU_Closing_Credit_Amount+e.ATBU_Closing_Debit_Amount) as Total  from Acc_TrailBalance_Upload_Details "
            sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID= ATBUD_Masid"
            sSql = sSql & " left join ACC_ScheduleHeading b on b.ASH_ID=ATBUD_Headingid "
            sSql = sSql & " left join ACC_ScheduleSubHeading c on c.ASSH_ID=ATBUD_Subheading left join ACC_ScheduleItems d on d.ASI_ID= ATBUD_itemid"
            sSql = sSql & " wHERE ATBUD_Headingid<>0 and ATBUD_Subheading=0 and ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & "  group by atbud_id,d.ASI_Name,b.ASH_ID"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function gettotalofdesc(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)  as Total from Acc_TrailBalance_Upload_Details
                     left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid 
                        left join ACC_ScheduleItems c on c.ASI_ID =ATBUD_itemid where ATBUD_Headingid =2"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function gettotalof1(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iheadingid As String, ByVal subheading As String) As String
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)  as Total from Acc_TrailBalance_Upload_Details
                     left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid"
            sSql = sSql & " where ATBUD_itemid=1 or ATBUD_ID=2 and ATBUD_CompId=" & iACID & " and ATBUD_YEARId=" & IyearID & " and ATBUD_CustId=" & ICustid & ""
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt.Rows(0)("Total").ToString
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function gettotalof2(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iheadingid As String, ByVal subheading As String) As String
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)  as Total from Acc_TrailBalance_Upload_Details
                     left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid 
                        left join ACC_ScheduleItems c on c.ASI_ID =ATBUD_itemid and asi_name='Opening Stock of raw-material' and asi_name='Opening stock of work in progress' "
            sSql = sSql & " where ATBUD_CompId=" & iACID & " and ATBUD_YEARId=" & IyearID & " and ATBUD_CustId=" & ICustid & " and ATBUD_Subheading=4"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt.Rows(0)("Total").ToString
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function gettotalof3(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iheadingid As String, ByVal subheading As String) As String
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)  as Total from Acc_TrailBalance_Upload_Details
                     left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid 
                        left join ACC_ScheduleItems c on c.ASI_ID =ATBUD_itemid and asi_name='Opening Stock of raw-material' and asi_name='Opening stock of work in progress' "
            sSql = sSql & " where ATBUD_CompId=" & iACID & " and ATBUD_YEARId=" & IyearID & " and ATBUD_CustId=" & ICustid & " and ATBUD_Headingid=2"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt.Rows(0)("Total").ToString
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function gettotalof4(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iheadingid As String, ByVal subheading As String) As String
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim IdeciTotal As String = ""
        Try
            sSql = "select ISNULL(Sum(b.ATBU_Closing_Credit_Amount+b.ATBU_Closing_Debit_Amount+b.ATBU_TR_Credit_Amount+b.ATBU_TR_Debit_Amount+b.ATBU_Opening_Credit_Amount+b.ATBU_Opening_Debit_Amount), 0)  as Total from Acc_TrailBalance_Upload_Details
                     left join Acc_TrailBalance_Upload b on b.ATBU_ID=ATBUD_Masid"
            sSql = sSql & " where ATBUD_CompId=" & iACID & " and ATBUD_YEARId=" & IyearID & " and ATBUD_CustId=" & ICustid & " and ATBUD_Subheading=3"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt.Rows(0)("Total").ToString
        Catch ex As Exception
            Throw
        End Try
    End Function

    'Public Function getdetailsManufacturing(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iCompanyTypeid As Integer) As DataTable
    '    Dim sSql As String : Dim dtheading, dtdetails As New DataTable
    '    Dim dtitem As New DataTable
    '    Dim dtsubheading As New DataTable
    '    Dim dtSubitem As New DataTable
    '    Dim dr As DataRow
    '    Dim IdeciTotal As String = ""
    '    Dim headingTotal As Double = 0
    '    Dim TotalAllHeadings As Double = 0
    '    Dim tot1 As Double = 0
    '    Dim tot2 As Double = 0
    '    Try
    '        dtdetails.Columns.Add("SrNo")
    '        dtdetails.Columns.Add("Headingname")
    '        dtdetails.Columns.Add("HeaderSLNo")
    '        dtdetails.Columns.Add("SubHeaderSLNo")
    '        sSql = "select distinct(AST_HeadingID), a.ash_Name as headingname from ACC_ScheduleTemplates"
    '        sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  AST_HeadingID"
    '        sSql = sSql & " where AST_Schedule_type=" & iSchedulrTypeIdd & " and AST_compid = " & iACID & ""
    '        dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        If dtheading.Rows.Count > 0 Then
    '            For i = 0 To dtheading.Rows.Count - 1
    '                If IsDBNull(dtheading(i)("headingname")) = False Then
    '                    dr = dtdetails.NewRow
    '                    dr("SrNo") = i + 1
    '                    dr("Headingname") = dtheading(i)("headingname")
    '                    dtdetails.Rows.Add(dr)
    '                End If
    '                sSql = ""
    '                sSql = " select distinct(AST_SubHeadingID),a.ASSH_Name as headingname from ACC_ScheduleTemplates "
    '                sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= AST_SubHeadingID"
    '                sSql = sSql & " where  AST_HeadingID= " & dtheading(i)("AST_HeadingID") & " and AST_Schedule_type =" & iSchedulrTypeIdd & ""
    '                dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                If dtsubheading.Rows.Count > 0 Then
    '                    For j = 0 To dtsubheading.Rows.Count - 1
    '                        If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                            dr = dtdetails.NewRow
    '                            dr("SrNo") = i + 1 & "-" & j + 1
    '                            dr("Headingname") = dtsubheading(j)("headingname")
    '                            dtdetails.Rows.Add(dr)
    '                        End If
    '                        sSql = ""
    '                        sSql = " select distinct(AST_ItemID),a.ASI_Name as headingname, ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from ACC_ScheduleTemplates "
    '                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID
    '                                        left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
    '                        sSql = sSql & " where AST_HeadingID=" & dtheading(i)("AST_HeadingID") & " And AST_SubHeadingID= " & dtsubheading(j)("AST_SubHeadingID") & " and AST_Schedule_type =" & iSchedulrTypeIdd & " group by AST_ItemID,a.ASI_Name"
    '                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtitem.Rows.Count > 0 Then
    '                            For k = 0 To dtitem.Rows.Count - 1
    '                                If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
    '                                    dr("Headingname") = dtitem(k)("headingname")
    '                                    dr("HeaderSLNo") = dtitem(k)("Total")
    '                                    headingTotal = headingTotal + dtitem(k)("Total")
    '                                    TotalAllHeadings = TotalAllHeadings + dtitem(k)("Total")
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            Next
    '                            dr = dtdetails.NewRow
    '                            dr("Srno") = ""
    '                            dr("Headingname") = "<B>" & "Total" & "</B>"
    '                            dr("SubHeaderSLNo") = headingTotal
    '                            dr("HeaderSLNo") = ""
    '                            headingTotal = 0
    '                            dtdetails.Rows.Add(dr)
    '                        End If
    '                    Next
    '                Else
    '                    sSql = " select distinct(AST_ItemID),a.ASI_Name Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount) as Total from ACC_ScheduleTemplates "
    '                    sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID
    '                                        left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
    '                    sSql = sSql & " where AST_HeadingID=" & dtheading(i)("AST_HeadingID") & " And AST_SubHeadingID=0 And AST_ItemID<>0 and AST_Schedule_type =" & iSchedulrTypeIdd & " group by AST_ItemID,a.ASI_Name"
    '                    dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtitem.Rows.Count > 0 Then
    '                        For k = 0 To dtitem.Rows.Count - 1
    '                            If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
    '                                dr("Headingname") = dtitem(k)("headingname")
    '                                dr("HeaderSLNo") = dtitem(k)("Total")
    '                                headingTotal = headingTotal + dtitem(k)("Total")
    '                                TotalAllHeadings = TotalAllHeadings + dtitem(k)("Total")
    '                                dtdetails.Rows.Add(dr)
    '                            End If
    '                        Next
    '                        dr = dtdetails.NewRow
    '                        dr("Srno") = ""
    '                        dr("Headingname") = "<B>" & "Total" & "</B>"
    '                        dr("SubHeaderSLNo") = headingTotal
    '                        dr("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        dtdetails.Rows.Add(dr)
    '                    End If
    '                End If
    '                If i = 0 Then
    '                    tot1 = TotalAllHeadings
    '                    TotalAllHeadings = 0
    '                ElseIf i = 1 Then
    '                    tot2 = TotalAllHeadings
    '                    TotalAllHeadings = 0
    '                ElseIf i = 2 Then
    '                    dr = dtdetails.NewRow
    '                    dr("Srno") = ""
    '                    dr("Headingname") = "<B>" & "Total" & "</B>"
    '                    dr("SubHeaderSLNo") = tot1 - tot2
    '                    dr("HeaderSLNo") = ""
    '                    dtdetails.Rows.Add(dr)
    '                    If iSchedulrTypeIdd = 1 Then
    '                        sSql = "Update ACC_ScheduleHeading set Ash_Total=" & dr("SubHeaderSLNo") & " where ASH_ID=" & dtheading.Rows(i)("AST_HeadingID") & ""
    '                        objDBL.SQLExecuteNonQuery(sAC, sSql)
    '                    End If
    '                End If
    '            Next
    '        End If
    '        Return dtdetails
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function getdetailsManufacturing(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, IreportType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim TotalAllHeadings As Double = 0
        Dim Total As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim num As Integer
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            dtdetails.Columns.Add("PrevyearTotoal")
            'Heading
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,"
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total "
            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " where ATBUD_Schedule_type=" & iSchedulrTypeIdd & " And ATBUD_compid = " & iACID & "and ATBUD_CustId=" & ICustid & " group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            If IreportType = 1 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(m)("ATBUD_Headingid") & " and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "STotal"
                            'dr("SubHeaderSLNo") = S2TotalAllHeadings
                            'dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            'dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And AST_ItemID<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            ElseIf IreportType = 2 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtheading.Rows.Count > 0 Then
                                For l = 0 To dtdescdetails.Rows.Count - 1
                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = "Description" & l + 1
                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                        'Sub heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(m)("ATBUD_Headingid") & " and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = headingTotal + dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                    'Fetch desc Under Sub heading
                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                    sSql = sSql & " where ATBUD_Schedule_type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & ""
                                    sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("AST_SubHeadingID") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtdescdetails.Rows.Count > 0 Then
                                        For l = 0 To dtdescdetails.Rows.Count - 1
                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("SrNo") = "Description: " & l + 1
                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                            'Fetch desc under item
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & ""
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("AST_SubHeadingID") & " and b.ATBUD_itemid=" & dtitem(k)("AST_ItemID") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Description: " & l + 1
                                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            End If
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            dr = dtdetails.NewRow
                            dr("Srno") = ""
                            dr("Headingname") = "STotal"
                            dr("SubHeaderSLNo") = S2TotalAllHeadings
                            dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            S2TotalAllHeadings = 0
                            dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And AST_ItemID<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                        'Fetch desc under item
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                        sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & ""
                                        sSql = sSql & " and b.ATBUD_Subheading=0 and b.ATBUD_itemid=" & dtitem(k)("AST_ItemID") & " and b.ATBUD_SubItemId=0"
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Description: " & l + 1
                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            End If
            dr = dtdetails.NewRow
            dr("Srno") = ""
            dr("Headingname") = "Grand Total"
            dr("HeaderSLNo") = ""
            dr("SubHeaderSLNo") = S2TotalAllHeadings
            S1TotalAllHeadings = 0
            dtdetails.Rows.Add(dr)
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getdetailsTrading(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal IreportType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            dtdetails.Columns.Add("PrevyearTotoal")
            sSql = "select distinct(AST_HeadingID), a.ash_Name as headingname,"
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total "
            sSql = sSql & "  from ACC_ScheduleTemplates"
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  AST_HeadingID"
            sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_Headingid= AST_HeadingID and c.ATBUD_CustId=" & ICustid & ""
            sSql = sSql & "left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
            sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and AST_compid = " & iACID & " group by AST_HeadingID,ash_Name order by AST_HeadingID"
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)

            If IreportType = 1 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                        End If
                        sSql = ""
                        sSql = " select distinct(AST_SubHeadingID),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total "
                        sSql = sSql & " from ACC_ScheduleTemplates "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= AST_SubHeadingID"
                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_Subheading= AST_SubHeadingID and c.ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & "left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
                        sSql = sSql & " where  AST_HeadingID= " & dtheading(m)("AST_HeadingID") & " and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by AST_SubHeadingID,a.ASSH_Name order by AST_SubHeadingID  "
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = headingTotal + dtsubheading(j)("Total")
                                    S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                End If
                                sSql = ""
                                sSql = " select distinct(AST_ItemID),a.ASI_Name as headingname, ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from ACC_ScheduleTemplates "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID"
                                sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
                                sSql = sSql & " where AST_HeadingID=" & dtheading(m)("AST_HeadingID") & " And AST_SubHeadingID= " & dtsubheading(j)("AST_SubHeadingID") & " and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by AST_ItemID,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                        sSql = ""
                                        sSql = sSql & " select distinct(AST_SubItemID),a.ASSI_Name as headingname, ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from ACC_ScheduleTemplates "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= AST_SubItemID "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_SubItemId= AST_SubItemID "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
                                        sSql = sSql & " where AST_HeadingID=" & dtheading(m)("AST_HeadingID") & " And AST_SubHeadingID= " & dtsubheading(j)("AST_SubHeadingID") & " And AST_SubItemID<>0 And AST_Itemid = " & dtitem.Rows(k)("AST_ItemID") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by AST_SubItemID,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            dr = dtdetails.NewRow
                            dr("Srno") = ""
                            dr("Headingname") = "STotal"
                            dr("SubHeaderSLNo") = S2TotalAllHeadings
                            dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            S2TotalAllHeadings = 0
                            dtdetails.Rows.Add(dr)
                        Else
                            sSql = " select distinct(AST_ItemID),a.ASI_Name Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount) as Total from ACC_ScheduleTemplates "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID
                                            left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
                            sSql = sSql & " where AST_HeadingID=" & dtheading(m)("AST_HeadingID") & " And AST_SubHeadingID=0 And AST_ItemID<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by AST_ItemID,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            ElseIf IreportType = 2 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtheading.Rows.Count > 0 Then
                                For l = 0 To dtdescdetails.Rows.Count - 1
                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = "Description" & l + 1
                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                        sSql = ""
                        sSql = " select distinct(AST_SubHeadingID),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total "
                        sSql = sSql & " from ACC_ScheduleTemplates "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= AST_SubHeadingID"
                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_Subheading= AST_SubHeadingID and c.ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & "left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
                        sSql = sSql & " where  AST_HeadingID= " & dtheading(m)("AST_HeadingID") & " and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by AST_SubHeadingID,a.ASSH_Name order by AST_SubHeadingID  "
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = headingTotal + dtsubheading(j)("Total")
                                    S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                    'Fetch desc Under Sub heading
                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                    sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & ""
                                    sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("AST_SubHeadingID") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtdescdetails.Rows.Count > 0 Then
                                        For l = 0 To dtdescdetails.Rows.Count - 1
                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("SrNo") = "Description: " & l + 1
                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                End If
                                sSql = ""
                                sSql = " select distinct(AST_ItemID),a.ASI_Name as headingname, ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from ACC_ScheduleTemplates "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID"
                                sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
                                sSql = sSql & " where AST_HeadingID=" & dtheading(m)("AST_HeadingID") & " And AST_SubHeadingID= " & dtsubheading(j)("AST_SubHeadingID") & " and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by AST_ItemID,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                            'Fetch desc under item
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & ""
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("AST_SubHeadingID") & " and b.ATBUD_itemid=" & dtitem(k)("AST_ItemID") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Description: " & l + 1
                                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            End If
                                        End If
                                        sSql = ""
                                        sSql = sSql & " select distinct(AST_SubItemID),a.ASSI_Name as headingname, ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from ACC_ScheduleTemplates "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= AST_SubItemID "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_SubItemId= AST_SubItemID "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
                                        sSql = sSql & " where AST_HeadingID=" & dtheading(m)("AST_HeadingID") & " And AST_SubHeadingID= " & dtsubheading(j)("AST_SubHeadingID") & " And AST_SubItemID<>0 And AST_Itemid = " & dtitem.Rows(k)("AST_ItemID") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by AST_SubItemID,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            dr = dtdetails.NewRow
                            dr("Srno") = ""
                            dr("Headingname") = "STotal"
                            dr("SubHeaderSLNo") = S2TotalAllHeadings
                            dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            S2TotalAllHeadings = 0
                            dtdetails.Rows.Add(dr)
                        Else
                            sSql = " select distinct(AST_ItemID),a.ASI_Name Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount) as Total from ACC_ScheduleTemplates "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID
                                            left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
                            sSql = sSql & " where AST_HeadingID=" & dtheading(m)("AST_HeadingID") & " And AST_SubHeadingID=0 And AST_ItemID<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by AST_ItemID,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                        sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("AST_HeadingID") & ""
                                        sSql = sSql & " and b.ATBUD_Subheading=0 and b.ATBUD_itemid=" & dtitem(k)("AST_ItemID") & " and b.ATBUD_SubItemId=0"
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Description: " & l + 1
                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            End If
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getPAndL(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iRepType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim S3TotalAllHeadings As Double = 0
        Dim PrevheadingTotal As Double = 0
        Dim PrevS1TotalAllHeadings As Double = 0
        Dim PrevS2TotalAllHeadings As Double = 0
        Dim PrevS3TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer = 0
        Dim TOTalHeading As Double = 0
        Dim TOTalHeadingDb As Double = 0
        Dim TOTalHeadingCr As Double = 0
        Dim CreditTotal As Double = 0
        Dim DebitTotal As Double = 0
        Dim inc As Integer = 0
        Dim StockEntry As Double = 0
        Dim PrevTOTalHeading As Double = 0
        Dim PrevTOTalHeadingDb As Double = 0
        Dim PrevTOTalHeadingCr As Double = 0
        Dim PrevCreditTotal As Double = 0
        Dim PrevDebitTotal As Double = 0
        Dim subCreditTotal As Double = 0
        Dim subDebitTotal As Double = 0
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            dtdetails.Columns.Add("Notes")
            dtdetails.Columns.Add("PrevyearTotoal")
            'AST_AccHeadId =1 
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  from Acc_TrailBalance_Upload_Details "
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
            sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            If iRepType = 1 Then

                sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes, "
                sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                sSql = sSql & " ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                sSql = sSql & "  from Acc_TrailBalance_Upload_Details "
                sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid and a.ASH_Notes=1 "
                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & "  "
                sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
                sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " "
                sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
                dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtheading.Rows.Count > 0 Then
                    dr = dtdetails.NewRow
                    dr("SrNo") = ""
                    dr("Headingname") = "<B>" & "Income" & "</B>"
                    dtdetails.Rows.Add(dr)
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = i + 1
                            dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                            If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                CreditTotal = CreditTotal + TOTalHeading
                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
                            Else
                                TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                DebitTotal = DebitTotal + TOTalHeading
                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
                            End If
                            ' PrevTOtal
                            If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
                                PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
                            Else
                                PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
                            End If
                            dtdetails.Rows.Add(dr)
                            S1TotalAllHeadings = headingTotal + TOTalHeading
                            PrevS1TotalAllHeadings = PrevheadingTotal + PrevTOTalHeading
                            'Sub Heading
                            sSql = ""
                            sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,  "
                            sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
                            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                            sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & ""
                            sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & ""
                            sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & "  and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " "
                            sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                            dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtsubheading.Rows.Count > 0 Then
                                num = dtdetails.Rows.Count - 1
                                dtdetails(num)("HeaderSLNo") = ""
                                dtdetails(num)("PrevyearTotoal") = ""
                                For j = 0 To dtsubheading.Rows.Count - 1
                                    If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = i + 1 & "-" & j + 1
                                        dr("Headingname") = dtsubheading(j)("headingname")
                                        dr("Notes") = dtsubheading(j)("Notes")
                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                            subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                            dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                        Else
                                            subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                            dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
                                        End If
                                        If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                            subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
                                            dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                        Else
                                            subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
                                            dr("PrevyearTotoal") = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
                                        End If
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            Else
                            End If
                        End If
                    Next
                    dr = dtdetails.NewRow
                    dr("Srno") = ""
                    dr("Headingname") = "<B>" & "Total" & "</B>"
                    If CreditTotal > DebitTotal Then
                        S1TotalAllHeadings = CreditTotal - DebitTotal
                        dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
                    Else
                        S1TotalAllHeadings = CreditTotal - DebitTotal
                        dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
                    End If
                    If PrevCreditTotal > PrevDebitTotal Then
                        PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
                    Else
                        PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
                    End If
                    dtdetails.Rows.Add(dr)
                End If
                'AST_AccHeadId = 2
                CreditTotal = 0
                DebitTotal = 0
                TOTalHeading = 0
                headingTotal = 0
                subCreditTotal = 0
                headingTotal = 0
                TOTalHeadingCr = 0
                TOTalHeadingDb = 0
                PrevCreditTotal = 0
                PrevDebitTotal = 0
                PrevTOTalHeading = 0
                PrevheadingTotal = 0

                PrevheadingTotal = 0
                PrevTOTalHeadingCr = 0
                PrevTOTalHeadingDb = 0

                '  iNote=2
                sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes, "
                sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                sSql = sSql & " ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                sSql = sSql & " from Acc_TrailBalance_Upload_Details "
                sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid and a.ASH_Notes=2 "
                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & " "
                sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
                sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & ""
                sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
                dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtheading.Rows.Count > 0 Then
                    dr = dtdetails.NewRow
                    dr("SrNo") = ""
                    dr("Headingname") = "<B>" & "Expenses" & "</B>"
                    dtdetails.Rows.Add(dr)
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = i + 1
                            dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                            If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                CreditTotal = CreditTotal + TOTalHeading
                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
                            Else
                                TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                DebitTotal = DebitTotal + TOTalHeading
                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
                            End If
                            If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
                                PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
                            Else
                                PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
                            End If
                            dtdetails.Rows.Add(dr)
                            PrevS2TotalAllHeadings = PrevheadingTotal + PrevTOTalHeading
                            'Sub Heading
                            sSql = ""
                            sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,  "
                            sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
                            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                            sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & ""
                            sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & ""
                            sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & "  and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " "
                            sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                            dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtsubheading.Rows.Count > 0 Then
                                num = dtdetails.Rows.Count - 1
                                dtdetails(num)("HeaderSLNo") = ""
                                dtdetails(num)("PrevyearTotoal") = ""
                                For j = 0 To dtsubheading.Rows.Count - 1
                                    If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = i + 1 & "-" & j + 1
                                        dr("Headingname") = dtsubheading(j)("headingname")
                                        dr("Notes") = dtsubheading(j)("Notes")
                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                            subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                            dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                        Else
                                            subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                            dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
                                        End If
                                        If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                            subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
                                            dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                        Else
                                            subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
                                            dr("PrevyearTotoal") = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
                                        End If
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            Else
                            End If
                        End If
                    Next
                    dr = dtdetails.NewRow
                    dr("Srno") = ""
                    dr("Headingname") = "<B>" & "Total" & "</B>"
                    If CreditTotal > DebitTotal Then
                        S2TotalAllHeadings = CreditTotal - DebitTotal
                        dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
                    Else
                        S2TotalAllHeadings = CreditTotal - DebitTotal
                        dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
                    End If

                    If PrevCreditTotal > PrevDebitTotal Then
                        PrevS2TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00")
                    Else
                        PrevS2TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00")
                    End If
                    dtdetails.Rows.Add(dr)
                End If


                'If dtheading.Rows.Count > 0 Then
                '    'dr = dtdetails.NewRow
                '    'dr("SrNo") = ""
                '    'dr("Headingname") = "<B>" & "Income" & "</B>"
                '    'dtdetails.Rows.Add(dr)
                '    For i = 0 To dtheading.Rows.Count - 1
                '        If IsDBNull(dtheading(i)("headingname")) = False Then
                '            dr = dtdetails.NewRow
                '            dr("SrNo") = i + 1
                '            dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                '            If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                '                TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                '                CreditTotal = CreditTotal + TOTalHeading
                '                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                '            Else
                '                TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                '                DebitTotal = DebitTotal + TOTalHeading
                '                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                '            End If
                '            dtdetails.Rows.Add(dr)
                '            headingTotal = headingTotal + TOTalHeading
                '        End If
                '        'Sub Heading
                '        sSql = ""
                '        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                '        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                '        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                '        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                '        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                '        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                '        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                '        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                '        If dtsubheading.Rows.Count > 0 Then
                '            num = dtdetails.Rows.Count - 1
                '            dtdetails(num)("HeaderSLNo") = ""
                '            CreditTotal = 0
                '            DebitTotal = 0
                '            For j = 0 To dtsubheading.Rows.Count - 1
                '                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                '                    dr = dtdetails.NewRow
                '                    dr("SrNo") = i + 1 & "-" & j + 1
                '                    dr("Headingname") = dtsubheading(j)("headingname")
                '                    dr("Notes") = dtsubheading(j)("Notes")
                '                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                '                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                '                        CreditTotal = CreditTotal + TOTalHeading
                '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                '                    Else
                '                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                '                        DebitTotal = DebitTotal + TOTalHeading
                '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                '                    End If
                '                    S2TotalAllHeadings = S2TotalAllHeadings + TOTalHeading
                '                    dtdetails.Rows.Add(dr)
                '                    headingTotal = headingTotal + TOTalHeading
                '                End If
                '            Next
                '        Else
                '        End If
                '    Next
                '    dr = dtdetails.NewRow
                '    dr("Srno") = ""
                '    dr("Headingname") = "<B>" & "Total" & "</B>"
                '    If CreditTotal > DebitTotal Then
                '        dr("HeaderSLNo") = "-" & Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
                '    Else
                '        dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
                '    End If
                '    dtdetails.Rows.Add(dr)
                'End If
                ''AST_AccHeadId = 2
                ''CreditTotal = 0
                ''DebitTotal = 0
                ''TOTalHeading = 0
                ''headingTotal = 0
                ''S2TotalAllHeadings = 0
                ''sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                ''sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal   from Acc_TrailBalance_Upload_Details "
                ''sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
                ''sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                ''sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                ''sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId =2)group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
                ''dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                'If dtheading.Rows.Count > 0 Then
                '    'dr = dtdetails.NewRow
                '    'dr("SrNo") = ""
                '    'dr("Headingname") = "<B>" & "Expenses" & "</B>"
                '    'dtdetails.Rows.Add(dr)
                '    'For i = 0 To dtheading.Rows.Count - 1
                '    '    If IsDBNull(dtheading(i)("headingname")) = False Then
                '    '        dr = dtdetails.NewRow
                '    '        dr("SrNo") = i + 1
                '    '        dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                '    '        If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                '    '            'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                '    '            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                '    '            CreditTotal = CreditTotal + TOTalHeading
                '    '            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                '    '        Else
                '    '            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                '    '            DebitTotal = DebitTotal + TOTalHeading
                '    '            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                '    '        End If
                '    '        dtdetails.Rows.Add(dr)
                '    '        headingTotal = headingTotal + TOTalHeading
                '    '    End If
                '    '    'Sub Heading
                '    '    sSql = ""
                '    '    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                '    '    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                '    '    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                '    '    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                '    '    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                '    '    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                '    '    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                '    '    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                '    '    If dtsubheading.Rows.Count > 0 Then
                '    '        num = dtdetails.Rows.Count - 1
                '    '        dtdetails(num)("HeaderSLNo") = ""
                '    '        CreditTotal = 0
                '    '        DebitTotal = 0
                '    '        For j = 0 To dtsubheading.Rows.Count - 1
                '    '            If IsDBNull(dtsubheading(j)("headingname")) = False Then
                '    '                dr = dtdetails.NewRow
                '    '                dr("SrNo") = i + 1 & "-" & j + 1
                '    '                dr("Headingname") = dtsubheading(j)("headingname")
                '    '                dr("Notes") = dtsubheading(j)("Notes")
                '    '                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                '    '                    TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                '    '                    'CreditTotal = CreditTotal + TOTalHeading
                '    '                    If dtsubheading.Rows(j)("headingname") = "(a) Cost of materials consumed" Then
                '    '                        StockEntry = objclsUSEntry.GetCustStockEntryTotal(sAC, iACID, ICustid, IyearID)
                '    '                        CreditTotal = CreditTotal + TOTalHeading + StockEntry
                '    '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading + StockEntry).ToString("#,##0.00") & "Cr"
                '    '                    Else
                '    '                        CreditTotal = CreditTotal + TOTalHeading
                '    '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                '    '                    End If
                '    '                Else
                '    '                    TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                '    '                    'DebitTotal = DebitTotal + TOTalHeading
                '    '                    If dtsubheading.Rows(j)("headingname") = "(a) Cost of materials consumed" Then
                '    '                        StockEntry = objclsUSEntry.GetCustStockEntryTotal(sAC, iACID, ICustid, IyearID)
                '    '                        DebitTotal = DebitTotal + TOTalHeading + StockEntry
                '    '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading + StockEntry).ToString("#,##0.00") & "Dr"
                '    '                    Else
                '    '                        DebitTotal = DebitTotal + TOTalHeading
                '    '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                '    '                    End If
                '    '                End If
                '    '                S2TotalAllHeadings = S2TotalAllHeadings + TOTalHeading
                '    '                dtdetails.Rows.Add(dr)
                '    '                headingTotal = headingTotal + TOTalHeading
                '    '            End If
                '    '        Next
                '    '    Else
                '    '    End If
                '    'Next
                '    dr = dtdetails.NewRow
                '    dr("Srno") = ""
                '    dr("Headingname") = "<B>" & "Total" & "</B>"
                '    If CreditTotal > DebitTotal Then
                '        dr("HeaderSLNo") = "-" & Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
                '    Else
                '        dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
                '    End If
                '    S3TotalAllHeadings = dr("HeaderSLNo")
                '    S1TotalAllHeadings = 0
                '    dtdetails.Rows.Add(dr)
                '    headingTotal = 0
                '    TOTalHeadingCr = 0
                '    TOTalHeadingDb = 0
                'End If
            ElseIf iRepType = 2 Then
                S1TotalAllHeadings = 0
                If dtheading.Rows.Count > 0 Then
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtdescdetails.Rows.Count > 0 Then
                                CreditTotal = 0 : DebitTotal = 0
                            End If
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            'num = dtdetails.Rows.Count - 1
                            'dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            DebitTotal = 0
                            CreditTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = dtsubheading(j)("Notes")
                                    dr("Headingname") = "<B>" & dtsubheading(j)("headingname") & "</B>"
                                    dr("Notes") = dtsubheading(j)("Notes")
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                                    Else

                                        DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                                    End If
                                    dtdetails.Rows.Add(dr)

                                    TOTalHeading = 0
                                    sSql = ""
                                    sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                                    sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                                    sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                    dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtitem.Rows.Count > 0 Then
                                        For k = 0 To dtitem.Rows.Count - 1
                                            dr = dtdetails.NewRow
                                            dr("SrNo") = i + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                                CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                                                TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                                headingTotal = headingTotal + TOTalHeading
                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                                            Else
                                                DebitTotal = DebitTotal + dtitem(k)("CrTotal")
                                                TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                                headingTotal = headingTotal + TOTalHeading
                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                                            End If
                                            dtdetails.Rows.Add(dr)
                                            'Fetching Item Name
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Desc " & l + 1
                                                        dr("Headingname") = "<i>" & dtdescdetails(l)("ATBUD_Description") & "</i>"
                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            End If
                                        Next
                                    Else
                                        'Fetch desc Under Sub heading
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
                                        sSql = sSql & " from Acc_TrailBalance_Upload "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                                        sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            CreditTotal = 0
                                            DebitTotal = 0
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Desc" & l + 1
                                                    dr("Headingname") = "<i>" & dtdescdetails(l)("ATBUD_Description") & "</i>"
                                                    If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                                                        TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                                        CreditTotal = CreditTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                                                    Else
                                                        TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                                        DebitTotal = DebitTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                                                    End If
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "<B>" & "Total" & "</B>"
                                            If CreditTotal > DebitTotal Then
                                                dr("HeaderSLNo") = "-" & Convert.ToDecimal(CreditTotal - DebitTotal).ToString("#,##0.00")
                                                TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                            Else
                                                dr("HeaderSLNo") = Convert.ToDecimal(DebitTotal - CreditTotal).ToString("#,##0.00")
                                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                            End If
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    End If


                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "Total"
                            'If CreditTotal > DebitTotal Then
                            '    dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                            '    TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                            'Else
                            '    dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                            '    TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                            'End If
                            'dr("HeaderSLNo") = ""
                            'S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                            'headingTotal = 0
                            'dtdetails.Rows.Add(dr)
                        Else
                        End If
                    Next
                    TOTalHeading = 0
                End If
                'dr = dtdetails.NewRow
                'dr("Srno") = 4
                'dr("Headingname") = "<B>" & "Total" & "</B>"
                'dr("SubHeaderSLNo") = ""
                'dr("HeaderSLNo") = S1TotalAllHeadings
                '' S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
                ''  S1TotalAllHeadings = 0
                'dtdetails.Rows.Add(dr)
                'headingTotal = 0

                ' AST_AccHeadId = 2

                'sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                'sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal   from Acc_TrailBalance_Upload_Details "
                'sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
                'sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                'sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                'sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId =2)group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
                'dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                'If dtheading.Rows.Count > 0 Then
                '    DebitTotal = 0
                '    CreditTotal = 0
                '    For i = 0 To dtheading.Rows.Count - 1
                '        If IsDBNull(dtheading(i)("headingname")) = False Then

                '            If IsDBNull(dtheading(i)("headingname")) = False Then
                '                dr = dtdetails.NewRow
                '                dr("SrNo") = i + 1
                '                dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                '                If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                '                    TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                '                    CreditTotal = CreditTotal + TOTalHeading
                '                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                '                Else
                '                    TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                '                    DebitTotal = DebitTotal + TOTalHeading
                '                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                '                End If
                '                '        S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                '                dtdetails.Rows.Add(dr)
                '                TOTalHeading = 0

                '            End If
                '            'Fetch desc under Heading
                '            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                '            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                '            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  from Acc_TrailBalance_Upload"
                '            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                '            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & " And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                '            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                '            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                '            If dtdescdetails.Rows.Count > 0 Then
                '                CreditTotal = 0 : DebitTotal = 0
                '            End If
                '        End If
                '        'Sub Heading
                '        sSql = ""
                '        sSql = ""
                '        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                '        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                '        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                '        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                '        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                '        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                '        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                '        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                '        If dtsubheading.Rows.Count > 0 Then
                '            'num = dtdetails.Rows.Count - 1
                '            'dtdetails(num)("HeaderSLNo") = ""
                '            headingTotal = 0
                '            CreditTotal = 0
                '            DebitTotal = 0
                '            For j = 0 To dtsubheading.Rows.Count - 1
                '                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                '                    dr = dtdetails.NewRow
                '                    dr("SrNo") = dtsubheading(j)("Notes")
                '                    dr("Notes") = dtsubheading(j)("Notes")
                '                    dr("Headingname") = dtsubheading(j)("headingname")
                '                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                '                        CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                '                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                '                        headingTotal = headingTotal + TOTalHeading
                '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                '                    Else
                '                        DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                '                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                '                        headingTotal = headingTotal + TOTalHeading
                '                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                '                    End If
                '                    'dr("HeaderSLNo") = dtsubheading(j)("Total")

                '                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                '                    dtdetails.Rows.Add(dr)

                '                    TOTalHeading = 0
                '                    sSql = ""
                '                    sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                '                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                '                    sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                '                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                '                    sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                '                    dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                '                    If dtitem.Rows.Count > 0 Then
                '                        For k = 0 To dtitem.Rows.Count - 1
                '                            dr = dtdetails.NewRow
                '                            dr("SrNo") = i + 1 & "-" & j + 1 & "-" & k + 1
                '                            dr("Headingname") = dtitem(k)("headingname")
                '                            If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                '                                CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                '                                TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                '                                headingTotal = headingTotal + TOTalHeading
                '                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                '                            Else
                '                                DebitTotal = DebitTotal + dtitem(k)("CrTotal")
                '                                TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                '                                headingTotal = headingTotal + TOTalHeading
                '                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                '                            End If
                '                            dtdetails.Rows.Add(dr)
                '                            'Fetching Item Name
                '                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                '                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                '                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                '                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                '                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                '                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                '                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                '                            If dtdescdetails.Rows.Count > 0 Then
                '                                For l = 0 To dtdescdetails.Rows.Count - 1
                '                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                '                                        dr = dtdetails.NewRow
                '                                        dr("SrNo") = "Desc: " & l + 1
                '                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                '                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                '                                        dtdetails.Rows.Add(dr)
                '                                    End If
                '                                Next
                '                            End If
                '                        Next
                '                    Else
                '                        'Fetch desc Under Sub heading
                '                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
                '                        sSql = sSql & " from Acc_TrailBalance_Upload "
                '                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                '                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & ""
                '                        sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & ""
                '                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                '                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                '                        If dtdescdetails.Rows.Count > 0 Then
                '                            CreditTotal = 0
                '                            DebitTotal = 0
                '                            For l = 0 To dtdescdetails.Rows.Count - 1
                '                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                '                                    dr = dtdetails.NewRow
                '                                    dr("SrNo") = "Desc" & l + 1
                '                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                '                                    If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                '                                        TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                '                                        CreditTotal = CreditTotal + TOTalHeading
                '                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Cr"
                '                                    Else
                '                                        TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                '                                        DebitTotal = DebitTotal + TOTalHeading
                '                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & "Dr"
                '                                    End If
                '                                    '      S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                '                                    dtdetails.Rows.Add(dr)

                '                                End If
                '                            Next
                '                            dr = dtdetails.NewRow
                '                            dr("Srno") = ""
                '                            dr("Headingname") = "<B>" & "Total" & "</B>"
                '                            If CreditTotal > DebitTotal Then
                '                                dr("HeaderSLNo") = "-" & Convert.ToDecimal(CreditTotal - DebitTotal).ToString("#,##0.00")
                '                                TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                '                            Else
                '                                dr("HeaderSLNo") = Convert.ToDecimal(DebitTotal - CreditTotal).ToString("#,##0.00")
                '                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                '                            End If
                '                            S1TotalAllHeadings = S1TotalAllHeadings + dr("HeaderSLNo")
                '                            dtdetails.Rows.Add(dr)
                '                        End If
                '                    End If
                '                End If
                '            Next
                '        Else
                '        End If
                '    Next

                'End If
                TOTalHeading = 0
                dr = dtdetails.NewRow
                dr("Srno") = ""
                dr("Headingname") = "<B>" & "Total" & "</B>"
                If CreditTotal > DebitTotal Then
                    dr("HeaderSLNo") = "-" & Convert.ToDecimal(CreditTotal - DebitTotal).ToString("#,##0.00")
                Else
                    dr("HeaderSLNo") = Convert.ToDecimal(DebitTotal - CreditTotal).ToString("#,##0.00")
                End If
                S3TotalAllHeadings = dr("HeaderSLNo")
                S1TotalAllHeadings = 0
                dtdetails.Rows.Add(dr)
                headingTotal = 0
                TOTalHeadingCr = 0
                TOTalHeadingDb = 0
            End If
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getPAndLNonlmt(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iReportType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            'Heading
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,"
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total "
            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
            sSql = sSql & " group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid "
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            If iReportType = 1 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(m)("ATBUD_Headingid") & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then

                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "STotal"
                            'dr("SubHeaderSLNo") = S2TotalAllHeadings
                            'dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            'dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_SubItemId<>0 and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    num = dtdetails.Rows.Count - 1
                                    headingTotal = 0
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            ElseIf iReportType = 2 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtheading.Rows.Count > 0 Then
                                For l = 0 To dtdescdetails.Rows.Count - 1
                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = "Description" & l + 1
                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                        'dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                        'Sub heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(m)("ATBUD_Headingid") & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = headingTotal + dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                    'Fetch desc Under Sub heading
                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                    sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & ""
                                    sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtdescdetails.Rows.Count > 0 Then
                                        For l = 0 To dtdescdetails.Rows.Count - 1
                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("SrNo") = "Description: " & l + 1
                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            'dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                            'Fetch desc under item
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & ""
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Description: " & l + 1
                                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            End If
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "STotal"
                            'dr("SubHeaderSLNo") = S2TotalAllHeadings
                            'dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            'dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_SubItemId<>0 and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                num = dtdetails.Rows.Count - 1
                                headingTotal = 0
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        'dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                        sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & ""
                                        sSql = sSql & " and b.ATBUD_Subheading=0 and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Description: " & l + 1
                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            End If

            dr = dtdetails.NewRow
            dr("Srno") = ""
            dr("Headingname") = "Grand Total"
            dr("HeaderSLNo") = ""
            dr("SubHeaderSLNo") = S2TotalAllHeadings
            S1TotalAllHeadings = 0
            dtdetails.Rows.Add(dr)
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function

    'Public Function getPAndL(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iCompanyTypeid As Integer) As DataTable
    '    Dim sSql As String : Dim dtheading, dtdetails As New DataTable
    '    Dim dtitem As New DataTable
    '    Dim dtsubheading As New DataTable
    '    Dim dtSubitem As New DataTable
    '    Dim dr As DataRow
    '    Dim IdeciTotal As String = ""
    '    Dim headingTotal As Double = 0
    '    Dim TotalAllHeadings As Double = 0
    '    Dim tot1 As Double = 0
    '    Dim tot2 As Double = 0
    '    Dim Total_FRm_Manufacturing As Double = 0
    '    Dim Total As Double = 0
    '    Dim Total3 As Double = 0
    '    Dim TotalHeading1 As Double = 0
    '    Try
    '        dtdetails.Columns.Add("SrNo")
    '        dtdetails.Columns.Add("Headingname")
    '        dtdetails.Columns.Add("HeaderSLNo")
    '        dtdetails.Columns.Add("SubHeaderSLNo")
    '        sSql = "select distinct(AST_HeadingID), a.ash_Name as headingname from ACC_ScheduleTemplates"
    '        sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  AST_HeadingID"
    '        sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_Headingid= AST_HeadingID and c.ATBUD_CustId=" & ICustid & ""
    '        sSql = sSql & "left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
    '        sSql = sSql & " where AST_Schedule_type in (1,2,3) and AST_compid = " & iACID & ""
    '        dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        If dtheading.Rows.Count > 0 Then
    '            For i = 0 To dtheading.Rows.Count - 1
    '                If IsDBNull(dtheading(i)("headingname")) = False Then
    '                    dr = dtdetails.NewRow
    '                    dr("SrNo") = i + 1
    '                    dr("Headingname") = dtheading(i)("headingname")
    '                    dtdetails.Rows.Add(dr)
    '                End If
    '                sSql = ""
    '                sSql = " select distinct(AST_SubHeadingID),a.ASSH_Name as headingname from ACC_ScheduleTemplates "
    '                sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= AST_SubHeadingID"
    '                sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_Subheading= AST_SubHeadingID and c.ATBUD_CustId=" & ICustid & ""
    '                sSql = sSql & "left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
    '                sSql = sSql & " where  AST_HeadingID= " & dtheading(i)("AST_HeadingID") & " and AST_Schedule_type in (1,2,3)"
    '                dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                If dtsubheading.Rows.Count > 0 Then
    '                    For j = 0 To dtsubheading.Rows.Count - 1
    '                        If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                            dr = dtdetails.NewRow
    '                            dr("SrNo") = i + 1 & "-" & j + 1
    '                            dr("Headingname") = dtsubheading(j)("headingname")
    '                            dtdetails.Rows.Add(dr)
    '                        End If
    '                        sSql = ""
    '                        sSql = " select distinct(AST_ItemID),a.ASI_Name as headingname, ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_Debit_Amount),0)  as Total from ACC_ScheduleTemplates "
    '                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID"
    '                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID"
    '                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
    '                        sSql = sSql & " where AST_HeadingID=" & dtheading(i)("AST_HeadingID") & " And AST_SubHeadingID= " & dtsubheading(j)("AST_SubHeadingID") & " and AST_Schedule_type in (1,2,3)group by AST_ItemID,a.ASI_Name"
    '                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtitem.Rows.Count > 0 Then
    '                            For k = 0 To dtitem.Rows.Count - 1
    '                                If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
    '                                    dr("Headingname") = dtitem(k)("headingname")
    '                                    dr("HeaderSLNo") = dtitem(k)("Total")
    '                                    headingTotal = headingTotal + dtitem(k)("Total")
    '                                    TotalAllHeadings = TotalAllHeadings + dtitem(k)("Total")
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                                sSql = ""
    '                                sSql = sSql & " select distinct(AST_SubItemID),a.ASSI_Name as headingname, ISNULL(Sum(d.ATBU_Closing_Credit_Amount+d.ATBU_Closing_Debit_Amount),0)  as Total from ACC_ScheduleTemplates "
    '                                sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= AST_SubItemID "
    '                                sSql = sSql & " left join Acc_TrailBalance_Upload_Details c on ATBUD_SubItemId= AST_SubItemID "
    '                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid "
    '                                sSql = sSql & " where AST_HeadingID=" & dtheading(i)("AST_HeadingID") & " And AST_SubHeadingID= " & dtsubheading(j)("AST_SubHeadingID") & " And AST_SubItemID<>0 And AST_Itemid = " & dtitem.Rows(k)("AST_ItemID") & " And AST_Schedule_type in (1,2,3)group by AST_SubItemID,a.ASSI_Name"
    '                                dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtSubitem.Rows.Count > 0 Then
    '                                    For L = 0 To dtSubitem.Rows.Count - 1
    '                                        If IsDBNull(dtSubitem(L)("headingname")) = False Then
    '                                            dr = dtdetails.NewRow
    '                                            dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & L + 1
    '                                            dr("Headingname") = dtSubitem(L)("headingname")
    '                                            dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                            headingTotal = headingTotal + dtSubitem(L)("Total")
    '                                            TotalAllHeadings = TotalAllHeadings + dtSubitem(L)("Total")
    '                                            dtdetails.Rows.Add(dr)
    '                                            dr = dtdetails.NewRow
    '                                            dr("Srno") = ""
    '                                            dr("Headingname") = "<B>" & "Total" & "</B>"
    '                                            dr("SubHeaderSLNo") = headingTotal
    '                                            dr("HeaderSLNo") = ""
    '                                            headingTotal = 0
    '                                            dtdetails.Rows.Add(dr)
    '                                        End If
    '                                    Next
    '                                Else
    '                                    'dr = dtdetails.NewRow
    '                                    'dr("Srno") = ""
    '                                    'dr("Headingname") = "<B>" & "Total" & "</B>"
    '                                    'dr("SubHeaderSLNo") = headingTotal
    '                                    'dr("HeaderSLNo") = ""
    '                                    'headingTotal = 0
    '                                    'dtdetails.Rows.Add(dr)
    '                                End If
    '                            Next
    '                        End If
    '                    Next
    '                Else
    '                    sSql = " select distinct(AST_ItemID),a.ASI_Name Sum(d.ATBU_Closing_Credit_Amount+d.ATBU_Closing_Debit_Amount) as Total from ACC_ScheduleTemplates "
    '                    sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= AST_ItemID left join Acc_TrailBalance_Upload_Details c on ATBUD_itemid= AST_ItemID
    '                                        left join Acc_TrailBalance_Upload d on d.ATBU_ID = c.ATBUD_Masid"
    '                    sSql = sSql & " where AST_HeadingID=" & dtheading(i)("AST_HeadingID") & " And AST_SubHeadingID=0 And AST_ItemID<>0 and AST_Schedule_type in (1,2,3) group by AST_ItemID,a.ASI_Name"
    '                    dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtitem.Rows.Count > 0 Then
    '                        For k = 0 To dtitem.Rows.Count - 1
    '                            If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
    '                                dr("Headingname") = dtitem(k)("headingname")
    '                                dr("HeaderSLNo") = dtitem(k)("Total")
    '                                headingTotal = headingTotal + dtitem(k)("Total")
    '                                TotalAllHeadings = TotalAllHeadings + dtitem(k)("Total")
    '                                dtdetails.Rows.Add(dr)
    '                            End If
    '                        Next
    '                        dr = dtdetails.NewRow
    '                        dr("Srno") = ""
    '                        dr("Headingname") = "<B>" & "Total" & "</B>"
    '                        dr("SubHeaderSLNo") = headingTotal
    '                        dr("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        dtdetails.Rows.Add(dr)
    '                    End If
    '                End If
    '            Next
    '            'For i = 0 To dtdetails.Rows.Count - 1
    '            '    If dtdetails.Rows(i)("SrNo").ToString = "8" Then
    '            '        dtdetails.Rows(i + 1)("SubHeaderSLNo") = Total_FRm_Manufacturing
    '            '    End If
    '            '    If dtdetails.Rows(i)("Headingname") = "<B>" & "Total" & "</B>" Then
    '            '        Total = Total + dtdetails.Rows(i)("SubHeaderSLNo")
    '            '    End If
    '            '    If dtdetails.Rows(i)("SrNo").ToString = "3" Then
    '            '        dtdetails.Rows(i + 1)("SubHeaderSLNo") = Total
    '            '    End If
    '            '    If dtdetails.Rows(i)("Srno").ToString = "9" Then
    '            '        dtdetails.Rows(i + 1)("SubHeaderSLNo") = "-24,90,598.50"
    '            '    End If
    '            'Next
    '        End If
    '        Total = Total + 1
    '        Return dtdetails
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    'karthik 
    'Public Function getBalSheet(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iCompanyTypeid As Integer, ByVal iRepType As Integer) As DataTable
    '    Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
    '    Dim dtitem As New DataTable
    '    Dim dtsubheading As New DataTable
    '    Dim dtSubitem As New DataTable
    '    Dim dr As DataRow
    '    Dim IdeciTotal As String = ""
    '    Dim headingTotal As Double = 0
    '    Dim S1TotalAllHeadings As Double = 0
    '    Dim S2TotalAllHeadings As Double = 0
    '    Dim S3TotalAllHeadings As Double = 0
    '    Dim tot1 As Double = 0
    '    Dim tot2 As Double = 0
    '    Dim Total_FRm_Manufacturing As Double = 0
    '    Dim Total As Double = 0
    '    Dim Total3 As Double = 0
    '    Dim TotalHeading1 As Double = 0
    '    Dim num As Integer = 0
    '    Dim TOTalHeading As Double = 0
    '    Dim TOTalHeadingDb As Double = 0
    '    Dim TOTalHeadingCr As Double = 0
    '    Dim CreditTotal As Double = 0
    '    Dim DebitTotal As Double = 0
    '    Try
    '        dtdetails.Columns.Add("SrNo")
    '        dtdetails.Columns.Add("Headingname")
    '        dtdetails.Columns.Add("HeaderSLNo")
    '        dtdetails.Columns.Add("SubHeaderSLNo")
    '        'AST_AccHeadId =1 
    '        sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname, "
    '        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
    '        sSql = sSql & "  from Acc_TrailBalance_Upload_Details"
    '        sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
    '        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '        sSql = sSql & " left join ACC_ScheduleTemplates b on AST_HeadingID = ATBUD_Headingid "
    '        sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " and b.AST_AccHeadId =1 And ATBUD_CustId=" & ICustid & ""
    '        sSql = sSql & " group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
    '        dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        dr = dtdetails.NewRow
    '        dr("SrNo") = ""
    '        dr("Headingname") = "<B>" & "SOURCE OF FUNDS" & "</B>"
    '        dtdetails.Rows.Add(dr)
    '        If iRepType = 1 Then
    '            If dtheading.Rows.Count > 0 Then
    '                For i = 0 To dtheading.Rows.Count - 1
    '                    If IsDBNull(dtheading(i)("headingname")) = False Then
    '                        dr = dtdetails.NewRow
    '                        dr("SrNo") = i + 1
    '                        dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
    '                        If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
    '                            'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
    '                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
    '                            CreditTotal = CreditTotal + TOTalHeading
    '                            dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                        Else
    '                            'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
    '                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
    '                            DebitTotal = DebitTotal + TOTalHeading
    '                            dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                        End If
    '                        'S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
    '                        dtdetails.Rows.Add(dr)
    '                    End If
    '                    'Sub Heading
    '                    sSql = ""
    '                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
    '                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
    '                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
    '                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
    '                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtsubheading.Rows.Count > 0 Then
    '                        num = dtdetails.Rows.Count - 1
    '                        dtdetails(num)("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        For j = 0 To dtsubheading.Rows.Count - 1
    '                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = i + 1 & "-" & j + 1
    '                                dr("Headingname") = dtsubheading(j)("headingname")
    '                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                    'CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
    '                                    CreditTotal = 0
    '                                    TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
    '                                    CreditTotal = CreditTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                Else
    '                                    'DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
    '                                    DebitTotal = 0
    '                                    TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                    DebitTotal = DebitTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                End If
    '                                'dr("HeaderSLNo") = dtsubheading(j)("Total")
    '                                'headingTotal = TOTalHeading
    '                                S2TotalAllHeadings = S2TotalAllHeadings + TOTalHeading
    '                                dtdetails.Rows.Add(dr)
    '                            End If
    '                            'item
    '                            sSql = ""
    '                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
    '                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
    '                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                            sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                            Dim z As Integer = 0
    '                            If dtitem.Rows.Count > 0 Then
    '                                z = z + 1
    '                                num = dtdetails.Rows.Count - 1
    '                                dtdetails(num)("HeaderSLNo") = ""
    '                                headingTotal = 0
    '                                For k = 0 To dtitem.Rows.Count - 1
    '                                    headingTotal = 0
    '                                    If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
    '                                        dr("Headingname") = dtitem(k)("headingname")
    '                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                            CreditTotal = 0
    '                                            'CreditTotal = CreditTotal + dtitem(k)("CrTotal")
    '                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                            CreditTotal = CreditTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                        Else
    '                                            DebitTotal = 0
    '                                            'DebitTotal = DebitTotal + dtitem(k)("DbTotal")
    '                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                            DebitTotal = DebitTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                        End If
    '                                        'dr("HeaderSLNo") = dtitem(k)("Total")
    '                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                        dtdetails.Rows.Add(dr)
    '                                    End If
    '                                    'Sub item
    '                                    sSql = ""
    '                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
    '                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
    '                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    If dtSubitem.Rows.Count > 0 Then
    '                                        For L = 0 To dtSubitem.Rows.Count - 1
    '                                            num = dtdetails.Rows.Count - 1
    '                                            dtdetails(num)("HeaderSLNo") = ""
    '                                            headingTotal = 0
    '                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
    '                                                dr = dtdetails.NewRow
    '                                                dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
    '                                                dr("Headingname") = dtSubitem(L)("headingname")
    '                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
    '                                                    'CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
    '                                                    CreditTotal = 0
    '                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
    '                                                    CreditTotal = CreditTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                                Else
    '                                                    'DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
    '                                                    DebitTotal = 0
    '                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
    '                                                    DebitTotal = DebitTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                                End If
    '                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                'headingTotal = headingTotal + TOTalHeading
    '                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                dtdetails.Rows.Add(dr)
    '                                            End If
    '                                        Next
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = ""
    '                                        dr("Headingname") = "Total"
    '                                        If CreditTotal > DebitTotal Then
    '                                            dr("SubHeaderSLNo") = "-" & (CreditTotal)
    '                                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
    '                                        Else
    '                                            dr("SubHeaderSLNo") = (DebitTotal)
    '                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
    '                                        End If
    '                                        'dr("SubHeaderSLNo") = headingTotal
    '                                        dr("HeaderSLNo") = ""
    '                                        headingTotal = 0
    '                                        dtdetails.Rows.Add(dr)
    '                                        S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
    '                                    Else
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = ""
    '                                        dr("Headingname") = "Total"
    '                                        If CreditTotal > DebitTotal Then
    '                                            dr("SubHeaderSLNo") = "-" & (CreditTotal)
    '                                            TOTalHeadingCr = TOTalHeadingCr + (DebitTotal)
    '                                        Else
    '                                            dr("SubHeaderSLNo") = (DebitTotal)
    '                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
    '                                        End If
    '                                        'dr("SubHeaderSLNo") = headingTotal
    '                                        dr("HeaderSLNo") = ""
    '                                        headingTotal = 0
    '                                        dtdetails.Rows.Add(dr)
    '                                        S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
    '                                    End If
    '                                Next
    '                            Else
    '                                dr = dtdetails.NewRow
    '                                dr("Srno") = ""
    '                                dr("Headingname") = "Total"
    '                                If CreditTotal > DebitTotal Then
    '                                    dr("SubHeaderSLNo") = "-" & (CreditTotal)
    '                                    TOTalHeadingCr = TOTalHeadingCr + (DebitTotal)
    '                                Else
    '                                    dr("SubHeaderSLNo") = (DebitTotal)
    '                                    TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
    '                                End If
    '                                'dr("SubHeaderSLNo") = headingTotal
    '                                dr("HeaderSLNo") = ""
    '                                headingTotal = 0
    '                                dtdetails.Rows.Add(dr)
    '                                S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
    '                            End If
    '                        Next
    '                    Else
    '                        'item
    '                        sSql = ""
    '                        sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
    '                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                        sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtitem.Rows.Count > 0 Then
    '                            num = dtdetails.Rows.Count - 1
    '                            dtdetails(num)("HeaderSLNo") = ""
    '                            DebitTotal = 0
    '                            For k = 0 To dtitem.Rows.Count - 1
    '                                If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
    '                                    dr("Headingname") = dtitem(k)("headingname")
    '                                    If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                        CreditTotal = 0
    '                                        TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                        CreditTotal = CreditTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                    Else
    '                                        DebitTotal = 0
    '                                        TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                        DebitTotal = DebitTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                    End If
    '                                    'dr("HeaderSLNo") = dtitem(k)("Total")

    '                                    'headingTotal = headingTotal + TOTalHeading
    '                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                    S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                Next
    '            End If

    '            dr = dtdetails.NewRow
    '            dr("Srno") = ""
    '            dr("Headingname") = "<B>" & "Total" & "</B>"
    '            If CreditTotal > DebitTotal Then
    '                dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
    '            Else
    '                dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
    '            End If
    '            dr("HeaderSLNo") = ""
    '            S3TotalAllHeadings = dr("SubHeaderSLNo")
    '            S1TotalAllHeadings = 0
    '            dtdetails.Rows.Add(dr)
    '            headingTotal = 0
    '            ' AST_AccHeadId = 2
    '            CreditTotal = 0
    '            DebitTotal = 0
    '            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname, "
    '            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal"
    '            sSql = sSql & "  from Acc_TrailBalance_Upload_Details"
    '            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
    '            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '            sSql = sSql & " left join ACC_ScheduleTemplates b on AST_HeadingID = ATBUD_Headingid "
    '            sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " and b.AST_AccHeadId =2 And ATBUD_CustId=" & ICustid & ""
    '            sSql = sSql & " group by ATBUD_Headingid,ash_Name"
    '            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '            If dtheading.Rows.Count > 0 Then
    '                dr = dtdetails.NewRow
    '                dr("SrNo") = ""
    '                dr("Headingname") = "<B>" & "APPLICATION OF FUNDS" & "</B>"
    '                dtdetails.Rows.Add(dr)
    '                For i = 0 To dtheading.Rows.Count - 1
    '                    If IsDBNull(dtheading(i)("headingname")) = False Then
    '                        dr = dtdetails.NewRow
    '                        dr("SrNo") = i + 1
    '                        dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
    '                        If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
    '                            'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
    '                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
    '                            CreditTotal = CreditTotal + TOTalHeading
    '                            dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                        Else
    '                            'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
    '                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
    '                            DebitTotal = DebitTotal + TOTalHeading
    '                            dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                        End If
    '                        S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
    '                        dtdetails.Rows.Add(dr)
    '                    End If
    '                    'Sub Heading
    '                    sSql = ""
    '                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
    '                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
    '                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
    '                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name"
    '                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtsubheading.Rows.Count > 0 Then
    '                        num = dtdetails.Rows.Count - 1
    '                        dtdetails(num)("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        For j = 0 To dtsubheading.Rows.Count - 1
    '                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = i + 1 & "-" & j + 1
    '                                dr("Headingname") = dtsubheading(j)("headingname")
    '                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                    'CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
    '                                    CreditTotal = 0
    '                                    TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
    '                                    CreditTotal = CreditTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                Else
    '                                    'DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
    '                                    DebitTotal = 0
    '                                    TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                    DebitTotal = DebitTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                End If
    '                                'dr("HeaderSLNo") = dtsubheading(j)("Total")
    '                                'headingTotal = TOTalHeading
    '                                'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
    '                                dtdetails.Rows.Add(dr)
    '                            End If
    '                            'item
    '                            sSql = ""
    '                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
    '                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
    '                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                            sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                            Dim z As Integer = 0
    '                            If dtitem.Rows.Count > 0 Then
    '                                z = z + 1
    '                                num = dtdetails.Rows.Count - 1
    '                                dtdetails(num)("HeaderSLNo") = ""
    '                                headingTotal = 0
    '                                For k = 0 To dtitem.Rows.Count - 1
    '                                    headingTotal = 0
    '                                    If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
    '                                        dr("Headingname") = dtitem(k)("headingname")
    '                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                            CreditTotal = 0
    '                                            'CreditTotal = CreditTotal + dtitem(k)("CrTotal")
    '                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                            CreditTotal = CreditTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                        Else
    '                                            DebitTotal = 0
    '                                            'DebitTotal = DebitTotal + dtitem(k)("DbTotal")
    '                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                            DebitTotal = DebitTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                        End If
    '                                        'dr("HeaderSLNo") = dtitem(k)("Total")
    '                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                        dtdetails.Rows.Add(dr)
    '                                    End If
    '                                    'Sub item
    '                                    sSql = ""
    '                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
    '                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
    '                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    If dtSubitem.Rows.Count > 0 Then
    '                                        For L = 0 To dtSubitem.Rows.Count - 1
    '                                            num = dtdetails.Rows.Count - 1
    '                                            dtdetails(num)("HeaderSLNo") = ""
    '                                            headingTotal = 0
    '                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
    '                                                dr = dtdetails.NewRow
    '                                                dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
    '                                                dr("Headingname") = dtSubitem(L)("headingname")
    '                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
    '                                                    'CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
    '                                                    CreditTotal = 0
    '                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
    '                                                    CreditTotal = CreditTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                                Else
    '                                                    'DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
    '                                                    DebitTotal = 0
    '                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
    '                                                    DebitTotal = DebitTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                                End If
    '                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                'headingTotal = headingTotal + TOTalHeading
    '                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                dtdetails.Rows.Add(dr)
    '                                            End If
    '                                        Next
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = ""
    '                                        dr("Headingname") = "<B>" & "Total" & "</B>"
    '                                        If CreditTotal > DebitTotal Then
    '                                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
    '                                        Else
    '                                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
    '                                        End If
    '                                        dr("HeaderSLNo") = ""
    '                                        S3TotalAllHeadings = dr("SubHeaderSLNo")
    '                                        S1TotalAllHeadings = 0
    '                                        dtdetails.Rows.Add(dr)
    '                                        headingTotal = 0
    '                                        CreditTotal = 0
    '                                        DebitTotal = 0
    '                                    Else
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = ""
    '                                        dr("Headingname") = "Total"
    '                                        If CreditTotal > DebitTotal Then
    '                                            dr("SubHeaderSLNo") = "-" & (CreditTotal)
    '                                            TOTalHeadingCr = TOTalHeadingCr + (DebitTotal)
    '                                        Else
    '                                            dr("SubHeaderSLNo") = (DebitTotal)
    '                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
    '                                        End If
    '                                        'dr("SubHeaderSLNo") = headingTotal
    '                                        dr("HeaderSLNo") = ""
    '                                        headingTotal = 0
    '                                        dtdetails.Rows.Add(dr)
    '                                        CreditTotal = 0
    '                                        DebitTotal = 0
    '                                        S3TotalAllHeadings = S3TotalAllHeadings + dr("SubHeaderSLNo")
    '                                    End If
    '                                Next
    '                            Else
    '                                dr = dtdetails.NewRow
    '                                dr("Srno") = ""
    '                                dr("Headingname") = "Total"
    '                                If CreditTotal > DebitTotal Then
    '                                    dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
    '                                    TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
    '                                Else
    '                                    dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
    '                                    TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
    '                                End If
    '                                'dr("SubHeaderSLNo") = headingTotal
    '                                dr("HeaderSLNo") = ""
    '                                headingTotal = 0
    '                                dtdetails.Rows.Add(dr)
    '                                CreditTotal = 0
    '                                DebitTotal = 0
    '                                S3TotalAllHeadings = S3TotalAllHeadings + dr("SubHeaderSLNo")
    '                            End If
    '                        Next
    '                    Else
    '                        'item
    '                        sSql = ""
    '                        sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
    '                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                        sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtitem.Rows.Count > 0 Then
    '                            num = dtdetails.Rows.Count - 1
    '                            dtdetails(num)("HeaderSLNo") = ""
    '                            For k = 0 To dtitem.Rows.Count - 1
    '                                If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
    '                                    dr("Headingname") = dtitem(k)("headingname")
    '                                    If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                        CreditTotal = 0
    '                                        TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                        CreditTotal = CreditTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                    Else
    '                                        DebitTotal = 0
    '                                        TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                        DebitTotal = DebitTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                    End If
    '                                    'dr("HeaderSLNo") = dtitem(k)("Total")

    '                                    'headingTotal = headingTotal + TOTalHeading
    '                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                    S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                Next
    '            End If

    '            dr = dtdetails.NewRow
    '            dr("Srno") = ""
    '            dr("Headingname") = "<B>" & "Grand Total" & "</B>"
    '            'If TOTalHeadingCr > TOTalHeadingDb Then
    '            '    dr("SubHeaderSLNo") = "-" & (TOTalHeadingCr - TOTalHeadingDb)
    '            'Else
    '            '    dr("SubHeaderSLNo") = (TOTalHeadingDb - TOTalHeadingCr)
    '            'End If
    '            dr("SubHeaderSLNo") = S3TotalAllHeadings
    '            dr("HeaderSLNo") = ""
    '            S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
    '            S1TotalAllHeadings = 0
    '            dtdetails.Rows.Add(dr)
    '            headingTotal = 0
    '            TOTalHeadingCr = 0
    '            TOTalHeadingDb = 0
    '        ElseIf iRepType = 2 Then
    '            If dtheading.Rows.Count > 0 Then
    '                For i = 0 To dtheading.Rows.Count - 1
    '                    If IsDBNull(dtheading(i)("headingname")) = False Then

    '                        If IsDBNull(dtheading(i)("headingname")) = False Then
    '                            dr = dtdetails.NewRow
    '                            dr("SrNo") = i + 1
    '                            dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
    '                            If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
    '                                'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
    '                                TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
    '                                CreditTotal = CreditTotal + TOTalHeading
    '                                dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                            Else
    '                                'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
    '                                TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
    '                                DebitTotal = DebitTotal + TOTalHeading
    '                                dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                            End If
    '                            S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
    '                            dtdetails.Rows.Add(dr)
    '                        End If
    '                        'Fetch desc under Heading
    '                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
    '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
    '                        sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
    '                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
    '                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtheading.Rows.Count > 0 Then
    '                            For l = 0 To dtdescdetails.Rows.Count - 1
    '                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("SrNo") = "Description" & l + 1
    '                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                    'Sub Heading
    '                    sSql = ""
    '                    sSql = ""
    '                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
    '                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
    '                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
    '                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
    '                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtsubheading.Rows.Count > 0 Then
    '                        num = dtdetails.Rows.Count - 1
    '                        dtdetails(num)("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        For j = 0 To dtsubheading.Rows.Count - 1
    '                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = i + 1 & "-" & j + 1
    '                                dr("Headingname") = dtsubheading(j)("headingname")
    '                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                    CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
    '                                    TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                Else
    '                                    DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
    '                                    TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                End If
    '                                'dr("HeaderSLNo") = dtsubheading(j)("Total")
    '                                headingTotal = TOTalHeading
    '                                'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
    '                                dtdetails.Rows.Add(dr)
    '                                'Fetch desc Under Sub heading
    '                                sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
    '                                sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
    '                                sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
    '                                sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
    '                                sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
    '                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtdescdetails.Rows.Count > 0 Then
    '                                    For l = 0 To dtdescdetails.Rows.Count - 1
    '                                        If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                            dr = dtdetails.NewRow
    '                                            dr("SrNo") = "Description: " & l + 1
    '                                            dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                            dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                            dtdetails.Rows.Add(dr)
    '                                        End If
    '                                    Next
    '                                End If
    '                            End If
    '                            'Item
    '                            sSql = ""

    '                            sSql = ""
    '                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
    '                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
    '                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                            sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                            Dim z As Integer = 0
    '                            If dtitem.Rows.Count > 0 Then
    '                                z = z + 1
    '                                num = dtdetails.Rows.Count - 1
    '                                dtdetails(num)("HeaderSLNo") = ""
    '                                headingTotal = 0
    '                                For k = 0 To dtitem.Rows.Count - 1
    '                                    If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
    '                                        dr("Headingname") = dtitem(k)("headingname")
    '                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                            CreditTotal = CreditTotal + dtitem(k)("CrTotal")
    '                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                        Else
    '                                            DebitTotal = DebitTotal + dtitem(k)("DbTotal")
    '                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                        End If
    '                                        'dr("HeaderSLNo") = dtitem(k)("Total")
    '                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                        dtdetails.Rows.Add(dr)
    '                                        'Fetching Item Name
    '                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
    '                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
    '                                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
    '                                        sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
    '                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
    '                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtdescdetails.Rows.Count > 0 Then
    '                                            For l = 0 To dtdescdetails.Rows.Count - 1
    '                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                    dr = dtdetails.NewRow
    '                                                    dr("SrNo") = "Description: " & l + 1
    '                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                    dtdetails.Rows.Add(dr)
    '                                                End If
    '                                            Next
    '                                        End If
    '                                    End If
    '                                    'Sub item
    '                                    sSql = ""
    '                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
    '                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
    '                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    If dtSubitem.Rows.Count > 0 Then
    '                                        For L = 0 To dtSubitem.Rows.Count - 1
    '                                            num = dtdetails.Rows.Count - 1
    '                                            dtdetails(num)("HeaderSLNo") = ""
    '                                            headingTotal = 0
    '                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
    '                                                dr = dtdetails.NewRow
    '                                                dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
    '                                                dr("Headingname") = dtSubitem(L)("headingname")
    '                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
    '                                                    CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
    '                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                                Else
    '                                                    DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
    '                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                                End If
    '                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                headingTotal = headingTotal + TOTalHeading
    '                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                dtdetails.Rows.Add(dr)
    '                                                'Fetch desc Under Sub item
    '                                                sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
    '                                                sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                                sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubItems a on a.ASSI_ID=  b.ATBUD_SubItemId"
    '                                                sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid")
    '                                                sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid")
    '                                                sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
    '                                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                                If dtdescdetails.Rows.Count > 0 Then
    '                                                    For m = 0 To dtdescdetails.Rows.Count - 1
    '                                                        If IsDBNull(dtdescdetails(L)("ATBUD_Description")) = False Then
    '                                                            dr = dtdetails.NewRow
    '                                                            dr("SrNo") = "Description: " & L + 1
    '                                                            dr("Headingname") = dtdescdetails(m)("ATBUD_Description")
    '                                                            dr("HeaderSLNo") = dtdescdetails(m)("Total")
    '                                                            dtdetails.Rows.Add(dr)
    '                                                        End If
    '                                                    Next
    '                                                End If
    '                                            End If
    '                                        Next
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = ""
    '                                        dr("Headingname") = "Total"
    '                                        dr("SubHeaderSLNo") = headingTotal
    '                                        dr("HeaderSLNo") = ""
    '                                        headingTotal = 0
    '                                        dtdetails.Rows.Add(dr)
    '                                    Else
    '                                    End If
    '                                Next
    '                            Else
    '                            End If
    '                        Next
    '                        dr = dtdetails.NewRow
    '                        dr("Srno") = ""
    '                        dr("Headingname") = "Total"
    '                        dr("SubHeaderSLNo") = headingTotal
    '                        dr("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        dtdetails.Rows.Add(dr)
    '                    Else
    '                        'item
    '                        sSql = ""
    '                        sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
    '                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                        sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtitem.Rows.Count > 0 Then
    '                            For k = 0 To dtitem.Rows.Count - 1
    '                                num = dtdetails.Rows.Count - 1
    '                                dtdetails(num)("HeaderSLNo") = ""
    '                                If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
    '                                    dr("Headingname") = dtitem(k)("headingname")
    '                                    If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                        TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                        headingTotal = headingTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                    Else
    '                                        TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                        headingTotal = headingTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                    End If
    '                                    'dr("HeaderSLNo") = dtitem(k)("Total")

    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                    S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
    '                                    dtdetails.Rows.Add(dr)
    '                                    'Fetching Items under Subitem Heading
    '                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
    '                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
    '                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
    '                                    sSql = sSql & " and ATBUD_Subheading=0 And ATBUD_itemid<>0 and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & ""
    '                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
    '                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    If dtdescdetails.Rows.Count > 0 Then
    '                                        For l = 0 To dtdescdetails.Rows.Count - 1
    '                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                dr = dtdetails.NewRow
    '                                                dr("SrNo") = "Description: " & l + 1
    '                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                                dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                dtdetails.Rows.Add(dr)
    '                                            End If
    '                                        Next
    '                                    End If
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                Next
    '            End If
    '            dr = dtdetails.NewRow
    '            dr("Srno") = 4
    '            dr("Headingname") = "<B>" & "Source Of Funds" & "</B>"
    '            dr("SubHeaderSLNo") = S1TotalAllHeadings
    '            dr("HeaderSLNo") = ""
    '            S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
    '            S1TotalAllHeadings = 0
    '            dtdetails.Rows.Add(dr)
    '            headingTotal = 0
    '            ' AST_AccHeadId = 2

    '            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname, "
    '            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal"
    '            sSql = sSql & "  from Acc_TrailBalance_Upload_Details"
    '            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
    '            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '            sSql = sSql & " left join ACC_ScheduleTemplates b on AST_HeadingID = ATBUD_Headingid "
    '            sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " and b.AST_AccHeadId =2 And ATBUD_CustId=" & ICustid & ""
    '            sSql = sSql & " group by ATBUD_Headingid,ash_Name order by ATBUD_Headingid"
    '            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '            If dtheading.Rows.Count > 0 Then
    '                dr = dtdetails.NewRow
    '                dr("SrNo") = ""
    '                dr("Headingname") = "<B>" & "APPLICATION OF FUNDS" & "</B>"
    '                dtdetails.Rows.Add(dr)
    '                For i = 0 To dtheading.Rows.Count - 1
    '                    If IsDBNull(dtheading(i)("headingname")) = False Then
    '                        dr = dtdetails.NewRow
    '                        dr("SrNo") = i + 1
    '                        dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
    '                        If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
    '                            CreditTotal = CreditTotal + dtheading(i)("CrTotal")
    '                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
    '                            headingTotal = headingTotal + TOTalHeading
    '                            dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                        Else
    '                            DebitTotal = DebitTotal + dtheading(i)("DbTotal")
    '                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
    '                            headingTotal = headingTotal + TOTalHeading
    '                            dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                        End If
    '                        S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
    '                        dtdetails.Rows.Add(dr)
    '                        'Fetch desc under Heading
    '                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
    '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
    '                        sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
    '                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
    '                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtheading.Rows.Count > 0 Then
    '                            For l = 0 To dtdescdetails.Rows.Count - 1
    '                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("SrNo") = "Description" & l + 1
    '                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                    'Sub Heading
    '                    sSql = ""
    '                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
    '                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
    '                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
    '                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
    '                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtsubheading.Rows.Count > 0 Then
    '                        num = dtdetails.Rows.Count - 1
    '                        dtdetails(num)("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        For j = 0 To dtsubheading.Rows.Count - 1
    '                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = i + 1 & "-" & j + 1
    '                                dr("Headingname") = dtsubheading(j)("headingname")
    '                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                    CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
    '                                    TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                Else
    '                                    DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
    '                                    TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                End If
    '                                'dr("HeaderSLNo") = dtsubheading(j)("Total")
    '                                headingTotal = TOTalHeading
    '                                'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
    '                                dtdetails.Rows.Add(dr)
    '                                'Fetch desc Under Sub heading
    '                                sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
    '                                sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
    '                                sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
    '                                sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
    '                                sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
    '                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtdescdetails.Rows.Count > 0 Then
    '                                    For l = 0 To dtdescdetails.Rows.Count - 1
    '                                        If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                            dr = dtdetails.NewRow
    '                                            dr("SrNo") = "Description: " & l + 1
    '                                            dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                            dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                            dtdetails.Rows.Add(dr)
    '                                        End If
    '                                    Next
    '                                End If
    '                            End If
    '                            'Item
    '                            sSql = ""

    '                            sSql = ""
    '                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
    '                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
    '                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                            sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                            Dim z As Integer = 0
    '                            If dtitem.Rows.Count > 0 Then
    '                                z = z + 1
    '                                num = dtdetails.Rows.Count - 1
    '                                dtdetails(num)("HeaderSLNo") = ""
    '                                headingTotal = 0
    '                                For k = 0 To dtitem.Rows.Count - 1
    '                                    If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
    '                                        dr("Headingname") = dtitem(k)("headingname")
    '                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                            CreditTotal = CreditTotal + dtitem(k)("CrTotal")
    '                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                        Else
    '                                            DebitTotal = DebitTotal + dtitem(k)("DbTotal")
    '                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                        End If
    '                                        'dr("HeaderSLNo") = dtitem(k)("Total")
    '                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                        dtdetails.Rows.Add(dr)
    '                                        'Fetching Item Name
    '                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
    '                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
    '                                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
    '                                        sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
    '                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
    '                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtdescdetails.Rows.Count > 0 Then
    '                                            For l = 0 To dtdescdetails.Rows.Count - 1
    '                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                    dr = dtdetails.NewRow
    '                                                    dr("SrNo") = "Description: " & l + 1
    '                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                    dtdetails.Rows.Add(dr)
    '                                                End If
    '                                            Next
    '                                        End If
    '                                    End If
    '                                    'Sub item
    '                                    sSql = ""
    '                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
    '                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
    '                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    If dtSubitem.Rows.Count > 0 Then
    '                                        For L = 0 To dtSubitem.Rows.Count - 1
    '                                            num = dtdetails.Rows.Count - 1
    '                                            dtdetails(num)("HeaderSLNo") = ""
    '                                            headingTotal = 0
    '                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
    '                                                dr = dtdetails.NewRow
    '                                                dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
    '                                                dr("Headingname") = dtSubitem(L)("headingname")
    '                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
    '                                                    CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
    '                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                                Else
    '                                                    DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
    '                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                                End If
    '                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                headingTotal = headingTotal + TOTalHeading
    '                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                dtdetails.Rows.Add(dr)
    '                                                'Fetch desc Under Sub item
    '                                                sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
    '                                                sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                                sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubItems a on a.ASSI_ID=  b.ATBUD_SubItemId"
    '                                                sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid")
    '                                                sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid")
    '                                                sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
    '                                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                                If dtdescdetails.Rows.Count > 0 Then
    '                                                    For m = 0 To dtdescdetails.Rows.Count - 1
    '                                                        If IsDBNull(dtdescdetails(L)("ATBUD_Description")) = False Then
    '                                                            dr = dtdetails.NewRow
    '                                                            dr("SrNo") = "Description: " & L + 1
    '                                                            dr("Headingname") = dtdescdetails(m)("ATBUD_Description")
    '                                                            dr("HeaderSLNo") = dtdescdetails(m)("Total")
    '                                                            dtdetails.Rows.Add(dr)
    '                                                        End If
    '                                                    Next
    '                                                End If
    '                                            End If
    '                                        Next
    '                                        dr = dtdetails.NewRow
    '                                        dr("Srno") = ""
    '                                        dr("Headingname") = "Total"
    '                                        dr("SubHeaderSLNo") = headingTotal
    '                                        dr("HeaderSLNo") = ""
    '                                        headingTotal = 0
    '                                        dtdetails.Rows.Add(dr)
    '                                    Else
    '                                    End If
    '                                Next
    '                            Else
    '                            End If
    '                        Next
    '                        dr = dtdetails.NewRow
    '                        dr("Srno") = ""
    '                        dr("Headingname") = "Total"
    '                        dr("SubHeaderSLNo") = headingTotal
    '                        dr("HeaderSLNo") = ""
    '                        headingTotal = 0
    '                        dtdetails.Rows.Add(dr)
    '                    Else
    '                        'item
    '                        sSql = ""
    '                        sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
    '                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
    '                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                        sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
    '                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtitem.Rows.Count > 0 Then
    '                            For k = 0 To dtitem.Rows.Count - 1
    '                                num = dtdetails.Rows.Count - 1
    '                                dtdetails(num)("HeaderSLNo") = ""
    '                                If IsDBNull(dtitem(k)("headingname")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
    '                                    dr("Headingname") = dtitem(k)("headingname")
    '                                    If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
    '                                        TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
    '                                        headingTotal = headingTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
    '                                    Else
    '                                        TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
    '                                        headingTotal = headingTotal + TOTalHeading
    '                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
    '                                    End If
    '                                    'dr("HeaderSLNo") = dtitem(k)("Total")

    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
    '                                    S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
    '                                    dtdetails.Rows.Add(dr)
    '                                    'Fetching Items under Subitem Heading
    '                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
    '                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
    '                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
    '                                    sSql = sSql & " and ATBUD_Subheading=0 And ATBUD_itemid<>0 and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & ""
    '                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
    '                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    If dtdescdetails.Rows.Count > 0 Then
    '                                        For l = 0 To dtdescdetails.Rows.Count - 1
    '                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                dr = dtdetails.NewRow
    '                                                dr("SrNo") = "Description: " & l + 1
    '                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
    '                                                dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                dtdetails.Rows.Add(dr)
    '                                            End If
    '                                        Next
    '                                    End If
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                Next
    '            End If
    '            'dr = dtdetails.NewRow
    '            'dr("Srno") = 5
    '            'dr("Headingname") = "<B>" & "Application Of Funds" & "</B>"
    '            'dr("HeaderSLNo") = ""
    '            'dr("SubHeaderSLNo") = S2TotalAllHeadings
    '            'S3TotalAllHeadings = S3TotalAllHeadings + S2TotalAllHeadings
    '            'S2TotalAllHeadings = 0
    '            'dtdetails.Rows.Add(dr)
    '            dr = dtdetails.NewRow
    '            dr("Srno") = ""
    '            dr("Headingname") = "<B>" & " Grand Total" & "</B>"
    '            dr("HeaderSLNo") = ""
    '            dr("SubHeaderSLNo") = S3TotalAllHeadings
    '            S3TotalAllHeadings = 0
    '            dtdetails.Rows.Add(dr)
    '        End If
    '        Return dtdetails
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    'Public Function getBalSheet(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iRepType As Integer, ByVal iChkPt As Integer, ByVal iInAmt As Integer) As DataTable
    '    Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
    '    Dim dtitem As New DataTable
    '    Dim dtsubheading As New DataTable
    '    Dim dtSubitem As New DataTable
    '    Dim dr As DataRow
    '    Dim IdeciTotal As String = ""
    '    Dim headingTotal As Double = 0
    '    Dim S1TotalAllHeadings As Double = 0
    '    Dim S2TotalAllHeadings As Double = 0
    '    Dim S3TotalAllHeadings As Double = 0
    '    Dim s4TotalHeadings As Double = 0
    '    Dim s5TotalHeadings As Double = 0
    '    Dim PrevheadingTotal As Double = 0
    '    Dim PrevS1TotalAllHeadings As Double = 0
    '    Dim PrevS2TotalAllHeadings As Double = 0
    '    Dim PrevS3TotalAllHeadings As Double = 0
    '    Dim Prevs4TotalHeadings As Double = 0
    '    Dim Prevs5TotalHeadings As Double = 0
    '    Dim tot1 As Double = 0
    '    Dim tot2 As Double = 0
    '    Dim Total_FRm_Manufacturing As Double = 0
    '    Dim Total As Double = 0
    '    Dim Total3 As Double = 0
    '    Dim TotalHeading1 As Double = 0
    '    Dim num As Integer = 0
    '    Dim TOTalHeading As Double = 0
    '    Dim TOTalHeadingDb As Double = 0
    '    Dim TOTalHeadingCr As Double = 0
    '    Dim CreditTotal As Double = 0
    '    Dim DebitTotal As Double = 0
    '    Dim PrevTOTalHeading As Double = 0
    '    Dim PrevTOTalHeadingDb As Double = 0
    '    Dim PrevTOTalHeadingCr As Double = 0
    '    Dim PrevCreditTotal As Double = 0
    '    Dim PrevDebitTotal As Double = 0
    '    Dim subCreditTotal As Double = 0
    '    Dim subDebitTotal As Double = 0
    '    Dim inc As Integer = 0
    '    Dim StockEntry As Double = 0
    '    Dim dPandLamt As Double = 0.0
    '    Dim dPrevPandLamt As Double = 0.0
    '    Dim orgTypeId As Integer = 0
    '    Dim dtHeadschedTemp, dtsubHeadschedTemp, dtsubItemSched As New DataTable
    '    Dim d5, d6, d7, d8, d9, d10, d11, d12, d13, d14, d15, d16 As String
    '    Dim pD5, pD6, pD7, pD8, pD9, pD10, pD11, pD12, pD13, pD14, pD15, pD16 As String
    '    Try
    '        dtdetails.Columns.Add("SrNo")
    '        dtdetails.Columns.Add("Headingname")
    '        dtdetails.Columns.Add("HeaderSLNo")
    '        dtdetails.Columns.Add("SubHeaderSLNo")
    '        dtdetails.Columns.Add("Notes")
    '        dtdetails.Columns.Add("PrevyearTotoal")
    '        'AST_AccHeadId =1 
    '        sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
    '        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes  from Acc_TrailBalance_Upload_Details "
    '        sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
    '        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '        sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " "
    '        sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
    '        dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        If iRepType = 1 Then
    '            If iSchedulrTypeIdd = 3 Then
    '                'dr = dtdetails.NewRow
    '                'dr("SrNo") = ""
    '                'dr("Headingname") = "<B>" & "Income" & "</B>"
    '                'dtdetails.Rows.Add(dr)
    '            Else
    '                dr = dtdetails.NewRow
    '                dr("SrNo") = ""
    '                dr("Headingname") = "<B>" & "EQUITY AND LIABILITIES" & "</B>"
    '                dtdetails.Rows.Add(dr)
    '            End If
    '            orgTypeId = getOrgtype(sAC, iACID, ICustid)
    '            sSql = "   Select  AST_HeadingID,ASH_Name as headingname FROM ACC_ScheduleTemplates
    '                       Left Join ACC_ScheduleHeading a on a.ash_id=AST_HeadingID
    '                       WHERE AST_Schedule_type = " & iSchedulrTypeIdd & " And AST_Companytype = " & orgTypeId & " and AST_AccHeadId=1
    '                       group by AST_HeadingID, ASH_Name "
    '            dtHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
    '            If dtHeadschedTemp.Rows.Count > 0 Then
    '                For x = 0 To dtHeadschedTemp.Rows.Count - 1
    '                    '  iNote = 1 
    '                    sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
    '                    sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes, "
    '                    sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                    sSql = sSql & " ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
    '                    sSql = sSql & "  from Acc_TrailBalance_Upload_Details "
    '                    sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid and a.ASH_Notes=1 "
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & "  "
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                    sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " and ATBUD_Headingid=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
    '                    sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
    '                    dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtheading.Rows.Count > 0 Then
    '                        For i = 0 To dtheading.Rows.Count - 1
    '                            If IsDBNull(dtheading(i)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = i + 1
    '                                If iSchedulrTypeIdd = 3 Then
    '                                    dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
    '                                Else
    '                                    dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
    '                                End If
    '                                If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
    '                                    TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
    '                                    CreditTotal = CreditTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")

    '                                Else
    '                                    TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
    '                                    DebitTotal = DebitTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")

    '                                End If
    '                                ' PrevTOtal
    '                                If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
    '                                    PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
    '                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")

    '                                Else
    '                                    PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
    '                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")

    '                                End If
    '                                dtdetails.Rows.Add(dr)
    '                                S1TotalAllHeadings = headingTotal + TOTalHeading
    '                                PrevS1TotalAllHeadings = PrevheadingTotal + PrevTOTalHeading



    '                                sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates
    '                                           Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID
    '                                           WHERE AST_Schedule_type = " & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=1 and AST_HeadingID=" & dtheading(i)("ATBUD_Headingid") & "
    '                                           group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
    '                                dtsubHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtsubHeadschedTemp.Rows.Count > 0 Then
    '                                    num = dtdetails.Rows.Count - 1
    '                                    dtdetails(num)("HeaderSLNo") = ""
    '                                    dtdetails(num)("PrevyearTotoal") = ""
    '                                    For y = 0 To dtsubHeadschedTemp.Rows.Count - 1
    '                                        'Sub Heading
    '                                        sSql = ""
    '                                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
    '                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,  "
    '                                        sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
    '                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & ""
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & ""
    '                                        sSql = sSql & " where    ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and ATBUD_Subheading= " & dtsubHeadschedTemp(y)("AST_SubHeadingID") & " "
    '                                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
    '                                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtsubheading.Rows.Count > 0 Then
    '                                            '          num = dtdetails.Rows.Count - 1
    '                                            'dtdetails(num)("HeaderSLNo") = ""
    '                                            'dtdetails(num)("PrevyearTotoal") = ""
    '                                            For j = 0 To dtsubheading.Rows.Count - 1
    '                                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                                    dr = dtdetails.NewRow
    '                                                    dr("SrNo") = i + 1 & "-" & j + 1
    '                                                    dr("Notes") = dtsubheading(j)("Notes")
    '                                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubheading(j)("headingname")
    '                                                    'Reserves and surplus
    '                                                    If dtsubheading(j)("headingname") = "(b) Reserves and surplus" Then
    '                                                        dPandLamt = 0
    '                                                        dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, iSchedulrTypeIdd)
    '                                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                                            subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
    '                                                            CreditTotal = CreditTotal + dPandLamt
    '                                                            subCreditTotal = subCreditTotal + dPandLamt
    '                                                            dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                        Else
    '                                                            subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                                            subDebitTotal = subDebitTotal + dPandLamt
    '                                                            DebitTotal = DebitTotal + dPandLamt
    '                                                            If Val(subDebitTotal) = 0 Then
    '                                                                dr("HeaderSLNo") = 0.00
    '                                                            Else
    '                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
    '                                                            End If

    '                                                        End If
    '                                                        dPrevPandLamt = 0
    '                                                        dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, iSchedulrTypeIdd)
    '                                                        If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
    '                                                            subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
    '                                                            subCreditTotal = subCreditTotal + dPrevPandLamt
    '                                                            PrevCreditTotal = PrevCreditTotal + dPrevPandLamt
    '                                                            dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                        Else
    '                                                            subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
    '                                                            PrevDebitTotal = PrevDebitTotal + dPrevPandLamt
    '                                                            If Val(PrevDebitTotal) = 0 Then
    '                                                                dr("PrevyearTotoal") = 0.00
    '                                                            Else
    '                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
    '                                                            End If
    '                                                        End If
    '                                                    Else
    '                                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                                            subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
    '                                                            dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                        Else
    '                                                            subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                                            If subDebitTotal = 0 Then

    '                                                            End If
    '                                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
    '                                                        End If
    '                                                        If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
    '                                                            subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
    '                                                            dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                        Else
    '                                                            subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
    '                                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
    '                                                        End If
    '                                                    End If
    '                                                    dtdetails.Rows.Add(dr)
    '                                                End If
    '                                            Next
    '                                        Else

    '                                            dr = dtdetails.NewRow
    '                                            dr("SrNo") = ""
    '                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
    '                                            dr("Notes") = dtsubHeadschedTemp(y)("Notes")
    '                                            dr("HeaderSLNo") = "-"
    '                                            dr("PrevyearTotoal") = "-"
    '                                            dtdetails.Rows.Add(dr)
    '                                        End If
    '                                    Next
    '                                Else
    '                                End If
    '                            End If
    '                        Next
    '                        If iSchedulrTypeIdd = 3 Then
    '                            dr = dtdetails.NewRow
    '                            dr("Srno") = ""
    '                            dr("Headingname") = "<B>" & "III Total Income (I+II)" & "</B>"
    '                            If CreditTotal > DebitTotal Then
    '                                S1TotalAllHeadings = CreditTotal - DebitTotal
    '                                dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
    '                            Else
    '                                S1TotalAllHeadings = CreditTotal - DebitTotal
    '                                dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
    '                            End If
    '                            If PrevCreditTotal > PrevDebitTotal Then
    '                                PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
    '                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
    '                            Else
    '                                PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
    '                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
    '                            End If
    '                            s4TotalHeadings = s4TotalHeadings + S1TotalAllHeadings
    '                            Prevs4TotalHeadings = Prevs4TotalHeadings + PrevS1TotalAllHeadings
    '                            dtdetails.Rows.Add(dr)
    '                            CreditTotal = 0 : DebitTotal = 0
    '                            PrevCreditTotal = 0 : PrevDebitTotal = 0
    '                        Else
    '                            dr = dtdetails.NewRow
    '                            dr("Srno") = ""
    '                            dr("Headingname") = "<B>" & "Total" & "</B>"
    '                            If CreditTotal > DebitTotal Then
    '                                S1TotalAllHeadings = CreditTotal - DebitTotal
    '                                dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
    '                            Else
    '                                S1TotalAllHeadings = CreditTotal - DebitTotal
    '                                dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
    '                            End If
    '                            If PrevCreditTotal > PrevDebitTotal Then
    '                                PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
    '                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
    '                            Else
    '                                PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
    '                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
    '                            End If
    '                            s4TotalHeadings = s4TotalHeadings + S1TotalAllHeadings
    '                            Prevs4TotalHeadings = Prevs4TotalHeadings + PrevS1TotalAllHeadings
    '                            dtdetails.Rows.Add(dr)
    '                            CreditTotal = 0 : DebitTotal = 0
    '                            PrevCreditTotal = 0 : PrevDebitTotal = 0
    '                        End If
    '                    Else
    '                        dr = dtdetails.NewRow
    '                        dr("SrNo") = ""
    '                        dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                        dr("HeaderSLNo") = ""
    '                        dr("PrevyearTotoal") = ""
    '                        dtdetails.Rows.Add(dr)

    '                        sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates "
    '                        sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID "
    '                        sSql = sSql & "                  WHERE AST_Schedule_type  =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=1 and AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
    '                        sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
    '                        dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtsubItemSched.Rows.Count > 0 Then
    '                            For m = 0 To dtsubItemSched.Rows.Count - 1
    '                                If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
    '                                    If dtsubItemSched(m)("Notes") = 0 Then
    '                                        dr("Notes") = dtsubItemSched(m)("Notes")
    '                                    Else
    '                                        dr("Notes") = "-"
    '                                    End If
    '                                    dtdetails(num)("HeaderSLNo") = "-"
    '                                    dtdetails(num)("PrevyearTotoal") = "-"
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            Next
    '                        End If
    '                    End If
    '                Next
    '                If iSchedulrTypeIdd = 3 Then

    '                Else
    '                    dr = dtdetails.NewRow
    '                    dr("Srno") = ""
    '                    dr("Headingname") = "<B>" & "Grand Total" & "</B>"
    '                    dr("HeaderSLNo") = Convert.ToDecimal(s4TotalHeadings).ToString("#,##0.00")
    '                    dr("PrevyearTotoal") = Convert.ToDecimal(Prevs4TotalHeadings).ToString("#,##0.00")
    '                    dtdetails.Rows.Add(dr)
    '                End If
    '            End If
    '            'AST_AccHeadId = 2
    '            CreditTotal = 0
    '            DebitTotal = 0
    '            TOTalHeading = 0
    '            headingTotal = 0
    '            subCreditTotal = 0
    '            headingTotal = 0
    '            TOTalHeadingCr = 0
    '            TOTalHeadingDb = 0
    '            PrevCreditTotal = 0
    '            PrevDebitTotal = 0
    '            PrevTOTalHeading = 0
    '            PrevheadingTotal = 0

    '            PrevheadingTotal = 0
    '            PrevTOTalHeadingCr = 0
    '            PrevTOTalHeadingDb = 0
    '            dr = dtdetails.NewRow
    '            dtdetails.Rows.Add(dr)


    '            '  iNote=2
    '            If iSchedulrTypeIdd = 3 Then
    '                'dr = dtdetails.NewRow
    '                'dr("SrNo") = ""
    '                'dr("Headingname") = "<B>" & "Expenses" & "</B>"
    '                'dtdetails.Rows.Add(dr)
    '            Else
    '                dr = dtdetails.NewRow
    '                dr("SrNo") = ""
    '                dr("Headingname") = "<B>" & "Assets" & "</B>"
    '                dtdetails.Rows.Add(dr)
    '            End If
    '            sSql = "   Select  AST_HeadingID,ASH_Name as headingname FROM ACC_ScheduleTemplates
    '                       Left Join ACC_ScheduleHeading a on a.ash_id=AST_HeadingID
    '                       WHERE AST_Schedule_type = " & iSchedulrTypeIdd & " And AST_Companytype = " & orgTypeId & " and AST_AccHeadId=2
    '                       group by AST_HeadingID, ASH_Name "
    '            dtHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
    '            If dtHeadschedTemp.Rows.Count > 0 Then
    '                For x = 0 To dtHeadschedTemp.Rows.Count - 1

    '                    sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
    '                    sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes, "
    '                    sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                    sSql = sSql & " ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
    '                    sSql = sSql & " from Acc_TrailBalance_Upload_Details "
    '                    sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid and a.ASH_Notes=2 "
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & " "
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                    sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " and ATBUD_Headingid=" & dtHeadschedTemp(x)("AST_HeadingID") & ""
    '                    sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
    '                    dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtheading.Rows.Count > 0 Then
    '                        For i = 0 To dtheading.Rows.Count - 1
    '                            If IsDBNull(dtheading(i)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = i + 1
    '                                dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
    '                                If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
    '                                    TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
    '                                    CreditTotal = CreditTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                Else
    '                                    TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
    '                                    DebitTotal = DebitTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                End If
    '                                If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
    '                                    PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
    '                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                Else
    '                                    PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
    '                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                End If
    '                                dtdetails.Rows.Add(dr)
    '                                'S1TotalAllHeadings = headingTotal + TOTalHeading
    '                                PrevS2TotalAllHeadings = PrevheadingTotal + PrevTOTalHeading

    '                                sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates
    '                                           Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID
    '                                           WHERE AST_Schedule_type  =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=2 and AST_HeadingID=" & dtheading(i)("ATBUD_Headingid") & "
    '                                           group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
    '                                dtsubHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtsubHeadschedTemp.Rows.Count > 0 Then
    '                                    num = dtdetails.Rows.Count - 1
    '                                    dtdetails(num)("HeaderSLNo") = ""
    '                                    dtdetails(num)("PrevyearTotoal") = ""
    '                                    For y = 0 To dtsubHeadschedTemp.Rows.Count - 1
    '                                        'Sub Heading
    '                                        sSql = ""
    '                                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
    '                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,  "
    '                                        sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
    '                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & ""
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & ""
    '                                        sSql = sSql & " where  ATBUD_Subheading= " & dtsubHeadschedTemp(y)("AST_SubHeadingID") & "  and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " "
    '                                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
    '                                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtsubheading.Rows.Count > 0 Then
    '                                            For j = 0 To dtsubheading.Rows.Count - 1
    '                                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                                    dr = dtdetails.NewRow
    '                                                    dr("SrNo") = i + 1 & "-" & j + 1
    '                                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubheading(j)("headingname")
    '                                                    If dtsubheading(j)("Notes") = 0 Then
    '                                                        dr("Notes") = ""
    '                                                    Else
    '                                                        dr("Notes") = dtsubheading(j)("Notes")
    '                                                    End If
    '                                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                                        subCreditTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                                        dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                        d10 = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                    Else
    '                                                        subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                                        dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
    '                                                        d10 = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
    '                                                    End If
    '                                                    If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
    '                                                        subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
    '                                                        dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                        pD10 = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
    '                                                    Else
    '                                                        subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
    '                                                        dr("PrevyearTotoal") = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
    '                                                        pD10 = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
    '                                                    End If
    '                                                    dtdetails.Rows.Add(dr)
    '                                                End If
    '                                            Next
    '                                        Else
    '                                            dr = dtdetails.NewRow
    '                                            dr("SrNo") = ""
    '                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
    '                                            dr("Notes") = dtsubHeadschedTemp(y)("Notes")
    '                                            dr("HeaderSLNo") = "-"
    '                                            dr("PrevyearTotoal") = "-"
    '                                            dtdetails.Rows.Add(dr)
    '                                        End If
    '                                    Next
    '                                Else
    '                                End If
    '                            End If
    '                        Next
    '                        dr = dtdetails.NewRow
    '                        dr("Srno") = ""
    '                        dr("Headingname") = "<B>" & "Total" & "</B>"
    '                        If CreditTotal > DebitTotal Then
    '                            S2TotalAllHeadings = CreditTotal - DebitTotal
    '                            dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
    '                        Else
    '                            S2TotalAllHeadings = DebitTotal - CreditTotal
    '                            dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings).ToString("#,##0.00")
    '                        End If

    '                        If PrevCreditTotal > PrevDebitTotal Then
    '                            PrevS2TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
    '                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00")
    '                        Else
    '                            PrevS2TotalAllHeadings = PrevDebitTotal - PrevCreditTotal
    '                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00")
    '                        End If
    '                        s5TotalHeadings = s5TotalHeadings + S2TotalAllHeadings
    '                        Prevs5TotalHeadings = Prevs5TotalHeadings + PrevS2TotalAllHeadings
    '                        dtdetails.Rows.Add(dr)
    '                        CreditTotal = 0 : DebitTotal = 0
    '                        PrevCreditTotal = 0 : PrevDebitTotal = 0
    '                    Else
    '                        If iSchedulrTypeIdd = 3 And iRepType = 1 Then
    '                            If dtHeadschedTemp(x)("headingname") = "V Profit Before Exceptional and Extraordinary Item and tax" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                d5 = s4TotalHeadings - s5TotalHeadings
    '                                pD5 = Prevs4TotalHeadings - Prevs5TotalHeadings
    '                                dr("HeaderSLNo") = d5
    '                                dr("PrevyearTotoal") = pD5
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "VI Exceptional Items" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                dr("HeaderSLNo") = "-" 'd6
    '                                dr("PrevyearTotoal") = "-" 'pd6
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = " VII  Profit Before Extraordinary Item and Tax" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                d7 = d5 - d6
    '                                pD7 = pD5 - pD6
    '                                dr("HeaderSLNo") = d7
    '                                dr("PrevyearTotoal") = pD7
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "  VIII  Extraordinary Iteams" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                dr("HeaderSLNo") = "-" 'd8
    '                                dr("PrevyearTotoal") = "-" 'pd8
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "IX Profit before Tax" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                d9 = d7 - d8
    '                                pD9 = pD7 - pD8
    '                                dr("HeaderSLNo") = d9
    '                                dr("PrevyearTotoal") = pD9
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "  X  Tax Expense;" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                dr("HeaderSLNo") = "-"
    '                                dr("PrevyearTotoal") = "-"
    '                                dtdetails.Rows.Add(dr)

    '                                sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates "
    '                                sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID "
    '                                sSql = sSql & "                  WHERE AST_Schedule_type =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=2 and AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
    '                                sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
    '                                dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtsubItemSched.Rows.Count > 0 Then
    '                                    For m = 0 To dtsubItemSched.Rows.Count - 1
    '                                        If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
    '                                            dr = dtdetails.NewRow
    '                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
    '                                            If dtsubItemSched(m)("Notes") = "0" Then
    '                                                dr("Notes") = dtsubItemSched(m)("Notes")
    '                                            Else
    '                                                dr("Notes") = "-"
    '                                            End If
    '                                            dtdetails(num)("HeaderSLNo") = "-"
    '                                            dtdetails(num)("PrevyearTotoal") = "-"
    '                                            dtdetails.Rows.Add(dr)
    '                                        End If
    '                                    Next
    '                                End If
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "XI Profit / (Loss) for the Period from Continuing Operations" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                d11 = d9 - d10
    '                                pD11 = pD9 - pD10
    '                                dr("HeaderSLNo") = d11
    '                                dr("PrevyearTotoal") = pD11
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "  XII Profit / (Loss)  from discontinuing operations " Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                dr("HeaderSLNo") = "-"
    '                                dr("PrevyearTotoal") = "-"
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "  XIII Tax from discontinuing operations" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                dr("HeaderSLNo") = "-"
    '                                dr("PrevyearTotoal") = "-"
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "XIV Profit/ (Loss) from Discontinuing Operations" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                dr("HeaderSLNo") = "-"
    '                                dr("PrevyearTotoal") = "-"
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "  XV Profit/ (Loss) for the Period" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                d15 = d11 + d12 + d13 + d14 + d15
    '                                pD15 = pD11 + pD12 + pD13 + pD14 + pD15
    '                                dr("HeaderSLNo") = d15
    '                                dr("PrevyearTotoal") = pD15
    '                                dtdetails.Rows.Add(dr)
    '                            ElseIf dtHeadschedTemp(x)("headingname") = "  XVI Earning per equity share;" Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = ""
    '                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                                dr("HeaderSLNo") = "-"
    '                                dr("PrevyearTotoal") = "-"
    '                                dtdetails.Rows.Add(dr)

    '                                sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates "
    '                                sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID "
    '                                sSql = sSql & "                  WHERE AST_Schedule_type =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=2 and AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
    '                                sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
    '                                dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtsubItemSched.Rows.Count > 0 Then
    '                                    For m = 0 To dtsubItemSched.Rows.Count - 1
    '                                        If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
    '                                            dr = dtdetails.NewRow
    '                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
    '                                            If dtsubItemSched(m)("Notes") = "0" Then
    '                                                dr("Notes") = dtsubItemSched(m)("Notes")
    '                                            Else
    '                                                dr("Notes") = "-"
    '                                            End If
    '                                            dtdetails(num)("HeaderSLNo") = "-"
    '                                            dtdetails(num)("PrevyearTotoal") = "-"
    '                                            dtdetails.Rows.Add(dr)
    '                                        End If
    '                                    Next
    '                                End If
    '                            End If
    '                        Else
    '                            dr = dtdetails.NewRow
    '                            dr("SrNo") = ""
    '                            dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
    '                            dr("HeaderSLNo") = "-"
    '                            dr("PrevyearTotoal") = "-"
    '                            dtdetails.Rows.Add(dr)
    '                            sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates "
    '                            sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID "
    '                            sSql = sSql & "                  WHERE AST_Schedule_type =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=2 and AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
    '                            sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
    '                            dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                            If dtsubItemSched.Rows.Count > 0 Then
    '                                For m = 0 To dtsubItemSched.Rows.Count - 1
    '                                    If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
    '                                        dr = dtdetails.NewRow
    '                                        dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
    '                                        If dtsubItemSched(m)("Notes") = "0" Then
    '                                            dr("Notes") = dtsubItemSched(m)("Notes")
    '                                        Else
    '                                            dr("Notes") = "-"
    '                                        End If
    '                                        dtdetails(num)("HeaderSLNo") = "-"
    '                                        dtdetails(num)("PrevyearTotoal") = "-"
    '                                        dtdetails.Rows.Add(dr)
    '                                    End If
    '                                Next
    '                            End If
    '                        End If
    '                    End If
    '                Next
    '                If iSchedulrTypeIdd = 3 Then

    '                Else
    '                    dr = dtdetails.NewRow
    '                    dr("Srno") = ""
    '                    dr("Headingname") = "<B>" & "Grand Total" & "</B>"
    '                    dr("HeaderSLNo") = Convert.ToDecimal(s5TotalHeadings).ToString("#,##0.00")
    '                    dr("PrevyearTotoal") = Convert.ToDecimal(Prevs5TotalHeadings).ToString("#,##0.00")
    '                    dtdetails.Rows.Add(dr)
    '                End If
    '            End If
    '        ElseIf iRepType = 2 Then

    '            'Detailed Report
    '            ' For AccHead =1 
    '            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
    '            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes  from Acc_TrailBalance_Upload_Details "
    '            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
    '            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '            sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " "
    '            sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId =1 ) group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
    '            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)

    '            If dtheading.Rows.Count > 0 Then
    '                For i = 0 To dtheading.Rows.Count - 1
    '                    If IsDBNull(dtheading(i)("headingname")) = False Then
    '                        'Fetch desc under Heading
    '                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
    '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
    '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  from Acc_TrailBalance_Upload"
    '                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
    '                        sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & " And ATBU_YEARId=" & IyearID & ""
    '                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
    '                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtdescdetails.Rows.Count > 0 Then
    '                            CreditTotal = 0 : DebitTotal = 0
    '                        End If
    '                    End If
    '                    'Sub Heading
    '                    sSql = ""
    '                    sSql = ""
    '                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
    '                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
    '                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
    '                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
    '                    sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotalPrev, "
    '                    sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotalPrev "
    '                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & " "
    '                    sSql = sSql & "   left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID"
    '                    sSql = sSql & "   left join Acc_TrailBalance_Upload f on f.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 and ATBUD_itemid=0 And f.ATBU_YEARId=" & IyearID & " "
    '                    sSql = sSql & "   left join Acc_TrailBalance_Upload g on g.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 and ATBUD_itemid=0 And g.ATBU_YEARId=" & IyearID - 1 & " "
    '                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & "   And ATBUD_CustId=" & ICustid & "  "
    '                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description order by ATBUD_Subheading"
    '                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtsubheading.Rows.Count > 0 Then
    '                        headingTotal = 0
    '                        DebitTotal = 0
    '                        CreditTotal = 0
    '                        For j = 0 To dtsubheading.Rows.Count - 1
    '                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = dtsubheading(j)("Notes")
    '                                dr("Headingname") = "<B>" & dtsubheading(j)("headingname") & "</B>"
    '                                dr("Notes") = dtsubheading(j)("Notes")
    '                                If dtsubheading(j)("CrTotal1") > dtsubheading(j)("DbTotal1") Then
    '                                    CreditTotal = CreditTotal + dtsubheading(j)("CrTotal1")
    '                                    TOTalHeading = dtsubheading(j)("CrTotal1") - dtsubheading(j)("DbTotal1")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                    dr("HeaderSLNo") = ""
    '                                Else
    '                                    DebitTotal = DebitTotal + dtsubheading(j)("CrTotal1")
    '                                    TOTalHeading = dtsubheading(j)("DbTotal1") - dtsubheading(j)("CrTotal1")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                    dr("HeaderSLNo") = ""
    '                                End If
    '                                dtdetails.Rows.Add(dr)
    '                                '''' Description Under Sub Heading
    '                                If dtsubheading(j)("CrTotal1") <> 0 Or dtsubheading(j)("DbTotal1") <> 0 Then
    '                                    sSql = ""
    '                                    sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
    '                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
    '                                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
    '                                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & "  "
    '                                    sSql = sSql & "   left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID"
    '                                    sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                    sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "  And ATBUD_CustId=" & ICustid & "   and ATBUD_SubItemId=0 and ATBUD_itemid=0 "
    '                                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
    '                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    dPandLamt = 0 : dPrevPandLamt = 0
    '                                    If dtdescdetails.Rows.Count > 0 Then
    '                                        CreditTotal = 0 : DebitTotal = 0
    '                                        For k = 0 To dtdescdetails.Rows.Count - 1
    '                                            dr = dtdetails.NewRow
    '                                            dr("SrNo") = ""
    '                                            dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
    '                                            If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
    '                                                CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
    '                                                TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
    '                                                headingTotal = headingTotal + TOTalHeading
    '                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                            Else
    '                                                DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
    '                                                TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
    '                                                headingTotal = headingTotal + TOTalHeading
    '                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & ")"
    '                                            End If
    '                                            ' PrevTOtal
    '                                            If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
    '                                                PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
    '                                                PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                            Else
    '                                                PrevTOTalHeading = dtdescdetails(k)("PrevDbTotal") - dtdescdetails(k)("PrevCrTotal")
    '                                                PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                            End If
    '                                            dtdetails.Rows.Add(dr)
    '                                            If dtsubheading(j)("headingname") = "(b) Reserves and surplus" Then
    '                                                dr = dtdetails.NewRow
    '                                                dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & "(Add) Transfered from Current year " & "</i>"
    '                                                dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, iSchedulrTypeIdd)
    '                                                dr("HeaderSLNo") = dPandLamt
    '                                                dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, iSchedulrTypeIdd)
    '                                                dr("PrevyearTotoal") = dPrevPandLamt
    '                                                dtdetails.Rows.Add(dr)
    '                                            End If
    '                                        Next
    '                                    End If
    '                                Else
    '                                    ' Prev desc PrevYear
    '                                    If dtsubheading(j)("CrTotalPrev") <> 0 Or dtsubheading(j)("DbTotalPrev") <> 0 Then
    '                                        sSql = ""
    '                                        sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
    '                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
    '                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                                        sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
    '                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & "  "
    '                                        sSql = sSql & "   left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID"
    '                                        sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                        sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "  And ATBUD_CustId=" & ICustid & "   and ATBUD_SubItemId=0 and ATBUD_itemid=0 "
    '                                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
    '                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtdescdetails.Rows.Count > 0 Then
    '                                            CreditTotal = 0 : DebitTotal = 0
    '                                            For k = 0 To dtdescdetails.Rows.Count - 1
    '                                                dr = dtdetails.NewRow
    '                                                dr("SrNo") = ""
    '                                                dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
    '                                                If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
    '                                                    CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
    '                                                    TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                                Else
    '                                                    DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
    '                                                    TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & ")"
    '                                                End If
    '                                                ' PrevTOtal
    '                                                If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
    '                                                    PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
    '                                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                                Else
    '                                                    PrevTOTalHeading = dtdescdetails(k)("PrevDbTotal") - dtdescdetails(k)("PrevCrTotal")
    '                                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                                End If
    '                                                dtdetails.Rows.Add(dr)


    '                                            Next
    '                                        End If
    '                                    End If
    '                                End If
    '                                TOTalHeading = 0
    '                                sSql = ""
    '                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
    '                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
    '                                sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
    '                                sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
    '                                sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As PrevCrTotal, "
    '                                sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As PrevDbTotal "
    '                                sSql = sSql & "from Acc_TrailBalance_Upload_Details  "
    '                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & ""
    '                                sSql = sSql & "   left join Acc_TrailBalance_Upload f on f.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 And d.ATBU_YEARId=" & IyearID & ""
    '                                sSql = sSql & "   left join Acc_TrailBalance_Upload g on g.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 And g.ATBU_YEARId=" & IyearID - 1 & ""
    '                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & "  And ATBUD_CustId=" & ICustid & ""
    '                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtitem.Rows.Count > 0 Then
    '                                    For a = 0 To dtitem.Rows.Count - 1
    '                                        dr = dtdetails.NewRow
    '                                        dr("SrNo") = i + 1 & "-" & j + 1 & "-" & a + 1
    '                                        dr("Headingname") = dtitem(a)("headingname")
    '                                        If dtitem(a)("CrTotal1") > dtitem(a)("DbTotal1") Then
    '                                            CreditTotal = CreditTotal + dtitem(a)("CrTotal1")
    '                                            TOTalHeading = dtitem(a)("CrTotal1") - dtitem(a)("DbTotal1")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                            dr("HeaderSLNo") = ""
    '                                        Else
    '                                            DebitTotal = DebitTotal + dtitem(a)("CrTotal1")
    '                                            TOTalHeading = dtitem(a)("DbTotal1") - dtitem(a)("CrTotal1")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                            dr("HeaderSLNo") = ""
    '                                        End If


    '                                        ' PrevTOtal
    '                                        If dtitem(a)("PrevCrTotal") > dtitem(a)("PrevDbTotal") Then
    '                                            PrevTOTalHeading = dtitem(a)("PrevCrTotal") - dtitem(a)("PrevDbTotal")
    '                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                            dr("PrevyearTotoal") = ""
    '                                        Else
    '                                            PrevTOTalHeading = dtitem(a)("PrevDbTotal") - dtitem(a)("PrevCrTotal")
    '                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                            dr("PrevyearTotoal") = ""
    '                                        End If
    '                                        dtdetails.Rows.Add(dr)

    '                                        'Description Under Item 
    '                                        If dtitem(a)("CrTotal1") <> 0 Or dtitem(a)("DbTotal1") <> 0 Then
    '                                            'Fetching Desc under Item Name  Not added prev year
    '                                            sSql = "select ATBUD_Description, "
    '                                            sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
    '                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_id  = ATBUD_Masid  and b.ATBU_YEARId=" & IyearID & "  "
    '                                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  "
    '                                            sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
    '                                            sSql = sSql & " group by ATBUD_Description "
    '                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                            If dtdescdetails.Rows.Count > 0 Then
    '                                                For l = 0 To dtdescdetails.Rows.Count - 1
    '                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                        dr = dtdetails.NewRow
    '                                                        dr("SrNo") = "Desc: " & l + 1
    '                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
    '                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                        dr("PrevyearTotoal") = dtdescdetails(l)("PrevTotal")
    '                                                        dtdetails.Rows.Add(dr)
    '                                                    End If
    '                                                Next
    '                                            End If
    '                                        End If


    '                                        ' Prev desc PrevYear
    '                                        If dtitem(a)("PrevCrTotal") <> 0 Or dtitem(a)("PrevDbTotal") <> 0 Then
    '                                            sSql = "select ATBUD_Description, "
    '                                            sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
    '                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_id  = ATBUD_Masid  and b.ATBU_YEARId=" & IyearID & "  "
    '                                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  "
    '                                            sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
    '                                            sSql = sSql & " group by ATBUD_Description "
    '                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                            If dtdescdetails.Rows.Count > 0 Then
    '                                                For l = 0 To dtdescdetails.Rows.Count - 1
    '                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                        dr = dtdetails.NewRow
    '                                                        dr("SrNo") = "Desc: " & l + 1
    '                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
    '                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                        dr("PrevyearTotoal") = dtdescdetails(l)("PrevTotal")
    '                                                        dtdetails.Rows.Add(dr)
    '                                                    End If
    '                                                Next
    '                                            End If
    '                                        End If


    '                                        'Fetch desc Under Sub item
    '                                        sSql = ""
    '                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
    '                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
    '                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal"
    '                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details "
    '                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And ATBU_YEARId=" & IyearID & " "
    '                                        sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0   group by ATBUD_SubItemId,a.ASSI_Name"
    '                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtSubitem.Rows.Count > 0 Then

    '                                            For L = 0 To dtSubitem.Rows.Count - 1
    '                                                '  num = dtdetails.Rows.Count - 1
    '                                                'dtdetails(num)("HeaderSLNo") = ""
    '                                                headingTotal = 0
    '                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
    '                                                    dr = dtdetails.NewRow
    '                                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & a + 1 & "-" & L + 1
    '                                                    dr("Headingname") = dtSubitem(L)("headingname")
    '                                                    If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
    '                                                        CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
    '                                                        TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
    '                                                        headingTotal = headingTotal + TOTalHeading
    '                                                        dr("HeaderSLNo") = TOTalHeading
    '                                                    Else
    '                                                        DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
    '                                                        TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
    '                                                        headingTotal = headingTotal + TOTalHeading
    '                                                        dr("HeaderSLNo") = TOTalHeading
    '                                                    End If
    '                                                    ' PrevTOtal
    '                                                    If dtSubitem(L)("PrevCrTotal") > dtSubitem(L)("PrevDbTotal") Then
    '                                                        PrevTOTalHeading = dtSubitem(L)("PrevCrTotal") - dtSubitem(L)("PrevDbTotal")
    '                                                        PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                                    Else
    '                                                        PrevTOTalHeading = dtSubitem(L)("PrevDbTotal") - dtSubitem(L)("PrevCrTotal")
    '                                                        PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                                    End If
    '                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                    dtdetails.Rows.Add(dr)
    '                                                    'Fetch desc Under Sub item
    '                                                    '
    '                                                    '
    '                                                    '
    '                                                    sSql = "select distinct(ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
    '                                                    sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
    '                                                    sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
    '                                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+f.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal, "
    '                                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
    '                                                    sSql = sSql & " from Acc_TrailBalance_Upload_Details "
    '                                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID=  ATBUD_SubItemId   left join Acc_TrailBalance_Upload  d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & " "
    '                                                    sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid")
    '                                                    sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_SubItemId= " & dtSubitem(L)("ATBUD_SubItemId") & " And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid")
    '                                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
    '                                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                                    If dtdescdetails.Rows.Count > 0 Then
    '                                                        num = dtdetails.Rows.Count - 1
    '                                                        dtdetails(num)("HeaderSLNo") = ""
    '                                                        dtdetails(num)("PrevyearTotoal") = ""
    '                                                        For m = 0 To dtdescdetails.Rows.Count - 1
    '                                                            If IsDBNull(dtdescdetails(m)("ATBUD_Description")) = False Then
    '                                                                dr = dtdetails.NewRow
    '                                                                dr("SrNo") = "Desc: " & L + 1
    '                                                                dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(m)("ATBUD_Description")
    '                                                                If dtdescdetails(m)("CrTotal") > dtdescdetails(m)("DbTotal") Then
    '                                                                    CreditTotal = CreditTotal + dtdescdetails(m)("CrTotal")
    '                                                                    TOTalHeading = dtdescdetails(m)("CrTotal") - dtdescdetails(m)("DbTotal")
    '                                                                    headingTotal = headingTotal + TOTalHeading
    '                                                                    dr("HeaderSLNo") = TOTalHeading
    '                                                                Else
    '                                                                    DebitTotal = DebitTotal + dtdescdetails(m)("DbTotal")
    '                                                                    TOTalHeading = dtdescdetails(m)("DbTotal") - dtdescdetails(m)("CrTotal")
    '                                                                    headingTotal = headingTotal + TOTalHeading
    '                                                                    dr("HeaderSLNo") = "(" & TOTalHeading & ")"
    '                                                                End If
    '                                                                ' PrevTOtal
    '                                                                If dtdescdetails(m)("PrevCrTotal") > dtdescdetails(m)("PrevDbTotal") Then
    '                                                                    PrevTOTalHeading = dtdescdetails(m)("PrevCrTotal") - dtdescdetails(m)("PrevDbTotal")
    '                                                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                                                Else
    '                                                                    PrevTOTalHeading = dtdescdetails(m)("PrevDbTotal") - dtdescdetails(m)("PrevCrTotal")
    '                                                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                                                End If
    '                                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                                headingTotal = headingTotal + TOTalHeading
    '                                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                                dtdetails.Rows.Add(dr)
    '                                                            End If
    '                                                        Next
    '                                                    End If
    '                                                End If
    '                                            Next
    '                                        Else

    '                                            'Dk 24_1_23 For repeating item name desc
    '                                            ''Fetching Desc under Item Name  Not added prev year
    '                                            'sSql = "select ATBUD_Description, "
    '                                            'sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
    '                                            'sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_id  = ATBUD_Masid  and b.ATBU_YEARId=" & IyearID & "  "
    '                                            'sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                                            'sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  "
    '                                            'sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
    '                                            'sSql = sSql & " group by ATBUD_Description "
    '                                            'dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                            'If dtdescdetails.Rows.Count > 0 Then
    '                                            '    For l = 0 To dtdescdetails.Rows.Count - 1
    '                                            '        If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                            '            dr = dtdetails.NewRow
    '                                            '            dr("SrNo") = "Desc: " & l + 1
    '                                            '            dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
    '                                            '            dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                            '            dr("PrevyearTotoal") = dtdescdetails(l)("PrevTotal")
    '                                            '            dtdetails.Rows.Add(dr)
    '                                            '        End If
    '                                            '    Next
    '                                            'End If
    '                                        End If
    '                                    Next
    '                                Else
    '                                End If
    '                            End If
    '                            dr = dtdetails.NewRow
    '                            ' Idu beku total
    '                            dr("Srno") = ""
    '                            dr("Headingname") = "<B>" & "Total" & "</B>"
    '                            If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
    '                                TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal") + dPandLamt
    '                                headingTotal = headingTotal + TOTalHeading
    '                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                            Else

    '                                DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
    '                                TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal") + dPandLamt
    '                                headingTotal = headingTotal + TOTalHeading
    '                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & ")"
    '                            End If
    '                            If PrevCreditTotal > PrevDebitTotal Then
    '                                PrevS2TotalAllHeadings = (PrevCreditTotal - PrevDebitTotal) + dPrevPandLamt
    '                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00")
    '                            Else
    '                                PrevS2TotalAllHeadings = (PrevDebitTotal - PrevCreditTotal) + dPrevPandLamt
    '                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00") & ")"
    '                            End If
    '                            dtdetails.Rows.Add(dr)
    '                            If iChkPt = -1 Then
    '                                If IsDBNull(dtsubheading(j)("ASHN_Description")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Headingname") = dtsubheading(j)("ASHN_Description")
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            End If
    '                            dr = dtdetails.NewRow
    '                            dtdetails.Rows.Add(dr)
    '                            TOTalHeading = 0
    '                            headingTotal = 0
    '                            PrevS2TotalAllHeadings = 0
    '                            PrevCreditTotal = 0 : PrevDebitTotal = 0
    '                            CreditTotal = 0 : DebitTotal = 0
    '                            dPrevPandLamt = 0 : dPandLamt = 0
    '                        Next
    '                    Else
    '                    End If
    '                Next
    '                TOTalHeading = 0
    '            End If

    '            ''' Account Head 2
    '            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
    '            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes  from Acc_TrailBalance_Upload_Details "
    '            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
    '            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
    '            sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " "
    '            sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId =2 ) group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
    '            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)

    '            If dtheading.Rows.Count > 0 Then
    '                For i = 0 To dtheading.Rows.Count - 1
    '                    If IsDBNull(dtheading(i)("headingname")) = False Then
    '                        'Fetch desc under Heading
    '                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
    '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
    '                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  from Acc_TrailBalance_Upload"
    '                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
    '                        sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & " And ATBU_YEARId=" & IyearID & ""
    '                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
    '                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                        If dtdescdetails.Rows.Count > 0 Then
    '                            CreditTotal = 0 : DebitTotal = 0
    '                        End If
    '                    End If
    '                    'Sub Heading
    '                    sSql = ""
    '                    sSql = ""
    '                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
    '                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
    '                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
    '                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
    '                    sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotalPrev, "
    '                    sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotalPrev "
    '                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & " "
    '                    sSql = sSql & "   left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID"
    '                    sSql = sSql & "   left join Acc_TrailBalance_Upload f on f.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 and ATBUD_itemid=0 And f.ATBU_YEARId=" & IyearID & " "
    '                    sSql = sSql & "   left join Acc_TrailBalance_Upload g on g.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 and ATBUD_itemid=0 And g.ATBU_YEARId=" & IyearID - 1 & " "
    '                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & "   And ATBUD_CustId=" & ICustid & "  "
    '                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description order by ATBUD_Subheading"
    '                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                    If dtsubheading.Rows.Count > 0 Then
    '                        headingTotal = 0
    '                        DebitTotal = 0
    '                        CreditTotal = 0
    '                        For j = 0 To dtsubheading.Rows.Count - 1
    '                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
    '                                dr = dtdetails.NewRow
    '                                dr("SrNo") = dtsubheading(j)("Notes")
    '                                dr("Headingname") = "<B>" & dtsubheading(j)("headingname") & "</B>"
    '                                dr("Notes") = dtsubheading(j)("Notes")
    '                                If dtsubheading(j)("CrTotal1") > dtsubheading(j)("DbTotal1") Then
    '                                    CreditTotal = CreditTotal + dtsubheading(j)("CrTotal1")
    '                                    TOTalHeading = dtsubheading(j)("CrTotal1") - dtsubheading(j)("DbTotal1")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                    dr("HeaderSLNo") = ""
    '                                Else
    '                                    DebitTotal = DebitTotal + dtsubheading(j)("CrTotal1")
    '                                    TOTalHeading = dtsubheading(j)("DbTotal1") - dtsubheading(j)("CrTotal1")
    '                                    headingTotal = headingTotal + TOTalHeading
    '                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                    dr("HeaderSLNo") = ""
    '                                End If
    '                                dtdetails.Rows.Add(dr)
    '                                '''' Description Under Sub Heading
    '                                If dtsubheading(j)("CrTotal1") <> 0 Or dtsubheading(j)("DbTotal1") <> 0 Then
    '                                    sSql = ""
    '                                    sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
    '                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
    '                                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
    '                                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & "  "
    '                                    sSql = sSql & "   left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID"
    '                                    sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                    sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "  And ATBUD_CustId=" & ICustid & "   and ATBUD_SubItemId=0 and ATBUD_itemid=0 "
    '                                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
    '                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                    If dtdescdetails.Rows.Count > 0 Then
    '                                        CreditTotal = 0 : DebitTotal = 0
    '                                        For k = 0 To dtdescdetails.Rows.Count - 1
    '                                            dr = dtdetails.NewRow
    '                                            dr("SrNo") = ""
    '                                            dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
    '                                            If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
    '                                                CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
    '                                                TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
    '                                                headingTotal = headingTotal + TOTalHeading
    '                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & ")"
    '                                            Else
    '                                                DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
    '                                                TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
    '                                                headingTotal = headingTotal + TOTalHeading
    '                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                            End If
    '                                            ' PrevTOtal
    '                                            If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
    '                                                PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
    '                                                PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                            Else
    '                                                PrevTOTalHeading = dtdescdetails(k)("PrevDbTotal") - dtdescdetails(k)("PrevCrTotal")
    '                                                PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                            End If
    '                                            dtdetails.Rows.Add(dr)
    '                                        Next
    '                                    End If
    '                                Else
    '                                    ' Prev desc PrevYear
    '                                    If dtsubheading(j)("CrTotalPrev") <> 0 Or dtsubheading(j)("DbTotalPrev") <> 0 Then
    '                                        sSql = ""
    '                                        sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
    '                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
    '                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                                        sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
    '                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
    '                                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & "  "
    '                                        sSql = sSql & "   left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID"
    '                                        sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                        sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "  And ATBUD_CustId=" & ICustid & "   and ATBUD_SubItemId=0 and ATBUD_itemid=0 "
    '                                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
    '                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtdescdetails.Rows.Count > 0 Then
    '                                            CreditTotal = 0 : DebitTotal = 0
    '                                            For k = 0 To dtdescdetails.Rows.Count - 1
    '                                                dr = dtdetails.NewRow
    '                                                dr("SrNo") = ""
    '                                                dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
    '                                                If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
    '                                                    CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
    '                                                    TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & ")"
    '                                                Else
    '                                                    DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
    '                                                    TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                                End If
    '                                                ' PrevTOtal
    '                                                If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
    '                                                    PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
    '                                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                                Else
    '                                                    PrevTOTalHeading = dtdescdetails(k)("PrevDbTotal") - dtdescdetails(k)("PrevCrTotal")
    '                                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                                End If
    '                                                dtdetails.Rows.Add(dr)
    '                                            Next
    '                                        End If
    '                                    End If
    '                                End If
    '                                TOTalHeading = 0
    '                                sSql = ""
    '                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
    '                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
    '                                sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
    '                                sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
    '                                sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As PrevCrTotal, "
    '                                sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As PrevDbTotal "
    '                                sSql = sSql & "from Acc_TrailBalance_Upload_Details  "
    '                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
    '                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & ""
    '                                sSql = sSql & "   left join Acc_TrailBalance_Upload f on f.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 And d.ATBU_YEARId=" & IyearID & ""
    '                                sSql = sSql & "   left join Acc_TrailBalance_Upload g on g.ATBU_ID=ATBUD_Masid and ATBUD_SubItemId=0 And g.ATBU_YEARId=" & IyearID - 1 & ""
    '                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & "  And ATBUD_CustId=" & ICustid & ""
    '                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
    '                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                If dtitem.Rows.Count > 0 Then
    '                                    For a = 0 To dtitem.Rows.Count - 1
    '                                        dr = dtdetails.NewRow
    '                                        dr("SrNo") = i + 1 & "-" & j + 1 & "-" & a + 1
    '                                        dr("Headingname") = dtitem(a)("headingname")
    '                                        If dtitem(a)("CrTotal1") > dtitem(a)("DbTotal1") Then
    '                                            CreditTotal = CreditTotal + dtitem(a)("CrTotal1")
    '                                            TOTalHeading = dtitem(a)("CrTotal1") - dtitem(a)("DbTotal1")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                            dr("HeaderSLNo") = ""
    '                                        Else
    '                                            DebitTotal = DebitTotal + dtitem(a)("CrTotal1")
    '                                            TOTalHeading = dtitem(a)("DbTotal1") - dtitem(a)("CrTotal1")
    '                                            headingTotal = headingTotal + TOTalHeading
    '                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                                            dr("HeaderSLNo") = ""
    '                                        End If


    '                                        ' PrevTOtal
    '                                        If dtitem(a)("PrevCrTotal") > dtitem(a)("PrevDbTotal") Then
    '                                            PrevTOTalHeading = dtitem(a)("PrevCrTotal") - dtitem(a)("PrevDbTotal")
    '                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                            dr("PrevyearTotoal") = ""
    '                                        Else
    '                                            PrevTOTalHeading = dtitem(a)("PrevDbTotal") - dtitem(a)("PrevCrTotal")
    '                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                            dr("PrevyearTotoal") = ""
    '                                        End If
    '                                        dtdetails.Rows.Add(dr)

    '                                        'Description Under Item 
    '                                        If dtitem(a)("CrTotal1") <> 0 Or dtitem(a)("DbTotal1") <> 0 Then
    '                                            'Fetching Desc under Item Name  Not added prev year
    '                                            sSql = "select ATBUD_Description, "
    '                                            sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
    '                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_id  = ATBUD_Masid  and b.ATBU_YEARId=" & IyearID & "  "
    '                                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  "
    '                                            sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
    '                                            sSql = sSql & " group by ATBUD_Description "
    '                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                            If dtdescdetails.Rows.Count > 0 Then
    '                                                For l = 0 To dtdescdetails.Rows.Count - 1
    '                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                        dr = dtdetails.NewRow
    '                                                        dr("SrNo") = "Desc: " & l + 1
    '                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
    '                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                        dr("PrevyearTotoal") = dtdescdetails(l)("PrevTotal")
    '                                                        dtdetails.Rows.Add(dr)
    '                                                    End If
    '                                                Next
    '                                            End If
    '                                        End If


    '                                        ' Prev desc PrevYear
    '                                        If dtitem(a)("PrevCrTotal") <> 0 Or dtitem(a)("PrevDbTotal") <> 0 Then
    '                                            sSql = "select ATBUD_Description, "
    '                                            sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
    '                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_id  = ATBUD_Masid  and b.ATBU_YEARId=" & IyearID & "  "
    '                                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  "
    '                                            sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
    '                                            sSql = sSql & " group by ATBUD_Description "
    '                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                            If dtdescdetails.Rows.Count > 0 Then
    '                                                For l = 0 To dtdescdetails.Rows.Count - 1
    '                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                                        dr = dtdetails.NewRow
    '                                                        dr("SrNo") = "Desc: " & l + 1
    '                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
    '                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                                        dr("PrevyearTotoal") = dtdescdetails(l)("PrevTotal")
    '                                                        dtdetails.Rows.Add(dr)
    '                                                    End If
    '                                                Next
    '                                            End If
    '                                        End If


    '                                        'Fetch desc Under Sub item
    '                                        sSql = ""
    '                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
    '                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
    '                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal"
    '                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details "
    '                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
    '                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And ATBU_YEARId=" & IyearID & " "
    '                                        sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
    '                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0   group by ATBUD_SubItemId,a.ASSI_Name"
    '                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                        If dtSubitem.Rows.Count > 0 Then

    '                                            For L = 0 To dtSubitem.Rows.Count - 1
    '                                                '  num = dtdetails.Rows.Count - 1
    '                                                'dtdetails(num)("HeaderSLNo") = ""
    '                                                headingTotal = 0
    '                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
    '                                                    dr = dtdetails.NewRow
    '                                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & a + 1 & "-" & L + 1
    '                                                    dr("Headingname") = dtSubitem(L)("headingname")
    '                                                    If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
    '                                                        CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
    '                                                        TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
    '                                                        headingTotal = headingTotal + TOTalHeading
    '                                                        dr("HeaderSLNo") = TOTalHeading
    '                                                    Else
    '                                                        DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
    '                                                        TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
    '                                                        headingTotal = headingTotal + TOTalHeading
    '                                                        dr("HeaderSLNo") = TOTalHeading
    '                                                    End If
    '                                                    ' PrevTOtal
    '                                                    If dtSubitem(L)("PrevCrTotal") > dtSubitem(L)("PrevDbTotal") Then
    '                                                        PrevTOTalHeading = dtSubitem(L)("PrevCrTotal") - dtSubitem(L)("PrevDbTotal")
    '                                                        PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                                    Else
    '                                                        PrevTOTalHeading = dtSubitem(L)("PrevDbTotal") - dtSubitem(L)("PrevCrTotal")
    '                                                        PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                                    End If
    '                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                    headingTotal = headingTotal + TOTalHeading
    '                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                    dtdetails.Rows.Add(dr)
    '                                                    'Fetch desc Under Sub item
    '                                                    '
    '                                                    '
    '                                                    '
    '                                                    sSql = "select distinct(ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
    '                                                    sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
    '                                                    sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
    '                                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+f.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal, "
    '                                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
    '                                                    sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
    '                                                    sSql = sSql & " from Acc_TrailBalance_Upload_Details "
    '                                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID=  ATBUD_SubItemId   left join Acc_TrailBalance_Upload  d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & " "
    '                                                    sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_ID = ATBUD_Masid And f.ATBU_YEARId=" & IyearID - 1 & " "
    '                                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid")
    '                                                    sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_SubItemId= " & dtSubitem(L)("ATBUD_SubItemId") & " And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid")
    '                                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
    '                                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                                    If dtdescdetails.Rows.Count > 0 Then
    '                                                        num = dtdetails.Rows.Count - 1
    '                                                        dtdetails(num)("HeaderSLNo") = ""
    '                                                        dtdetails(num)("PrevyearTotoal") = ""
    '                                                        For m = 0 To dtdescdetails.Rows.Count - 1
    '                                                            If IsDBNull(dtdescdetails(m)("ATBUD_Description")) = False Then
    '                                                                dr = dtdetails.NewRow
    '                                                                dr("SrNo") = "Desc: " & L + 1
    '                                                                dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(m)("ATBUD_Description")
    '                                                                If dtdescdetails(m)("CrTotal") > dtdescdetails(m)("DbTotal") Then
    '                                                                    CreditTotal = CreditTotal + dtdescdetails(m)("CrTotal")
    '                                                                    TOTalHeading = dtdescdetails(m)("CrTotal") - dtdescdetails(m)("DbTotal")
    '                                                                    headingTotal = headingTotal + TOTalHeading
    '                                                                    dr("HeaderSLNo") = "(" & TOTalHeading & ")"
    '                                                                Else
    '                                                                    DebitTotal = DebitTotal + dtdescdetails(m)("DbTotal")
    '                                                                    TOTalHeading = dtdescdetails(m)("DbTotal") - dtdescdetails(m)("CrTotal")
    '                                                                    headingTotal = headingTotal + TOTalHeading
    '                                                                    dr("HeaderSLNo") = TOTalHeading
    '                                                                End If
    '                                                                ' PrevTOtal
    '                                                                If dtdescdetails(m)("PrevCrTotal") > dtdescdetails(m)("PrevDbTotal") Then
    '                                                                    PrevTOTalHeading = dtdescdetails(m)("PrevCrTotal") - dtdescdetails(m)("PrevDbTotal")
    '                                                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
    '                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00") & ")"
    '                                                                Else
    '                                                                    PrevTOTalHeading = dtdescdetails(m)("PrevDbTotal") - dtdescdetails(m)("PrevCrTotal")
    '                                                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
    '                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
    '                                                                End If
    '                                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
    '                                                                headingTotal = headingTotal + TOTalHeading
    '                                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
    '                                                                dtdetails.Rows.Add(dr)
    '                                                            End If
    '                                                        Next
    '                                                    End If
    '                                                End If
    '                                            Next
    '                                        Else

    '                                            'Dk 24_1_23 For repeating item name desc
    '                                            ''Fetching Desc under Item Name  Not added prev year
    '                                            'sSql = "select ATBUD_Description, "
    '                                            'sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
    '                                            'sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_id  = ATBUD_Masid  and b.ATBU_YEARId=" & IyearID & "  "
    '                                            'sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
    '                                            'sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & "  "
    '                                            'sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
    '                                            'sSql = sSql & " group by ATBUD_Description "
    '                                            'dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
    '                                            'If dtdescdetails.Rows.Count > 0 Then
    '                                            '    For l = 0 To dtdescdetails.Rows.Count - 1
    '                                            '        If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
    '                                            '            dr = dtdetails.NewRow
    '                                            '            dr("SrNo") = "Desc: " & l + 1
    '                                            '            dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
    '                                            '            dr("HeaderSLNo") = dtdescdetails(l)("Total")
    '                                            '            dr("PrevyearTotoal") = dtdescdetails(l)("PrevTotal")
    '                                            '            dtdetails.Rows.Add(dr)
    '                                            '        End If
    '                                            '    Next
    '                                            'End If
    '                                        End If
    '                                    Next
    '                                Else
    '                                End If
    '                            End If
    '                            dr = dtdetails.NewRow
    '                            ' Idu beku total
    '                            dr("Srno") = ""
    '                            dr("Headingname") = "<B>" & "Total" & "</B>"
    '                            If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
    '                                CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
    '                                TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
    '                                headingTotal = headingTotal + TOTalHeading
    '                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading).ToString("#,##0.00") & ")"
    '                            Else

    '                                DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
    '                                TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
    '                                headingTotal = headingTotal + TOTalHeading
    '                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
    '                            End If
    '                            If PrevCreditTotal > PrevDebitTotal Then
    '                                PrevS2TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
    '                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00") & ")"
    '                            Else
    '                                PrevS2TotalAllHeadings = PrevDebitTotal - PrevCreditTotal
    '                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("#,##0.00")
    '                            End If
    '                            dtdetails.Rows.Add(dr)
    '                            If iChkPt = -1 Then
    '                                If IsDBNull(dtsubheading(j)("ASHN_Description")) = False Then
    '                                    dr = dtdetails.NewRow
    '                                    dr("Headingname") = dtsubheading(j)("ASHN_Description")
    '                                    dtdetails.Rows.Add(dr)
    '                                End If
    '                            End If
    '                            dr = dtdetails.NewRow
    '                            dtdetails.Rows.Add(dr)
    '                            TOTalHeading = 0
    '                            headingTotal = 0
    '                            PrevS2TotalAllHeadings = 0
    '                            PrevCreditTotal = 0 : PrevDebitTotal = 0
    '                            CreditTotal = 0 : DebitTotal = 0
    '                        Next
    '                    Else
    '                    End If
    '                Next
    '                TOTalHeading = 0
    '            End If
    '            TOTalHeading = 0
    '            headingTotal = 0
    '            TOTalHeadingCr = 0
    '            TOTalHeadingDb = 0
    '        End If
    '        Return dtdetails
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    ''For non limitd company

    Public Function getBalSheet(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iRepType As Integer, ByVal iChkPt As Integer, ByVal iInAmt As Integer, ByVal sSelectedBranches As String, ByVal iRoundOff As Integer, ByVal sSelectedSHeading As String, ByVal sSelectedItems As String, ByVal iStat As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As String
        Dim S2TotalAllHeadings As Double = 0
        Dim S3TotalAllHeadings As Double = 0
        Dim s4TotalHeadings As Double = 0
        Dim s5TotalHeadings As Double = 0
        Dim PrevheadingTotal As Double = 0
        Dim PrevS1TotalAllHeadings As String
        Dim PrevS2TotalAllHeadings As Double = 0
        Dim PrevS3TotalAllHeadings As Double = 0
        Dim Prevs4TotalHeadings As Double = 0
        Dim Prevs5TotalHeadings As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer = 0
        Dim TOTalHeading As Double = 0
        Dim CreditTotal As Double = 0
        Dim DebitTotal As Double = 0
        Dim PrevTOTalHeading As Double = 0
        Dim PrevTOTalHeadingDb As Double = 0
        Dim PrevTOTalHeadingCr As Double = 0
        Dim PrevCreditTotal As Double = 0
        Dim PrevDebitTotal As Double = 0
        Dim subCreditTotal As String
        Dim subDebitTotal As String
        Dim dPandLamt As String
        Dim dPrevPandLamt As String
        Dim orgTypeId As Integer = 0
        Dim dtHeadschedTemp, dtsubHeadschedTemp, dtsubItemSched As New DataTable
        Dim d5, d6, d7, d8, d9, d10, d11, d12, d13, d14, d15, d16 As String
        Dim pD5, pD6, pD7, pD8, pD9, pD10, pD11, pD12, pD13, pD14, pD15, pD16 As String
        Dim dTempAmt As String = ""
        Dim d10int As Double = 0
        Dim sTotal As String = 0
        Dim sRoundDebit, sRoundCredit As String
        Dim sPRoundDebit, sPRoundCredit As String
        Dim dtCustPartnerDet As New DataTable
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            dtdetails.Columns.Add("Notes")
            dtdetails.Columns.Add("PrevyearTotoal")
            'AST_AccHeadId =1 
            sRoundDebit = 0 : sRoundCredit = 0
            sPRoundDebit = 0 : sPRoundCredit = 0
            If iInAmt = 0 Then
                iInAmt = 1
            End If
            orgTypeId = getOrgtype(sAC, iACID, ICustid)
            If iRepType = 1 Then
                If iSchedulrTypeIdd = 3 Then
                Else
                    dr = dtdetails.NewRow
                    dr("SrNo") = ""
                    dr("Headingname") = "<B>" & "EQUITY AND LIABILITIES" & "</B>"
                    dtdetails.Rows.Add(dr)
                End If
                sSql = "Select AST_HeadingID,ASH_Name as headingname FROM ACC_ScheduleTemplates
                           Left Join ACC_ScheduleHeading a on a.ash_id=AST_HeadingID
                           WHERE AST_Schedule_type = " & iSchedulrTypeIdd & " And AST_Companytype = " & orgTypeId & " and a.ASH_Notes=1
                           group by AST_HeadingID, ASH_Name order by AST_HeadingID "
                dtHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtHeadschedTemp.Rows.Count > 0 Then
                    For x = 0 To dtHeadschedTemp.Rows.Count - 1
                        '  iNote = 1 
                        sSql = "Select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes, "
                        sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                        sSql = sSql & " ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                        sSql = sSql & "  from Acc_TrailBalance_Upload_Details "
                        sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid and a.ASH_Notes=1 "
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description  And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID - 1 & "  and e.ATBU_Branchid=Atbud_Branchnameid "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " and ATBUD_Headingid=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                        sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
                        dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtheading.Rows.Count > 0 Then
                            For i = 0 To dtheading.Rows.Count - 1
                                If IsDBNull(dtheading(i)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = i + 1
                                    dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                                    If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                        TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                        CreditTotal = CreditTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                    Else
                                        TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                        DebitTotal = DebitTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                    End If
                                    ' PrevTOtal
                                    If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
                                        PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                        PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                    Else
                                        PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                        PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                        If PrevTOTalHeading > 0 Then
                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                        Else
                                            dr("PrevyearTotoal") = "-"
                                        End If
                                    End If
                                    dtdetails.Rows.Add(dr)
                                    S1TotalAllHeadings = headingTotal + TOTalHeading
                                    PrevS1TotalAllHeadings = PrevheadingTotal + PrevTOTalHeading
                                    sSql = "   Select  AST_SubHeadingID, AsSH_Name As headingname, ASSH_Notes as Notes FROM ACC_ScheduleTemplates
                                               Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID
                                               WHERE AST_Schedule_type = " & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=1 and AST_HeadingID=" & dtheading(i)("ATBUD_Headingid") & "
                                               group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                                    dtsubHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtsubHeadschedTemp.Rows.Count > 0 Then
                                        num = dtdetails.Rows.Count - 1
                                        dtdetails(num)("HeaderSLNo") = ""
                                        dtdetails(num)("PrevyearTotoal") = ""
                                        For y = 0 To dtsubHeadschedTemp.Rows.Count - 1
                                            'Sub Heading
                                            sSql = ""
                                            sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,  "
                                            sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                                            sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID - 1 & "  and e.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and  ATBUD_Subheading= " & dtsubHeadschedTemp(y)("AST_SubHeadingID") & "  "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And Atbud_Branchnameid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                                            dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtsubheading.Rows.Count > 0 Then
                                                For j = 0 To dtsubheading.Rows.Count - 1
                                                    If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = i + 1 & "-" & j + 1
                                                        dr("Notes") = dtsubheading(j)("Notes")
                                                        dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubheading(j)("headingname")
                                                        'Reserves and surplus
                                                        If dtsubheading(j)("headingname").ToString.Trim = "(b) Reserves and surplus" And orgTypeId = 28 Then
                                                            dPandLamt = 0
                                                            dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                                                            sPandLAmount = Convert.ToDecimal(dPandLamt).ToString("#,##0.00")
                                                            If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                                                subCreditTotal = Val(dtsubheading(j)("CrTotal")) - Val(dtsubheading(j)("DbTotal"))
                                                                subCreditTotal = Val(subCreditTotal) + Val(dPandLamt)
                                                                dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                            Else
                                                                subDebitTotal = Val(dtsubheading(j)("DbTotal")) - Val(dtsubheading(j)("CrTotal"))
                                                                If Val(dPandLamt) < 0 Then
                                                                    subDebitTotal = (Val(-subDebitTotal) + Val(dPandLamt))
                                                                Else
                                                                    subDebitTotal = Val(Val(subDebitTotal) - Val(dPandLamt))
                                                                End If
                                                                If Val(subDebitTotal) = 0 Then
                                                                    dr("HeaderSLNo") = 0.00
                                                                Else
                                                                    If subDebitTotal < 0 Then
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                    Else
                                                                        If Val(dPandLamt) < 0 Then
                                                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                            sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                        Else
                                                                            dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                            sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                        End If
                                                                    End If
                                                                End If
                                                            End If
                                                            dPrevPandLamt = 0
                                                            dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                                            If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                                                subCreditTotal = Val(dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal"))
                                                                subCreditTotal = subCreditTotal + Val(dPrevPandLamt)
                                                                If subCreditTotal < 0 Then
                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(subCreditTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                    sPRoundCredit = Val(sPRoundCredit) + dr("PrevyearTotoal")
                                                                Else
                                                                    If subCreditTotal <> 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                        sPRoundCredit = Val(sPRoundCredit) + dr("PrevyearTotoal")
                                                                    Else
                                                                        dr("PrevyearTotoal") = "-"
                                                                    End If
                                                                End If
                                                            Else
                                                                subDebitTotal = Val(dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal"))
                                                                If Val(dPrevPandLamt) < 0 Then
                                                                    subDebitTotal = (Val(-subDebitTotal) + Val(dPrevPandLamt))
                                                                Else
                                                                    subDebitTotal = Val(Val(subDebitTotal) - Val(dPrevPandLamt))
                                                                End If
                                                                If Val(subDebitTotal) = 0 Then
                                                                    dr("PrevyearTotoal") = "-"
                                                                Else
                                                                    If subDebitTotal < 0 Then
                                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                        sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                                    Else
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff))
                                                                        sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                                    End If
                                                                End If
                                                            End If
                                                        Else
                                                            If (orgTypeId = 68 Or orgTypeId = 74) And dtsubheading(j)("headingname").ToString.Trim = "(a)   Proprietor capital" Then
                                                                dPandLamt = 0
                                                                dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                                                                sPandLAmount = Convert.ToDecimal(dPandLamt).ToString("#,##0.00")


                                                                ' dtCustPartnerDet = getCustPartnerDet(sAC, iACID, ICustid)


                                                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                                                    subCreditTotal = Val(dtsubheading(j)("CrTotal")) - Val(dtsubheading(j)("DbTotal"))
                                                                    subCreditTotal = Val(subCreditTotal) + Val(dPandLamt)
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                    sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                                Else
                                                                    subDebitTotal = Val(dtsubheading(j)("DbTotal")) - Val(dtsubheading(j)("CrTotal"))
                                                                    If Val(dPandLamt) < 0 Then
                                                                        subDebitTotal = (Val(-subDebitTotal) + Val(dPandLamt))
                                                                    Else
                                                                        subDebitTotal = Val(Val(subDebitTotal) - Val(dPandLamt))
                                                                    End If
                                                                    If Val(subDebitTotal) = 0 Then
                                                                        dr("HeaderSLNo") = 0.00
                                                                    Else
                                                                        If subDebitTotal < 0 Then
                                                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                            sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                        Else
                                                                            If Val(dPandLamt) < 0 Then
                                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                                sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                            Else
                                                                                dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                                sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                            End If
                                                                        End If
                                                                    End If
                                                                End If
                                                                dPrevPandLamt = 0
                                                                dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                                                If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                                                    subCreditTotal = Val(dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal"))
                                                                    subCreditTotal = subCreditTotal + Val(dPrevPandLamt)
                                                                    If subCreditTotal < 0 Then
                                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(subCreditTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                        sPRoundCredit = Val(sPRoundCredit) + dr("PrevyearTotoal")
                                                                    Else
                                                                        If subCreditTotal <> 0 Then
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                            sPRoundCredit = Val(sPRoundCredit) + dr("PrevyearTotoal")
                                                                        Else
                                                                            dr("PrevyearTotoal") = "-"
                                                                        End If
                                                                    End If
                                                                Else
                                                                    subDebitTotal = Val(dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal"))
                                                                    If Val(dPrevPandLamt) < 0 Then
                                                                        subDebitTotal = (Val(-subDebitTotal) + Val(dPrevPandLamt))
                                                                    Else
                                                                        subDebitTotal = Val(Val(subDebitTotal) - Val(dPrevPandLamt))
                                                                    End If
                                                                    If Val(subDebitTotal) = 0 Then
                                                                        dr("PrevyearTotoal") = "-"
                                                                    Else
                                                                        If subDebitTotal < 0 Then
                                                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                            sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                                        Else
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff))
                                                                            sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                                        End If
                                                                    End If
                                                                End If
                                                            Else
                                                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                                                    subCreditTotal = Val(dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal"))
                                                                    If subCreditTotal = 0 Then
                                                                        dr("HeaderSLNo") = "-"
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                        sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                                    End If
                                                                Else
                                                                    subDebitTotal = Val(dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal"))
                                                                    If subDebitTotal = 0 Then
                                                                    End If
                                                                    If subDebitTotal < 0 Then
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                    Else
                                                                        If subDebitTotal = 0 Then
                                                                            dr("HeaderSLNo") = "-"
                                                                        Else
                                                                            dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                            sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                        End If
                                                                    End If
                                                                End If
                                                                If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                                                    subCreditTotal = Val(dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal"))
                                                                    If subCreditTotal <> 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                        sPRoundCredit = Val(sPRoundCredit) + dr("PrevyearTotoal")
                                                                    Else
                                                                        dr("PrevyearTotoal") = "-"
                                                                    End If
                                                                Else
                                                                    subDebitTotal = Val(dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal"))
                                                                    If subDebitTotal < 0 Then
                                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                        sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                                    Else
                                                                        If subDebitTotal <> 0 Then
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                            sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                                        Else
                                                                            dr("PrevyearTotoal") = "-"
                                                                        End If
                                                                    End If
                                                                End If
                                                            End If
                                                        End If
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            Else
                                                If orgTypeId = 68 And dtsubHeadschedTemp(y)("headingname") = "(b)   Reserves and surplus" Then
                                                    dPandLamt = 0 : dPrevPandLamt = 0
                                                    dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, iSchedulrTypeIdd, sSelectedBranches)
                                                    sPandLAmount = Convert.ToDecimal(dPandLamt).ToString("#,##0.00")
                                                    dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = ""
                                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
                                                    dr("Notes") = dtsubHeadschedTemp(y)("Notes")
                                                    dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                    dtdetails.Rows.Add(dr)
                                                ElseIf orgTypeId = 68 And dtsubHeadschedTemp(y)("headingname").ToString.Trim = "(a)   Proprietor capital" Then
                                                    dPandLamt = 0 : dPrevPandLamt = 0
                                                    dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, iSchedulrTypeIdd, sSelectedBranches)
                                                    sPandLAmount = Convert.ToDecimal(dPandLamt).ToString("#,##0.00")
                                                    dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = ""
                                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
                                                    dr("Notes") = dtsubHeadschedTemp(y)("Notes")
                                                    If dPandLamt < 0 Then
                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(dPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                    Else
                                                        dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                        sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                    End If
                                                    If dPrevPandLamt < 0 Then
                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                        sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                    Else
                                                        dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                        sPRoundCredit = Val(sPRoundCredit) + dr("PrevyearTotoal")
                                                    End If
                                                    dtdetails.Rows.Add(dr)
                                                ElseIf orgTypeId = 28 And dtsubHeadschedTemp(y)("headingname").ToString.Trim = "(b) Reserves and surplus" Then
                                                    dPandLamt = 0 : dPrevPandLamt = 0
                                                    dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, iSchedulrTypeIdd, sSelectedBranches)
                                                    sPandLAmount = Convert.ToDecimal(dPandLamt).ToString("#,##0.00")
                                                    dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = ""
                                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
                                                    dr("Notes") = dtsubHeadschedTemp(y)("Notes")
                                                    If dPandLamt < 0 Then
                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(dPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                    Else
                                                        dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                    End If
                                                    If dPrevPandLamt < 0 Then
                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                        sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                    Else
                                                        dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                        sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                    End If
                                                    dtdetails.Rows.Add(dr)
                                                Else
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = ""
                                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
                                                    If dtsubHeadschedTemp(y)("Notes") = "0" Then
                                                        dr("Notes") = ""
                                                    Else
                                                        dr("Notes") = dtsubHeadschedTemp(y)("Notes")
                                                    End If
                                                    dr("HeaderSLNo") = "-"
                                                    dr("PrevyearTotoal") = "-"
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            End If
                                        Next
                                    Else
                                    End If
                                End If
                            Next
                            If iSchedulrTypeIdd = 3 Then
                                dr = dtdetails.NewRow
                                dr("Srno") = ""
                                dr("Headingname") = "<B>" & "III Total Income (I+II)" & "</B>"
                                'If CreditTotal > DebitTotal Then
                                '    S1TotalAllHeadings = Val(CreditTotal - DebitTotal)
                                '    dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff)
                                'Else
                                '    S1TotalAllHeadings = Val(CreditTotal - DebitTotal)
                                '    If S1TotalAllHeadings = 0 Then
                                '        dr("HeaderSLNo") = "-"
                                '    Else
                                '        dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff)
                                '    End If
                                'End If
                                If sRoundCredit > sRoundDebit Then
                                    S1TotalAllHeadings = Val(sRoundCredit - sRoundDebit)
                                    dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff)
                                Else
                                    S1TotalAllHeadings = sRoundCredit - sRoundDebit
                                    If S1TotalAllHeadings = 0 Then
                                        dr("HeaderSLNo") = "-"
                                    Else
                                        dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff)
                                    End If
                                End If
                                'If PrevCreditTotal > PrevDebitTotal Then
                                '    PrevS1TotalAllHeadings = Val(PrevCreditTotal - PrevDebitTotal)
                                '    dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("N" & iRoundOff)
                                'Else
                                '    PrevS1TotalAllHeadings = Val(PrevCreditTotal - PrevDebitTotal)
                                '    If PrevS1TotalAllHeadings = 0 Then
                                '        dr("PrevyearTotoal") = "-"
                                '    Else
                                '        dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("N" & iRoundOff)
                                '    End If
                                'End If
                                If sPRoundCredit > sPRoundDebit Then
                                    PrevS1TotalAllHeadings = sPRoundCredit - sPRoundDebit
                                    dr("PrevyearTotoal") = Convert.ToDecimal(Val(PrevS1TotalAllHeadings).ToString("N" & iRoundOff))
                                Else
                                    PrevS1TotalAllHeadings = sPRoundCredit - sPRoundDebit
                                    If PrevS1TotalAllHeadings = 0 Then
                                        dr("PrevyearTotoal") = "-"
                                    Else
                                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("N" & iRoundOff)
                                    End If
                                End If
                                s4TotalHeadings = s4TotalHeadings + S1TotalAllHeadings
                                Prevs4TotalHeadings = Prevs4TotalHeadings + PrevS1TotalAllHeadings
                                dtdetails.Rows.Add(dr)
                                CreditTotal = 0 : DebitTotal = 0
                                PrevCreditTotal = 0 : PrevDebitTotal = 0
                            Else
                                dr = dtdetails.NewRow
                                dr("Srno") = ""
                                dr("Headingname") = "<B>" & "Total" & "</B>"
                                'If CreditTotal > DebitTotal Then
                                '    S1TotalAllHeadings = CreditTotal - DebitTotal + Val(dPandLamt)
                                '    If S1TotalAllHeadings < 0 Then
                                '        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(Val(S1TotalAllHeadings / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & "</B>"
                                '    Else
                                '        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S1TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                '    End If
                                'Else
                                '    S1TotalAllHeadings = CreditTotal - DebitTotal + dPandLamt
                                '    If S1TotalAllHeadings < 0 Then
                                '        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(Val(S1TotalAllHeadings).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & "</B>"
                                '    Else
                                '        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                '    End If
                                'End If
                                If sRoundCredit > sRoundDebit Then
                                    If sRoundDebit < 0 Then
                                        S1TotalAllHeadings = Val(Val(sRoundCredit) + Val(sRoundDebit))
                                    Else
                                        S1TotalAllHeadings = sRoundCredit - sRoundDebit
                                    End If
                                    If S1TotalAllHeadings < 0 Then
                                        dr("HeaderSLNo") = "<B>" & "(" & Convert.ToDecimal(Val(S1TotalAllHeadings).ToString("N" & iRoundOff).Remove(0, 1)) & ")" & "</B>"
                                    Else
                                        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                    End If
                                Else
                                    S1TotalAllHeadings = sRoundCredit - sRoundDebit
                                    If S1TotalAllHeadings < 0 Then
                                        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(Val(S1TotalAllHeadings).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & "</B>"
                                    Else
                                        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                    End If
                                End If
                                If sPRoundCredit > sPRoundDebit Then
                                    If sPRoundDebit < 0 Then
                                        PrevS1TotalAllHeadings = Val(Val(sPRoundCredit) + Val(sPRoundDebit))
                                    Else
                                        PrevS1TotalAllHeadings = Val(Val(sPRoundCredit) - Val(sPRoundDebit))
                                    End If
                                    If PrevS1TotalAllHeadings < 0 Then
                                        dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(Val(PrevS1TotalAllHeadings).ToString("N" & iRoundOff).Remove(0, 1)) & ")" & "</B>"
                                    Else
                                        dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                    End If
                                Else
                                    PrevS1TotalAllHeadings = sPRoundCredit - sPRoundDebit
                                    If PrevS1TotalAllHeadings < 0 Then
                                        dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(Val(PrevS1TotalAllHeadings).ToString("N" & iRoundOff).Remove(0, 1)) & ")" & "</B>"
                                    Else
                                        If PrevS1TotalAllHeadings = 0 Then
                                            dr("PrevyearTotoal") = "<B>" & "-" & "</B>"
                                        Else
                                            dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                        End If
                                    End If
                                End If
                                sRoundDebit = 0 : sRoundCredit = 0
                                sPRoundDebit = 0 : sPRoundCredit = 0
                                dPandLamt = 0 : dPrevPandLamt = 0
                                s4TotalHeadings = s4TotalHeadings + S1TotalAllHeadings
                                Prevs4TotalHeadings = Prevs4TotalHeadings + PrevS1TotalAllHeadings
                                dtdetails.Rows.Add(dr)
                                CreditTotal = 0 : DebitTotal = 0
                                PrevCreditTotal = 0 : PrevDebitTotal = 0
                            End If
                        Else
                            dr = dtdetails.NewRow
                            dr("SrNo") = ""
                            dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                            dr("HeaderSLNo") = ""
                            dr("PrevyearTotoal") = ""
                            dtdetails.Rows.Add(dr)

                            sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates "
                            sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID "
                            sSql = sSql & "                  WHERE AST_Schedule_type  =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=1 and AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                            sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                            dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtsubItemSched.Rows.Count > 0 Then
                                For m = 0 To dtsubItemSched.Rows.Count - 1
                                    If IsDBNull(dtsubItemSched(m)("headingname")) = False Then

                                        If orgTypeId = 28 And dtsubItemSched(m)("headingname").ToString.Trim = "(b) Reserves and surplus" Then
                                            dPandLamt = 0 : dPrevPandLamt = 0
                                            dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, iSchedulrTypeIdd, sSelectedBranches)
                                            sPandLAmount = Convert.ToDecimal(dPandLamt).ToString("#,##0.00")
                                            dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                            dr = dtdetails.NewRow
                                            dr("SrNo") = ""
                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
                                            dr("Notes") = dtsubItemSched(m)("Notes")
                                            If dPandLamt < 0 Then
                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(dPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                            Else
                                                dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                            End If
                                            If dPrevPandLamt < 0 Then
                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                            Else
                                                dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                            End If
                                            dtdetails.Rows.Add(dr)
                                        Else
                                            dr = dtdetails.NewRow
                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
                                            If dtsubItemSched(m)("Notes") <> 0 Then
                                                dr("Notes") = dtsubItemSched(m)("Notes")
                                            Else
                                                dr("Notes") = "-"
                                            End If
                                            dtdetails(num)("HeaderSLNo") = "-"
                                            dtdetails(num)("PrevyearTotoal") = "-"
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    End If
                                Next

                                If dPandLamt <> 0 Then
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "<B>" & "Total" & "</B>"

                                    If sRoundCredit > sRoundDebit Then
                                        If sRoundDebit < 0 Then
                                            S1TotalAllHeadings = Val(Val(sRoundCredit) + Val(sRoundDebit))
                                        Else
                                            S1TotalAllHeadings = sRoundCredit - sRoundDebit
                                        End If
                                        If S1TotalAllHeadings < 0 Then
                                            dr("HeaderSLNo") = "<B>" & "(" & Convert.ToDecimal(Val(S1TotalAllHeadings).ToString("N" & iRoundOff).Remove(0, 1)) & ")" & "</B>"
                                        Else
                                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                        End If
                                    Else
                                        S1TotalAllHeadings = sRoundDebit - sRoundCredit
                                        If S1TotalAllHeadings < 0 Then
                                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(Val(S1TotalAllHeadings).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & "</B>"
                                        Else
                                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                        End If
                                    End If
                                    If sPRoundCredit > sPRoundDebit Then
                                        If sPRoundDebit < 0 Then
                                            PrevS1TotalAllHeadings = Val(Val(sPRoundCredit) + Val(sPRoundDebit))
                                        Else
                                            PrevS1TotalAllHeadings = Val(Val(sPRoundCredit) - Val(sPRoundDebit))
                                        End If
                                        If PrevS1TotalAllHeadings < 0 Then
                                            dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(Val(PrevS1TotalAllHeadings).ToString("N" & iRoundOff).Remove(0, 1)) & ")" & "</B>"
                                        Else
                                            dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                        End If
                                    Else
                                        PrevS1TotalAllHeadings = sPRoundCredit - sPRoundDebit
                                        If PrevS1TotalAllHeadings < 0 Then
                                            dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(Val(PrevS1TotalAllHeadings).ToString("N" & iRoundOff).Remove(0, 1)) & ")" & "</B>"
                                        Else
                                            If PrevS1TotalAllHeadings = 0 Then
                                                dr("PrevyearTotoal") = "<B>" & "-" & "</B>"
                                            Else
                                                dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                            End If
                                        End If
                                    End If
                                    sRoundDebit = 0 : sRoundCredit = 0
                                    sPRoundDebit = 0 : sPRoundCredit = 0
                                    dPandLamt = 0 : dPrevPandLamt = 0
                                    s4TotalHeadings = s4TotalHeadings + S1TotalAllHeadings
                                    Prevs4TotalHeadings = Prevs4TotalHeadings + PrevS1TotalAllHeadings
                                    dtdetails.Rows.Add(dr)
                                    CreditTotal = 0 : DebitTotal = 0
                                    PrevCreditTotal = 0 : PrevDebitTotal = 0
                                End If
                            End If
                        End If
                    Next
                    If iSchedulrTypeIdd = 3 Then
                    Else
                        dr = dtdetails.NewRow
                        dr("Srno") = ""
                        dr("Headingname") = "<B>" & "Total Equity & Liabilities " & "</B>"
                        If s4TotalHeadings = 0 Then
                            dr("HeaderSLNo") = "<B>" & "-" & "</B>"
                        Else
                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(s4TotalHeadings).ToString("N" & iRoundOff) & "</B>"
                        End If
                        If Prevs4TotalHeadings = 0 Then
                            dr("PrevyearTotoal") = "<B>" & "-" & "</B>"
                        Else
                            dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(Prevs4TotalHeadings).ToString("N" & iRoundOff) & "</B>"
                        End If
                        dtdetails.Rows.Add(dr)
                    End If
                End If
                'AST_AccHeadId = 2
                CreditTotal = 0
                DebitTotal = 0
                TOTalHeading = 0
                headingTotal = 0
                subCreditTotal = 0
                headingTotal = 0
                PrevCreditTotal = 0
                PrevDebitTotal = 0
                PrevTOTalHeading = 0
                PrevheadingTotal = 0
                sRoundDebit = 0 : sRoundCredit = 0
                sPRoundCredit = 0 : sPRoundDebit = 0
                dr = dtdetails.NewRow
                dtdetails.Rows.Add(dr)
                '  iNote=2
                If iSchedulrTypeIdd = 3 Then
                    'dr = dtdetails.NewRow
                    'dr("SrNo") = ""
                    'dr("Headingname" ) = "<B>" & "Expenses" & "</B>"
                    'dtdetails.Rows.Add(dr)
                Else
                    dr = dtdetails.NewRow
                    dr("SrNo") = ""
                    dr("Headingname") = "<B>" & "Assets" & "</B>"
                    dtdetails.Rows.Add(dr)
                End If
                sSql = "   Select  AST_HeadingID,ASH_Name as headingname FROM ACC_ScheduleTemplates
                           Left Join ACC_ScheduleHeading a on a.ash_id=AST_HeadingID
                           WHERE AST_Schedule_type = " & iSchedulrTypeIdd & " And AST_Companytype = " & orgTypeId & " and a.ASH_Notes=2
                           group by AST_HeadingID, ASH_Name  order by AST_HeadingID "
                dtHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtHeadschedTemp.Rows.Count > 0 Then
                    For x = 0 To dtHeadschedTemp.Rows.Count - 1
                        sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes, "
                        sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                        sSql = sSql & " ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details "
                        sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid and a.ASH_Notes=2 "
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID - 1 & "  and e.ATBU_Branchid=Atbud_Branchnameid "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " and ATBUD_Headingid=" & dtHeadschedTemp(x)("AST_HeadingID") & "  "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And Atbud_Branchnameid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
                        dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtheading.Rows.Count > 0 Then
                            For i = 0 To dtheading.Rows.Count - 1
                                If IsDBNull(dtheading(i)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = i + 1
                                    dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                                    If dtHeadschedTemp(x)("headingname") = "VI Exceptional Items" Then
                                        If dtheading(i)("DbTotal") > dtheading(i)("CrTotal") Then
                                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                        Else
                                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            If TOTalHeading = 0 Then
                                                dr("HeaderSLNo") = "-"
                                            Else
                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                            End If
                                        End If
                                        If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
                                            PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                        Else
                                            PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                        End If
                                    ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "X Tax Expense" Then
                                        If dtheading(i)("DbTotal") > dtheading(i)("CrTotal") Then
                                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                        Else
                                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            Dim sTOTalHeading As String = TOTalHeading
                                            If sTOTalHeading < 0 Then
                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(sTOTalHeading / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                            Else
                                                dr("HeaderSLNo") = "-"
                                            End If
                                        End If
                                        If dtheading(i)("PrevDbTotal") > dtheading(i)("PrevCrTotal") Then
                                            PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                        Else
                                            PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                            If PrevTOTalHeading = 0 Then
                                                dr("PrevyearTotoal") = "-"
                                            Else
                                                If PrevTOTalHeading < 0 Then
                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                Else
                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("N" & iRoundOff)
                                                End If
                                            End If
                                        End If
                                    ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "V Exceptional items" And orgTypeId = 68 Then
                                        If dtheading(i)("DbTotal") > dtheading(i)("CrTotal") Then
                                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                            TOTalHeading = (TOTalHeading / iInAmt)
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading).ToString("N" & iRoundOff) & ")"
                                            sRoundCredit = Val(sRoundCredit) + TOTalHeading
                                        Else
                                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            Dim sTOTalHeading As String = Val(TOTalHeading / iInAmt)
                                            If sTOTalHeading < 0 Then
                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(sTOTalHeading).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                sRoundDebit = Val(sRoundDebit) + sTOTalHeading
                                            Else
                                                If sTOTalHeading = 0 Then
                                                    dr("HeaderSLNo") = "-"
                                                Else
                                                    dr("HeaderSLNo") = Convert.ToDecimal(sTOTalHeading).ToString("N" & iRoundOff)
                                                    sRoundDebit = Val(sRoundDebit) + sTOTalHeading
                                                End If
                                            End If
                                        End If
                                        If dtheading(i)("PrevDbTotal") > dtheading(i)("PrevCrTotal") Then
                                            PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                            PrevTOTalHeading = Val(PrevTOTalHeading / iInAmt)
                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("N" & iRoundOff) & ")"
                                            sPRoundCredit = Val(sPRoundCredit) + PrevTOTalHeading
                                        Else
                                            PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                            PrevTOTalHeading = Val(PrevTOTalHeading / iInAmt)
                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                            If PrevTOTalHeading = 0 Then
                                                dr("PrevyearTotoal") = "-"
                                            Else
                                                If PrevTOTalHeading < 0 Then
                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading).ToString("N" & iRoundOff) & ")"
                                                    sPRoundDebit = Val(sPRoundDebit) + PrevTOTalHeading
                                                Else
                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("N" & iRoundOff)
                                                    sPRoundDebit = Val(sPRoundDebit) + PrevTOTalHeading
                                                End If
                                            End If
                                        End If
                                        d6 = TOTalHeading
                                        pD6 = PrevTOTalHeading
                                    Else
                                        If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                        Else
                                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                        End If
                                        If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
                                            PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                        Else
                                            PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                        End If
                                    End If
                                    dtdetails.Rows.Add(dr)
                                    'S1TotalAllHeadings = headingTotal + TOTalHeading
                                    PrevS2TotalAllHeadings = PrevheadingTotal + PrevTOTalHeading

                                    sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates
                                               Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID
                                               WHERE AST_Schedule_type  =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=2 and AST_HeadingID=" & dtheading(i)("ATBUD_Headingid") & " and AST_SubHeadingID <> 0
                                               group by AST_SubHeadingID, ASsH_Name,ASSH_Notes   order by ASSH_Notes   "
                                    dtsubHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtsubHeadschedTemp.Rows.Count > 0 Then
                                        num = dtdetails.Rows.Count - 1
                                        dtdetails(num)("HeaderSLNo") = ""
                                        dtdetails(num)("PrevyearTotoal") = ""
                                        For y = 0 To dtsubHeadschedTemp.Rows.Count - 1
                                            'Sub Heading
                                            sSql = ""
                                            sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,  "
                                            sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                                            sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId =" & IyearID - 1 & "  and e.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " where  ATBUD_Subheading= " & dtsubHeadschedTemp(y)("AST_SubHeadingID") & "  and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " "
                                            sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                                            dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtsubheading.Rows.Count > 0 Then
                                                For j = 0 To dtsubheading.Rows.Count - 1
                                                    If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = i + 1 & "-" & j + 1
                                                        dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubheading(j)("headingname")
                                                        If dtsubheading(j)("Notes") = 0 Then
                                                            dr("Notes") = ""
                                                        Else
                                                            dr("Notes") = dtsubheading(j)("Notes")
                                                        End If
                                                        If dtHeadschedTemp(x)("headingname").ToString.Trim = "VI Exceptional Items" Or dtsubheading(j)("headingname").ToString.Trim = "(c) Changes in inventories of finished goods, work-in-progress and stock-in-trade" Or dtsubheading(j)("headingname").ToString.Trim = "(a) Current Tax" Or dtsubheading(j)("headingname").ToString.Trim = "(c) Income Tax For Earlier Years" Then
                                                            If dtsubheading(j)("DbTotal") > dtsubheading(j)("CrTotal") Then
                                                                If dtsubheading(j)("CrTotal") = 0 Then
                                                                    subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                                                    If subCreditTotal < 0 Then
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(subCreditTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                        sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                                    Else
                                                                        If Val(subCreditTotal) = 0 Then
                                                                            dr("HeaderSLNo") = "-"
                                                                        Else
                                                                            If subCreditTotal > 0 Then
                                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                                sRoundCredit = Val(sRoundCredit) + Val(subCreditTotal)
                                                                            Else
                                                                                dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                                sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                                            End If
                                                                        End If
                                                                    End If
                                                                Else
                                                                    subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                                                    If subDebitTotal < 0 Then
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                    Else
                                                                        If Val(subDebitTotal) = 0 Then
                                                                            dr("HeaderSLNo") = "-"
                                                                        Else
                                                                            If subDebitTotal > 0 Then
                                                                                dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                                sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                            Else
                                                                                dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                                sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                            End If
                                                                        End If
                                                                    End If
                                                                End If
                                                            Else
                                                                subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                                                If Val(subDebitTotal) = 0 Then
                                                                    dr("HeaderSLNo") = "-"
                                                                Else
                                                                    If subDebitTotal > 0 Then
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                    Else
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)) & ")"
                                                                        sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                    End If
                                                                End If
                                                            End If
                                                            If dtsubheading(j)("PrevDbTotal") > dtsubheading(j)("PrevCrTotal") Then
                                                                subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
                                                                If subCreditTotal < 0 Then
                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(subCreditTotal / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & ")"
                                                                Else
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                End If
                                                            Else
                                                                subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
                                                                If Val(subDebitTotal) = 0 Then
                                                                    dr("PrevyearTotoal") = "-"
                                                                Else
                                                                    If subDebitTotal < 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)
                                                                    Else
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                End If
                                                                '  pD10 = Convert.ToDecimal(subDebitTotal).ToString("#,##0.00")
                                                            End If
                                                        Else
                                                            If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                                                subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                                                If subCreditTotal < 0 Then
                                                                    dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(subCreditTotal / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & ")"
                                                                    sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                                Else
                                                                    If Val(subCreditTotal) = 0 Then
                                                                        dr("HeaderSLNo") = "-"
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                        sRoundCredit = Val(sRoundCredit) + dr("HeaderSLNo")
                                                                    End If
                                                                End If
                                                            Else
                                                                subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                                                If Val(subDebitTotal) = 0 Then
                                                                    dr("HeaderSLNo") = "-"
                                                                Else
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                    sRoundDebit = Val(sRoundDebit) + dr("HeaderSLNo")
                                                                End If
                                                            End If
                                                            If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                                                subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
                                                                If subCreditTotal < 0 Then
                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(subCreditTotal / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & ")"
                                                                    sPRoundCredit = Val(sPRoundCredit) + dr("PrevyearTotoal")
                                                                Else
                                                                    If Val(subCreditTotal) = 0 Then
                                                                        dr("PrevyearTotoal") = "-"
                                                                    Else
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal / iInAmt).ToString("N" & iRoundOff)
                                                                        sRoundCredit = Val(sRoundCredit) + dr("PrevyearTotoal")
                                                                    End If
                                                                End If
                                                            Else
                                                                subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
                                                                If Val(subDebitTotal) = 0 Then
                                                                    dr("PrevyearTotoal") = "-"
                                                                Else
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(subDebitTotal / iInAmt).ToString("N" & iRoundOff)
                                                                    sPRoundDebit = Val(sPRoundDebit) + dr("PrevyearTotoal")
                                                                End If
                                                            End If
                                                        End If
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            Else
                                                dr = dtdetails.NewRow
                                                dr("SrNo") = ""
                                                dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
                                                If Val(dtsubHeadschedTemp(y)("Notes")) = "0" Then
                                                    dr("Notes") = ""
                                                Else
                                                    dr("Notes") = dtsubHeadschedTemp(y)("Notes")
                                                End If
                                                dr("HeaderSLNo") = "-"
                                                dr("PrevyearTotoal") = "-"
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    Else
                                    End If
                                End If
                            Next
                            dr = dtdetails.NewRow
                            dr("Srno") = ""
                            dr("Headingname") = "<B>" & "Total" & "</B>"
                            If dtHeadschedTemp(x)("headingname") = "VI Exceptional Items" Then
                                If DebitTotal > CreditTotal Then
                                    S2TotalAllHeadings = Val(CreditTotal - DebitTotal)
                                    If S2TotalAllHeadings < 0 Then
                                        Dim sStotalAllheading As String
                                        sStotalAllheading = Val(S2TotalAllHeadings)
                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(sStotalAllheading / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & ")"
                                    Else
                                        dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                    End If
                                    d10 = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                Else
                                    S2TotalAllHeadings = Val(DebitTotal - CreditTotal)
                                    If S2TotalAllHeadings < 0 Then
                                        dTempAmt = S2TotalAllHeadings
                                        dr("HeaderSLNo") = Convert.ToDecimal(Val(dTempAmt / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff)
                                    Else
                                        dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                    End If
                                    d10 = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                End If
                                If PrevCreditTotal > PrevDebitTotal Then
                                    PrevS2TotalAllHeadings = Val(PrevCreditTotal - PrevDebitTotal)
                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                    pD10 = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                Else
                                    PrevS2TotalAllHeadings = Val(PrevDebitTotal - PrevCreditTotal)
                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                    pD10 = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                End If
                                d6 = S2TotalAllHeadings
                                pD6 = PrevS2TotalAllHeadings
                            ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "X Tax Expense" Then
                                If DebitTotal > CreditTotal Then
                                    S2TotalAllHeadings = Val(CreditTotal - DebitTotal)
                                    If S2TotalAllHeadings < 0 Then
                                        Dim sStotalAllheading As String
                                        sStotalAllheading = Val(S2TotalAllHeadings)
                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(sStotalAllheading / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & ")"
                                    Else
                                        dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                    End If
                                    d10 = -Val(CreditTotal - DebitTotal)
                                    d10int = -Val(CreditTotal - DebitTotal)
                                    d10 = -Val(S2TotalAllHeadings / iInAmt)
                                    d10int = -Val(S2TotalAllHeadings / iInAmt)
                                Else
                                    S2TotalAllHeadings = Val(CreditTotal - DebitTotal)
                                    If S2TotalAllHeadings < 0 Then
                                        dTempAmt = S2TotalAllHeadings
                                        dr("HeaderSLNo") = Convert.ToDecimal(Val(dTempAmt / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff)
                                    Else
                                        If S2TotalAllHeadings = 0 Then
                                            dr("HeaderSLNo") = ""
                                        Else
                                            dr("HeaderSLNo") = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                        End If
                                    End If
                                    '      d10int = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                    d10 = -Val(DebitTotal - CreditTotal)
                                    d10int = -Val(-DebitTotal - CreditTotal)
                                    d10 = -Val(S2TotalAllHeadings / iInAmt)
                                    d10int = -Val(S2TotalAllHeadings / iInAmt)
                                End If
                                If PrevDebitTotal > PrevCreditTotal Then
                                    PrevS2TotalAllHeadings = Val(PrevCreditTotal - PrevDebitTotal)
                                    If PrevS2TotalAllHeadings < 0 Then
                                        Dim sPrevStotalAllheading As String
                                        sPrevStotalAllheading = Val(PrevS2TotalAllHeadings)
                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(sPrevStotalAllheading / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & ")"
                                    Else
                                        dr("PrevyearTotoal") = Convert.ToDecimal(S2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                    End If
                                    pD10 = -Val(PrevDebitTotal - PrevCreditTotal)
                                    pD10 = -Val(PrevS2TotalAllHeadings / iInAmt)
                                Else
                                    PrevS2TotalAllHeadings = Val(PrevCreditTotal - PrevDebitTotal)
                                    If PrevS2TotalAllHeadings = 0 Then
                                        dr("PrevyearTotoal") = "-"
                                    Else
                                        If PrevS2TotalAllHeadings < 0 Then
                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff).Remove(0, 1)
                                            pD10 = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                        Else
                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                            pD10 = Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff)
                                        End If
                                    End If
                                    pD10 = -Val(PrevDebitTotal - PrevCreditTotal)
                                    pD10 = -Val(PrevS2TotalAllHeadings / iInAmt)
                                End If
                                d6 = (S2TotalAllHeadings / iInAmt)
                                pD6 = (PrevS2TotalAllHeadings / iInAmt)
                            Else
                                If sRoundCredit > sRoundDebit Then
                                    S2TotalAllHeadings = Val(sRoundCredit - sRoundDebit)
                                    dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S2TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                    d10 = -Val(sRoundCredit - sRoundDebit)
                                    d10int = -Val(sRoundCredit - sRoundDebit)
                                Else
                                    S2TotalAllHeadings = Val(sRoundDebit - sRoundCredit)
                                    If S2TotalAllHeadings < 0 Then
                                        dr("HeaderSLNo") = "<B>" & "(" & Convert.ToDecimal(S2TotalAllHeadings).ToString("N" & iRoundOff).Remove(0, 1) & ")" & "</B>"
                                    Else
                                        If S2TotalAllHeadings = 0 Then
                                            dr("HeaderSLNo") = "-"
                                        Else
                                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(S2TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                        End If
                                    End If
                                    d10int = Val(sRoundDebit - sRoundCredit)
                                End If
                                If sPRoundCredit > sPRoundDebit Then
                                    PrevS2TotalAllHeadings = sPRoundCredit - sPRoundDebit
                                    dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                    pD10 = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("N" & iRoundOff)
                                Else
                                    PrevS2TotalAllHeadings = sPRoundDebit - sPRoundCredit
                                    If PrevS2TotalAllHeadings = 0 Then
                                        dr("PrevyearTotoal") = "-"
                                        pD10 = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                    Else
                                        dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("N" & iRoundOff) & "</B>"
                                        pD10 = Convert.ToDecimal(PrevS2TotalAllHeadings).ToString("N" & iRoundOff)
                                    End If
                                End If
                            End If
                            s5TotalHeadings = s5TotalHeadings + S2TotalAllHeadings
                            Prevs5TotalHeadings = Prevs5TotalHeadings + PrevS2TotalAllHeadings
                            dtdetails.Rows.Add(dr)
                            CreditTotal = 0 : DebitTotal = 0
                            PrevCreditTotal = 0 : PrevDebitTotal = 0
                            sRoundDebit = 0 : sRoundCredit = 0
                            sPRoundDebit = 0 : sPRoundCredit = 0
                        Else
                            If iSchedulrTypeIdd = 3 And iRepType = 1 Then
                                If dtHeadschedTemp(x)("headingname").ToString.Trim = "V Profit Before Exceptional and Extraordinary Item and tax" Or dtHeadschedTemp(x)("headingname").ToString.Trim = "IV Profit before exceptional items and tax (II - III)" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    d5 = s5TotalHeadings - s4TotalHeadings
                                    pD5 = Prevs5TotalHeadings - Prevs4TotalHeadings
                                    If d5 < 0 Then
                                        dr("HeaderSLNo") = Convert.ToDecimal(d5).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If d5 = 0 Then
                                            dr("HeaderSLNo") = "-"
                                        Else
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(d5).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If
                                    If pD5 < 0 Then
                                        dr("PrevyearTotoal") = Convert.ToDecimal(pD5).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If pD5 = 0 Then
                                            dr("PrevyearTotoal") = "-"
                                        Else
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(pD5).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If
                                    dtdetails.Rows.Add(dr)
                                ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "VI Exceptional Items" Or dtHeadschedTemp(x)("headingname").ToString.Trim = "V Exceptional items" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    If Val(d6) = 0 Then
                                        dr("HeaderSLNo") = "-"
                                    Else
                                        dr("HeaderSLNo") = d6
                                    End If
                                    dr("PrevyearTotoal") = "-" 'pd6
                                    dtdetails.Rows.Add(dr)
                                    sSql = "   Select  AST_SubHeadingID,AsSH_Name As headingname,ASSH_Notes As Notes FROM ACC_ScheduleTemplates "
                                    sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a On a.assh_id=AST_subHeadingID "
                                    sSql = sSql & "                  WHERE AST_Schedule_type =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "And AST_AccHeadId=2 And AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                                    sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                                    dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtsubItemSched.Rows.Count > 0 Then
                                        For m = 0 To dtsubItemSched.Rows.Count - 1
                                            If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
                                                If dtsubItemSched(m)("Notes") <> "0" Then
                                                    dr("Notes") = dtsubItemSched(m)("Notes")
                                                Else
                                                    dr("Notes") = ""
                                                End If
                                                dtdetails(num)("HeaderSLNo") = "-"
                                                dtdetails(num)("PrevyearTotoal") = "-"
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "VII  Profit Before Extraordinary Item and Tax" Or dtHeadschedTemp(x)("headingname").ToString.Trim = "VI Profit before tax (IV - V)" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    If orgTypeId = 68 Then
                                        d7 = Val(d5) - Val(d6)
                                        pD7 = Val(pD5) - Val(pD6)
                                    Else
                                        If Val(d6) < 0 Then
                                            d7 = Val(d5) - Val(d6)
                                        Else
                                            d7 = Val(d5) + Val(d6)
                                        End If
                                        pD7 = Val(pD5) + Val(pD6)
                                    End If
                                    If Val(d7) < 0 Then
                                        dr("HeaderSLNo") = Convert.ToDecimal(d7).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If d7 = 0 Then
                                            dr("HeaderSLNo") = "-"
                                        Else
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(d7).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If
                                    If Val(pD7) < 0 Then
                                        dr("PrevyearTotoal") = Convert.ToDecimal(pD7).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If pD7 = 0 Then
                                            dr("PrevyearTotoal") = "-"
                                        Else
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(pD7).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If

                                    dtdetails.Rows.Add(dr)
                                    If orgTypeId = 68 Then
                                        Dim sD7Amt As String = ""
                                        sD7Amt = d7
                                        If d7 < 0 Then
                                            sPandLAmount = d7.Remove(0, 1)
                                        Else
                                            sPandLAmount = -d7
                                        End If
                                    End If
                                ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "VIII  Extraordinary Items" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    dr("HeaderSLNo") = "-" 'd8
                                    dr("PrevyearTotoal") = "-" 'pd8
                                    d8 = 0
                                    pD8 = 0
                                    dtdetails.Rows.Add(dr)
                                ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "IX Profit Before Tax" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    d9 = Val(d7 - d8)
                                    pD9 = Val(pD7 - pD8)
                                    If d9 < 0 Then
                                        dr("HeaderSLNo") = Convert.ToDecimal(d9).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If d9 = 0 Then
                                            dr("HeaderSLNo") = "-"
                                        Else
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(d9).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If
                                    If pD9 < 0 Then
                                        dr("PrevyearTotoal") = Convert.ToDecimal(pD9).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If pD9 = 0 Then
                                            dr("PrevyearTotoal") = "-"
                                        Else
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(pD9).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If
                                    dtdetails.Rows.Add(dr)
                                    d10 = 0
                                    pD10 = 0
                                    d10int = 0
                                ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "X Tax Expense" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    dr("HeaderSLNo") = "-"
                                    dr("PrevyearTotoal") = "-"
                                    dtdetails.Rows.Add(dr)
                                    sSql = "   Select  AST_SubHeadingID,AsSH_Name As headingname,ASSH_Notes As Notes FROM ACC_ScheduleTemplates "
                                    sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a On a.assh_id=AST_subHeadingID "
                                    sSql = sSql & "                  WHERE AST_Schedule_type =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "And AST_AccHeadId=2 And AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                                    sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                                    dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtsubItemSched.Rows.Count > 0 Then
                                        For m = 0 To dtsubItemSched.Rows.Count - 1
                                            If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
                                                If dtsubItemSched(m)("Notes") <> "0" Then
                                                    dr("Notes") = dtsubItemSched(m)("Notes")
                                                Else
                                                    dr("Notes") = ""
                                                End If
                                                dtdetails(num)("HeaderSLNo") = "-"
                                                dtdetails(num)("PrevyearTotoal") = "-"
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                ElseIf dtHeadschedTemp(x)("headingname").ToString.Trim = "XI Profit / (Loss) for the Period from Continuing Operations" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    d11 = Val(d9 + d10int)
                                    pD11 = Val(Val(pD9) + Val(pD10))
                                    If d11 < 0 Then
                                        If d11 <> 0 Then
                                            dr("HeaderSLNo") = Convert.ToDecimal(d11).ToString("N" & iRoundOff).Remove(0, 1)
                                        Else
                                            dr("HeaderSLNo") = "-"
                                        End If
                                    Else
                                        If d11 <> 0 Then
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(d11).ToString("N" & iRoundOff) & ")"
                                        Else
                                            dr("HeaderSLNo") = "-"
                                        End If
                                    End If
                                    If pD11 < 0 Then
                                        dr("PrevyearTotoal") = Convert.ToDecimal(pD11).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If pD11 = 0 Then
                                            dr("PrevyearTotoal") = "-"
                                        Else
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(pD11).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If
                                    dtdetails.Rows.Add(dr)
                                ElseIf dtHeadschedTemp(x)("headingname") = "XII Profit / (Loss)  from Discontinuing Operations " Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    dr("HeaderSLNo") = "-"
                                    dr("PrevyearTotoal") = "-"
                                    dtdetails.Rows.Add(dr)
                                ElseIf dtHeadschedTemp(x)("headingname") = "XIII Tax from Discontinuing operations" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    dr("HeaderSLNo") = "-"
                                    dr("PrevyearTotoal") = "-"
                                    dtdetails.Rows.Add(dr)
                                ElseIf dtHeadschedTemp(x)("headingname") = "XIV Profit/ (Loss) from Discontinuing Operations" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    dr("HeaderSLNo") = "-"
                                    dr("PrevyearTotoal") = "-"
                                    dtdetails.Rows.Add(dr)
                                ElseIf dtHeadschedTemp(x)("headingname") = "XV Profit/ (Loss) for the Period" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    d15 = Val(d11 + d12 + d13 + d14 + d15)
                                    pD15 = Val(pD11 + pD12 + pD13 + pD14 + pD15)
                                    If d15 < 0 Then
                                        If d15 <> 0 Then
                                            dr("HeaderSLNo") = Convert.ToDecimal(d15).ToString("N" & iRoundOff).Remove(0, 1)
                                            sPandLAmount = d15.Remove(0, 1)
                                        Else
                                            dr("HeaderSLNo") = "-"
                                        End If
                                    Else
                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(d15).ToString("N" & iRoundOff) & ")"
                                        sPandLAmount = -d15
                                    End If
                                    If pD15 < 0 Then
                                        dr("PrevyearTotoal") = Convert.ToDecimal(pD15).ToString("N" & iRoundOff).Remove(0, 1)
                                    Else
                                        If pD15 = 0 Then
                                            dr("PrevyearTotoal") = "-"
                                        Else
                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(pD15).ToString("N" & iRoundOff) & ")"
                                        End If
                                    End If

                                    dtdetails.Rows.Add(dr)
                                ElseIf dtHeadschedTemp(x)("headingname") = "XVI Earning per Equity share" Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = ""
                                    dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                    dr("HeaderSLNo") = "-"
                                    dr("PrevyearTotoal") = "-"
                                    dtdetails.Rows.Add(dr)
                                    sSql = "   Select  AST_SubHeadingID,AsSH_Name As headingname,ASSH_Notes As Notes FROM ACC_ScheduleTemplates "
                                    sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a On a.assh_id=AST_subHeadingID "
                                    sSql = sSql & "                  WHERE AST_Schedule_type =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "And AST_AccHeadId=2 And AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                                    sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                                    dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtsubItemSched.Rows.Count > 0 Then
                                        For m = 0 To dtsubItemSched.Rows.Count - 1
                                            If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
                                                If dtsubItemSched(m)("Notes") <> "0" Then
                                                    dr("Notes") = dtsubItemSched(m)("Notes")
                                                Else
                                                    dr("Notes") = ""
                                                End If
                                                dtdetails(num)("HeaderSLNo") = "-"
                                                dtdetails(num)("PrevyearTotoal") = "-"
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                End If
                            Else
                                dr = dtdetails.NewRow
                                dr("SrNo") = ""
                                dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                                dr("HeaderSLNo") = "-"
                                dr("PrevyearTotoal") = "-"
                                dtdetails.Rows.Add(dr)
                                sSql = "   Select  AST_SubHeadingID,AsSH_Name As headingname,ASSH_Notes As Notes FROM ACC_ScheduleTemplates "
                                sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a On a.assh_id=AST_subHeadingID "
                                sSql = sSql & "                  WHERE AST_Schedule_type =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "And AST_AccHeadId=2 And AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                                sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                                dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
                                If dtsubItemSched.Rows.Count > 0 Then
                                    For m = 0 To dtsubItemSched.Rows.Count - 1
                                        If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
                                            If Val(dtsubItemSched(m)("Notes")) <> 0 Then
                                                dr("Notes") = dtsubItemSched(m)("Notes")
                                            Else
                                                dr("Notes") = ""
                                            End If
                                            dtdetails(num)("HeaderSLNo") = "-"
                                            dtdetails(num)("PrevyearTotoal") = "-"
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    Next
                                End If
                            End If
                        End If
                    Next
                    If iSchedulrTypeIdd = 3 Then
                    Else
                        dr = dtdetails.NewRow
                        dr("Srno") = ""
                        dr("Headingname") = "<B>" & "Total Assets " & "</B>"
                        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(s5TotalHeadings).ToString("N" & iRoundOff) & "</B>"
                        If Prevs5TotalHeadings = 0 Then
                            dr("PrevyearTotoal") = "<B>" & "-" & "</B>"
                        Else
                            dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(Prevs5TotalHeadings).ToString("N" & iRoundOff) & "</B>"
                        End If
                        dtdetails.Rows.Add(dr)
                    End If
                End If
                'Detailed Report
            ElseIf iRepType = 2 Then
                Dim a1 As Integer = 0
                ' For AccHead =1 
                sSql = "Select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  As CrTotal, "
                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  As DbTotal, a.ASH_Notes  from Acc_TrailBalance_Upload_Details "
                sSql = sSql & " left join ACC_ScheduleHeading a On a.ASH_ID=  ATBUD_Headingid"
                sSql = sSql & " left join Acc_TrailBalance_Upload d On d.ATBU_Description = ATBUD_Description And d.ATBU_Description = ATBUD_Description "
                sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " And ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & ""
                If sSelectedBranches <> "0" Then
                    sSql = sSql & " And d.Atbu_Branchid In (" & sSelectedBranches & ")"
                End If
                sSql = sSql & " And EXISTS(Select * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid And AST_AccHeadId =1 ) group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
                dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtheading.Rows.Count > 0 Then
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then
                            'Fetch desc under Heading
                            sSql = "Select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name As headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  As CrTotal,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  As DbTotal  from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b On b.ATBUD_Description  = ATBU_Description   left join ACC_ScheduleHeading a On a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & "  And b.atbud_compid = " & iACID & " And ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & " And ATBU_YEARId=" & IyearID & ""
                            If sSelectedBranches <> "0" Then
                                sSql = sSql & " And Atbu_Branchid In (" & sSelectedBranches & ")"
                            End If
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name,ATBU_Branchid order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtdescdetails.Rows.Count > 0 Then
                                CreditTotal = 0 : DebitTotal = 0
                            End If
                        End If
                        sSql = "   Select  AST_SubHeadingID,AsSH_Name As headingname,ASSH_Notes As Notes FROM ACC_ScheduleTemplates
                                               Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID
                                               WHERE AST_Schedule_type  =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=2 and AST_HeadingID=" & dtheading(i)("ATBUD_Headingid") & "
                                               group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                        dtsubHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
                        'Sub Heading
                        sSql = ""
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotalPrev, "
                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotalPrev "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & "  and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & " and d.ATBU_Branchid=Atbud_Branchnameid  "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID and e.ASHN_CustomerId=" & ICustid & " and e.ASHN_YearID=" & IyearID & ""
                        sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description and ATBUD_SubItemId=0 and ATBUD_itemid=0 And f.ATBU_YEARId=" & IyearID & "  and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                        sSql = sSql & " left join Acc_TrailBalance_Upload g on g.ATBU_Description = ATBUD_Description and ATBUD_SubItemId=0 and ATBUD_itemid=0 And g.ATBU_YEARId=" & IyearID - 1 & "  and g.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & " and g.ATBU_Branchid=Atbud_Branchnameid "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And g.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & "   And ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            headingTotal = 0
                            DebitTotal = 0
                            CreditTotal = 0
                            Dim iSubHeadingId, iId As Integer
                            For j = 0 To dtsubheading.Rows.Count - 1
                                iId = dtsubheading(j)("ATBUD_Subheading")
                                iSubHeadingId = objDBL.SQLExecuteScalar(sAC, " select 1  where " & iId & " in (" & sSelectedSHeading & ")  ")
                                If iSubHeadingId <> 1 Then
                                    If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                        If iStat = 1 Then
                                            If dtsubheading(j)("CrTotal") = 0 And dtsubheading(j)("DbTotal") = 0 And dtsubheading(j)("CrTotalPrev") = 0 And dtsubheading(j)("DbTotalPrev") = 0 Then
                                                GoTo DeescSubHead
                                            End If
                                        End If
                                        dr = dtdetails.NewRow
                                        a1 = a1 + 1
                                        dr("SrNo") = a1
                                        dr("Headingname") = "<B>" & dtsubheading(j)("headingname") & "</B>"
                                        dr("Notes") = dtsubheading(j)("Notes")
                                        If dtsubheading(j)("CrTotal1") > dtsubheading(j)("DbTotal1") Then
                                            CreditTotal = CreditTotal + dtsubheading(j)("CrTotal1")
                                            TOTalHeading = dtsubheading(j)("CrTotal1") - dtsubheading(j)("DbTotal1")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                            dr("HeaderSLNo") = ""
                                        Else
                                            DebitTotal = DebitTotal + dtsubheading(j)("CrTotal1")
                                            TOTalHeading = dtsubheading(j)("DbTotal1") - dtsubheading(j)("CrTotal1")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                            dr("HeaderSLNo") = ""
                                        End If
                                        dtdetails.Rows.Add(dr)
                                        '''' Description Under Sub Heading
                                        If dtsubheading(j)("CrTotal1") <> 0 Or dtsubheading(j)("DbTotal1") <> 0 Then
                                            sSql = ""
                                            sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
                                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
                                            sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                                            sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal, "
                                            sSql = sSql & " ISNULL(Sum(d.ATBU_Opening_Credit_Amount + 0), 0)  As CrOPB, "
                                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Opening_Debit_Amount + 0), 0)  As DbOPB , "
                                            sSql = sSql & "  ISNULL(Sum(d.ATBU_TR_Credit_Amount + 0), 0)  As CrTRn, "
                                            sSql = sSql & "  ISNULL(Sum(d.ATBU_TR_Debit_Amount + 0), 0)  As DbTRn,  "

                                            sSql = sSql & " ISNULL(Sum(f.ATBU_Opening_Credit_Amount + 0), 0)  As CrPrevOPB, "
                                            sSql = sSql & "  ISNULL(Sum(f.ATBU_Opening_Debit_Amount + 0), 0)  As DbPrevOPB , "
                                            sSql = sSql & "  ISNULL(Sum(f.ATBU_TR_Credit_Amount + 0), 0)  As CrPrevTRn, "
                                            sSql = sSql & "  ISNULL(Sum(f.ATBU_TR_Debit_Amount + 0), 0)  As DbPrevTRn  "
                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                                            sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description  And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & " and d.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID and e.ASHN_CustomerId=" & ICustid & " and e.ASHN_YearID=" & IyearID & ""
                                            sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & " and f.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "   and ATBUD_SubItemId=0 and ATBUD_itemid=0"
                                            sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)

                                            If dtdescdetails.Rows.Count > 0 Then
                                                CreditTotal = 0 : DebitTotal = 0
                                                For k = 0 To dtdescdetails.Rows.Count - 1


                                                    If iStat = 1 Then
                                                        If dtdescdetails(k)("CrTotal") = 0 And dtdescdetails(k)("DbTotal") = 0 And dtdescdetails(k)("PrevCrTotal") = 0 And dtdescdetails(k)("PrevDbTotal") = 0 Then
                                                            GoTo DescZero1
                                                        End If
                                                    End If
                                                    Dim sOpbAmt, sTransCr, sTransDb, sPnLAmt, dPartnerDet, dShareAmt, dLessAmt, dTotalAmt, dGrandTot As Double
                                                    Dim sPrevOpbAmt, sPrevTransCr, sPrevTransDb, sPrevPnLAmt, dPrevPartnerDet, dPrevSHareAmt, dLessPrevAmt, dPrevTotalAmt, dPrevGrandTot As Double
                                                    If dtdescdetails(k)("headingname").ToString.Trim = "(a)   Proprietor capital" Or dtdescdetails(k)("headingname").ToString.Trim = "Partner Capital A/c" Then
                                                        'GoTo Prop_capital
                                                        If dtsubheading(j)("headingname") = "(a)   Proprietor capital" And orgTypeId = 74 Then
                                                            dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                                                            dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                                            dtCustPartnerDet = getCustPartnerDet(sAC, iACID, ICustid, dtdescdetails(k)("ATBUD_Description"))
                                                            If dtCustPartnerDet.Rows.Count > 0 Then
                                                                For d = 0 To dtCustPartnerDet.Rows.Count - 1
                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = dtdescdetails(k)("ATBUD_Description")
                                                                    dr("HeaderSLNo") = "-"
                                                                    dr("PrevyearTotoal") = "-"
                                                                    dtdetails.Rows.Add(dr)
                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Opening "
                                                                    If Val(dtdescdetails(k)("CrOPB")) = 0 Then
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(k)("CrOPB") / iInAmt).ToString("N" & iRoundOff)
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(k)("CrOPB") / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                    sOpbAmt = dr("HeaderSLNo")
                                                                    If Val(dtdescdetails(k)("CrOPB")) = 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(k)("CrPrevOPB") / iInAmt).ToString("N" & iRoundOff)
                                                                    Else
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(k)("CrPrevOPB") / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                    sPrevOpbAmt = dr("PrevyearTotoal")
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Addition "
                                                                    If Val(dtdescdetails(k)("CrOPB")) = 0 Then
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(k)("CrTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(k)("CrTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                    sTransCr = dr("HeaderSLNo")
                                                                    If Val(dtdescdetails(k)("CrOPB")) = 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(k)("CrPrevTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    Else
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(k)("CrPrevTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                    sPrevTransCr = dr("PrevyearTotoal")
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Add Profit "
                                                                    If dPandLamt < 0 Then
                                                                        dr("HeaderSLNo") = "(" & Val(dPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                    sPnLAmt = dr("HeaderSLNo")
                                                                    If dPrevPandLamt < 0 Then
                                                                        dr("PrevyearTotoal") = "(" & Val(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                                                    Else
                                                                        If dPrevPandLamt = 0 Then
                                                                            dr("PrevyearTotoal") = "0.00"
                                                                        Else
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                                        End If
                                                                    End If
                                                                    sPrevPnLAmt = dr("PrevyearTotoal")
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Total "
                                                                    dPartnerDet = Val(sOpbAmt + sTransCr + sPnLAmt)
                                                                    dPrevPartnerDet = Val(sPrevOpbAmt + sPrevTransCr + sPrevPnLAmt)
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(dPartnerDet / iInAmt).ToString("N" & iRoundOff)
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPartnerDet / iInAmt).ToString("N" & iRoundOff)
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Lessing "
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(k)("DbTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(k)("DbPrevTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    dtdetails.Rows.Add(dr)
                                                                Next
                                                            End If
                                                        End If
                                                        If dtsubheading(j)("headingname") = "Partner Capital A/c" And orgTypeId = 68 Then
                                                            dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                                                            dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                                            dtCustPartnerDet = getCustPartnerDet(sAC, iACID, ICustid, dtdescdetails(k)("ATBUD_Description"))
                                                            If dtCustPartnerDet.Rows.Count > 0 Then
                                                                For d = 0 To dtCustPartnerDet.Rows.Count - 1
                                                                    dShareAmt = (dPandLamt / dtCustPartnerDet(d)("SSP_ShareOfProfit"))
                                                                    dPrevSHareAmt = (dPrevPandLamt / dtCustPartnerDet(d)("SSP_ShareOfProfit"))
                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = dtdescdetails(k)("ATBUD_Description")
                                                                    dr("HeaderSLNo") = ""
                                                                    dr("PrevyearTotoal") = ""
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Opening "
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(k)("CrOPB") / iInAmt).ToString("N" & iRoundOff)
                                                                    sOpbAmt = dr("HeaderSLNo")
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(k)("CrPrevOPB") / iInAmt).ToString("N" & iRoundOff)
                                                                    sPrevOpbAmt = dr("PrevyearTotoal")
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Addition "
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(k)("CrTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    sTransCr = dr("HeaderSLNo")
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(k)("CrPrevTRn") / iInAmt).ToString("N" & iRoundOff)
                                                                    sPrevTransCr = dr("PrevyearTotoal")
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Add Profit "
                                                                    If dShareAmt < 0 Then
                                                                        dr("HeaderSLNo") = "(" & Val(dShareAmt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(dShareAmt / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                    sPnLAmt = dr("HeaderSLNo")
                                                                    If dPrevSHareAmt < 0 Then
                                                                        dr("PrevyearTotoal") = "(" & Val(dPrevSHareAmt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                                                    Else
                                                                        If dPrevPandLamt = 0 Then
                                                                            dr("PrevyearTotoal") = "0.00"
                                                                        Else
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(dPrevSHareAmt / iInAmt).ToString("N" & iRoundOff)
                                                                        End If
                                                                    End If
                                                                    sPrevPnLAmt = dr("PrevyearTotoal")
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Total "
                                                                    dPartnerDet = Val(sOpbAmt + sTransCr + sPnLAmt)
                                                                    dPrevPartnerDet = Val(sPrevOpbAmt + sPrevTransCr + sPrevPnLAmt)
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(dPartnerDet).ToString("N" & iRoundOff)
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPartnerDet).ToString("N" & iRoundOff)
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Lessing "
                                                                    dLessAmt = dtdescdetails(k)("DbTRn")
                                                                    dLessPrevAmt = dtdescdetails(k)("DbPrevTRn")
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(dLessAmt / iInAmt).ToString("N" & iRoundOff)
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dLessPrevAmt / iInAmt).ToString("N" & iRoundOff)
                                                                    dtdetails.Rows.Add(dr)

                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = "Total "
                                                                    dTotalAmt = dPartnerDet - dLessAmt
                                                                    dPrevPandLamt = dPrevPartnerDet - dLessPrevAmt
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(dTotalAmt / iInAmt).ToString("N" & iRoundOff)
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                                                    dtdetails.Rows.Add(dr)


                                                                    dr = dtdetails.NewRow
                                                                    dr("SrNo") = a1
                                                                    dr("Headingname") = ""
                                                                    dtdetails.Rows.Add(dr)

                                                                Next
                                                            End If
                                                        End If
                                                    Else
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = a1
                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
                                                        If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
                                                            CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
                                                            TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            DebitTotal = DebitTotal + dtdescdetails(k)("DbTotal")
                                                            TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            If TOTalHeading < 0 Then
                                                                sTotal = TOTalHeading
                                                                sTotal = Convert.ToDecimal(Val(sTotal).ToString.Remove(0, 1)).ToString("N" & iRoundOff)
                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If TOTalHeading <> 0 Then
                                                                    dr("HeaderSLNo") = TOTalHeading
                                                                Else
                                                                    dr("HeaderSLNo") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                        ' PrevTOtal
                                                        If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(Val(sTotal).ToString.Remove(0, 1)).ToString("N" & iRoundOff)
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                            End If
                                                        Else
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = 0
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(Val(sTotal).ToString.Remove(0, 1)).ToString("N" & iRoundOff)
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If PrevTOTalHeading > 0 Then
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("PrevyearTotoal") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                        dtdetails.Rows.Add(dr)
                                                    End If
DescZero1:                                      Next
                                            End If

                                        Else
                                            ' Prev desc PrevYear
                                            If dtsubheading(j)("CrTotalPrev") <> 0 Or dtsubheading(j)("DbTotalPrev") <> 0 Then
                                                sSql = ""
                                                sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
                                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
                                                sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                                                sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                                                sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description  And d.ATBU_YEARId=" & IyearID & "  and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & " and d.ATBU_Branchid=Atbud_Branchnameid "
                                                If sSelectedBranches <> "0" Then
                                                    sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                End If
                                                sSql = sSql & " left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID and e.ASHN_CustomerId=" & ICustid & " and e.ASHN_YearID=" & IyearID & ""
                                                sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & " and f.ATBU_Branchid=Atbud_Branchnameid "
                                                If sSelectedBranches <> "0" Then
                                                    sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                End If
                                                sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "    and ATBUD_SubItemId=0 and ATBUD_itemid=0 "
                                                sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
                                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                If dtdescdetails.Rows.Count > 0 Then
                                                    CreditTotal = 0 : DebitTotal = 0
                                                    For k = 0 To dtdescdetails.Rows.Count - 1
                                                        If iStat = 1 Then
                                                            If dtdescdetails(k)("CrTotal") = 0 And dtdescdetails(k)("DbTotal") = 0 And dtdescdetails(k)("PrevCrTotal") = 0 And dtdescdetails(k)("PrevDbTotal") = 0 Then
                                                                GoTo DescZero2
                                                            End If
                                                        End If
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = a1
                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
                                                        If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
                                                            CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
                                                            TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
                                                            TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            If TOTalHeading < 0 Then
                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("N" & iRoundOff)
                                                            End If
                                                        End If
                                                        ' PrevTOtal
                                                        If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                            Else
                                                                If PrevTOTalHeading <> 0 Then
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("PrevyearTotoal") = "0.00"
                                                                End If
                                                            End If
                                                        Else
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal).ToString.Remove(0, 1).ToString()
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If PrevTOTalHeading <> 0 Then
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("PrevyearTotoal") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                        dtdetails.Rows.Add(dr)
DescZero2:                                          Next
                                                End If
                                            End If
                                        End If
                                        TOTalHeading = 0
                                        sSql = ""
                                        sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
                                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As PrevCrTotal, "
                                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As PrevDbTotal "
                                        sSql = sSql & "from Acc_TrailBalance_Upload_Details  "
                                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                                        If sSelectedBranches <> "0" Then
                                            sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                        End If
                                        sSql = sSql & "   left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description and ATBUD_SubItemId=0 And f.ATBU_YEARId=" & IyearID & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                                        If sSelectedBranches <> "0" Then
                                            sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                        End If
                                        sSql = sSql & "   left join Acc_TrailBalance_Upload g on g.ATBU_Description=ATBUD_Description and ATBUD_SubItemId=0 And g.ATBU_YEARId=" & IyearID - 1 & " and g.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  and g.ATBU_Branchid=Atbud_Branchnameid "
                                        If sSelectedBranches <> "0" Then
                                            sSql = sSql & " And g.Atbu_Branchid in (" & sSelectedBranches & ")"
                                        End If
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & "  And ATBUD_CustId=" & ICustid & ""
                                        sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0   group by ATBUD_itemid,a.ASI_Name"
                                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtitem.Rows.Count > 0 Then
                                            Dim iItemId, iIds As Integer
                                            For a = 0 To dtitem.Rows.Count - 1
                                                iIds = dtitem(a)("ATBUD_itemid")
                                                iItemId = objDBL.SQLExecuteScalar(sAC, " select 1  where " & iIds & " in (" & sSelectedItems & ")  ")
                                                If iItemId <> 1 Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = a1
                                                    dr("Headingname") = dtitem(a)("headingname")
                                                    If dtitem(a)("CrTotal1") > dtitem(a)("DbTotal1") Then
                                                        CreditTotal = CreditTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("CrTotal1") - dtitem(a)("DbTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        dr("HeaderSLNo") = ""
                                                    Else
                                                        DebitTotal = DebitTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("DbTotal1") - dtitem(a)("CrTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        dr("HeaderSLNo") = ""
                                                    End If
                                                    ' PrevTOtal
                                                    If PrevTOTalHeading < 0 Then
                                                        sTotal = 0
                                                        sTotal = PrevTOTalHeading
                                                        sTotal = Convert.ToDecimal(sTotal).ToString.Remove(0, 1).ToString()
                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                    Else
                                                        If PrevTOTalHeading > 0 Then
                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            dr("PrevyearTotoal") = "0.00"
                                                        End If
                                                    End If
                                                    dr("PrevyearTotoal") = ""
                                                    dtdetails.Rows.Add(dr)
                                                    'Description Under Item 
                                                    If dtitem(a)("CrTotal1") <> 0 Or dtitem(a)("DbTotal1") <> 0 Then
                                                        'Fetching Desc under Item Name  
                                                        sSql = "select ATBUD_Description, "
                                                        sSql = sSql & "  ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,
 ISNULL(Sum(b.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,
 ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal1,
 ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal1"
                                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_Description = ATBUD_Description and b.ATBU_Branchid=Atbud_Branchnameid   and b.ATBU_YEARId=" & IyearID & " and b.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  "
                                                        If sSelectedBranches <> "0" Then
                                                            sSql = sSql & " And b.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                        End If
                                                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description and e.ATBU_Branchid=Atbud_Branchnameid  And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  "
                                                        If sSelectedBranches <> "0" Then
                                                            sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                        End If
                                                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                                        If sSelectedBranches <> "0" Then
                                                            sSql = sSql & " And Atbud_Branchnameid in (" & sSelectedBranches & ")"
                                                        End If
                                                        sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
                                                        sSql = sSql & " group by ATBUD_Description "
                                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                        If dtdescdetails.Rows.Count > 0 Then
                                                            CreditTotal = 0 : DebitTotal = 0
                                                            For k = 0 To dtdescdetails.Rows.Count - 1
                                                                If iStat = 1 Then
                                                                    If dtdescdetails(k)("CrTotal") = 0 And dtdescdetails(k)("DbTotal") = 0 And dtdescdetails(k)("CrTotal1") = 0 And dtdescdetails(k)("DbTotal1") = 0 Then
                                                                        GoTo DescZero3
                                                                    End If
                                                                End If

                                                                dr = dtdetails.NewRow
                                                                dr("SrNo") = a1
                                                                dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
                                                                If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
                                                                    CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
                                                                    TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
                                                                    TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    If TOTalHeading < 0 Then
                                                                        sTotal = TOTalHeading
                                                                        sTotal = Convert.ToDecimal(Val(sTotal).ToString.Remove(0, 1)).ToString("N" & iRoundOff)
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                End If
                                                                '01_11_23
                                                                ' PrevTOtal
                                                                If dtdescdetails(k)("Crtotal1") > dtdescdetails(k)("Dbtotal1") Then
                                                                    PrevTOTalHeading = dtdescdetails(k)("Crtotal1") - dtdescdetails(k)("Dbtotal1")
                                                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                                    If PrevTOTalHeading < 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                    Else
                                                                        If PrevTOTalHeading <> 0 Then
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                        Else
                                                                            dr("PrevyearTotoal") = "0.00"
                                                                        End If
                                                                    End If
                                                                Else
                                                                    PrevTOTalHeading = dtdescdetails(k)("Crtotal1") - dtdescdetails(k)("Dbtotal1")
                                                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                                    If PrevTOTalHeading < 0 Then
                                                                        sTotal = PrevTOTalHeading
                                                                        sTotal = Convert.ToDecimal(sTotal.ToString.Remove(0, 1)).ToString()
                                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                    Else
                                                                        If PrevTOTalHeading <> 0 Then
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                        Else
                                                                            dr("PrevyearTotoal") = "0.00"
                                                                        End If
                                                                    End If

                                                                End If
                                                                dtdetails.Rows.Add(dr)
DescZero3:                                                  Next
                                                        End If
                                                    Else
                                                        'only Prev desc PrevYear
                                                        If dtitem(a)("PrevCrTotal") <> 0 Or dtitem(a)("PrevDbTotal") <> 0 Then
                                                            sSql = "select ATBUD_Description, "
                                                            sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
                                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_Description = ATBUD_Description  and b.ATBU_YEARId=" & IyearID & " and b.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  "
                                                            If sSelectedBranches <> "0" Then
                                                                sSql = sSql & " And b.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                            End If
                                                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  "
                                                            If sSelectedBranches <> "0" Then
                                                                sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                            End If
                                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                                            sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
                                                            sSql = sSql & " group by ATBUD_Description "
                                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                            If dtdescdetails.Rows.Count > 0 Then
                                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                                        dr = dtdetails.NewRow
                                                                        dr("SrNo") = a1
                                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(dtdescdetails(l)("Total") / iInAmt).ToString("N" & iRoundOff)
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(dtdescdetails(l)("PrevTotal") / iInAmt).ToString("N" & iRoundOff)
                                                                        dtdetails.Rows.Add(dr)
                                                                    End If
                                                                Next
                                                            End If
                                                        End If
                                                    End If
                                                    'Fetch desc Under Sub item
                                                    sSql = ""
                                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
                                                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal"
                                                    sSql = sSql & " from Acc_TrailBalance_Upload_Details "
                                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                                                    If sSelectedBranches <> "0" Then
                                                        sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                    End If
                                                    sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                                                    If sSelectedBranches <> "0" Then
                                                        sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                    End If
                                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0   group by ATBUD_SubItemId,a.ASSI_Name"
                                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                    If dtSubitem.Rows.Count > 0 Then
                                                        For L = 0 To dtSubitem.Rows.Count - 1
                                                            '  num = dtdetails.Rows.Count - 1
                                                            'dtdetails(num)("HeaderSLNo") = ""
                                                            headingTotal = 0
                                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                                dr = dtdetails.NewRow
                                                                dr("Srno") = a1
                                                                dr("Headingname") = dtSubitem(L)("headingname")
                                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                                    CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                End If
                                                                ' PrevTOtal
                                                                If PrevTOTalHeading < 0 Then
                                                                    sTotal = 0
                                                                    sTotal = PrevTOTalHeading
                                                                    sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString()
                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                Else
                                                                    If PrevTOTalHeading > 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                    Else
                                                                        dr("PrevyearTotoal") = "0.00"
                                                                    End If
                                                                End If
                                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                                headingTotal = headingTotal + TOTalHeading
                                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                                dtdetails.Rows.Add(dr)
                                                                'Fetch desc Under Sub item
                                                                sSql = "select distinct(ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
                                                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                                                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
                                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+f.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal, "
                                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
                                                                sSql = sSql & " from Acc_TrailBalance_Upload_Details "
                                                                sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID=  ATBUD_SubItemId   left join Acc_TrailBalance_Upload  d on d.ATBU_Description = ATBUD_Description  And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid  "
                                                                If sSelectedBranches <> "0" Then
                                                                    sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                                End If
                                                                sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                                                                If sSelectedBranches <> "0" Then
                                                                    sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                                End If
                                                                sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                                                If sSelectedBranches <> "0" Then
                                                                    sSql = sSql & " And Atbud_Branchnameid in (" & sSelectedBranches & ")"
                                                                End If
                                                                sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_SubItemId= " & dtSubitem(L)("ATBUD_SubItemId") & " And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid") & " and atbud_yearid=" & IyearID & "  "
                                                                sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
                                                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                                If dtdescdetails.Rows.Count > 0 Then
                                                                    num = dtdetails.Rows.Count - 1
                                                                    dtdetails(num)("HeaderSLNo") = ""
                                                                    dtdetails(num)("PrevyearTotoal") = ""
                                                                    For m = 0 To dtdescdetails.Rows.Count - 1
                                                                        If IsDBNull(dtdescdetails(m)("ATBUD_Description")) = False Then
                                                                            If iStat = 1 Then
                                                                                If dtdescdetails(m)("CrTotal") = 0 And dtdescdetails(m)("DbTotal") = 0 And dtdescdetails(m)("PrevCrTotal") = 0 And dtdescdetails(m)("PrevDbTotal") = 0 Then
                                                                                    GoTo DescZero5
                                                                                End If
                                                                            End If
                                                                            dr = dtdetails.NewRow
                                                                            dr("SrNo") = a1
                                                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(m)("ATBUD_Description")
                                                                            If dtdescdetails(m)("CrTotal") > dtdescdetails(m)("DbTotal") Then
                                                                                CreditTotal = 0 : DebitTotal = 0
                                                                                CreditTotal = CreditTotal + dtdescdetails(m)("CrTotal")
                                                                                TOTalHeading = dtdescdetails(m)("CrTotal") - dtdescdetails(m)("DbTotal")
                                                                                headingTotal = headingTotal + TOTalHeading
                                                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                            Else
                                                                                DebitTotal = DebitTotal + dtdescdetails(m)("DbTotal")
                                                                                TOTalHeading = dtdescdetails(m)("DbTotal") - dtdescdetails(m)("CrTotal")
                                                                                headingTotal = headingTotal + TOTalHeading
                                                                                If TOTalHeading < 0 Then
                                                                                    dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                                Else
                                                                                    If TOTalHeading = 0 Then
                                                                                        dr("HeaderSLNo") = "0.00"
                                                                                    Else
                                                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                                    End If
                                                                                End If
                                                                            End If
                                                                            ' PrevTOtal
                                                                            If dtdescdetails(m)("PrevCrTotal") > dtdescdetails(m)("PrevDbTotal") Then
                                                                                PrevTOTalHeading = dtdescdetails(m)("PrevCrTotal") - dtdescdetails(m)("PrevDbTotal")
                                                                                PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                            Else
                                                                                PrevTOTalHeading = dtdescdetails(m)("PrevDbTotal") - dtdescdetails(m)("PrevCrTotal")
                                                                                PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                                                If PrevTOTalHeading < 0 Then
                                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                                Else
                                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                                End If
                                                                            End If
                                                                            headingTotal = headingTotal + TOTalHeading
                                                                            dtdetails.Rows.Add(dr)
                                                                        End If
DescZero5:                                                          Next
                                                                End If
                                                            End If
                                                        Next
                                                    Else
                                                    End If
                                                Else
                                                    'For Item direct amount (10_07_23)
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = a1
                                                    dr("Headingname") = "<B>" & dtitem(a)("headingname") & "</B>"
                                                    dr("Notes") = "-"
                                                    If dtitem(a)("CrTotal1") > dtitem(a)("DbTotal1") Then
                                                        CreditTotal = CreditTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("CrTotal1") - dtitem(a)("DbTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                    Else
                                                        DebitTotal = DebitTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("DbTotal1") - dtitem(a)("CrTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                    End If
                                                    ' PrevTOtal
                                                    If PrevTOTalHeading < 0 Then
                                                        sTotal = 0
                                                        sTotal = PrevTOTalHeading
                                                        sTotal = Convert.ToDecimal(sTotal).ToString("N" & iRoundOff).Remove(0, 1)
                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                    Else
                                                        If PrevTOTalHeading > 0 Then
                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            dr("PrevyearTotoal") = "0.00"
                                                        End If
                                                    End If
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        Else
                                        End If
                                    End If
                                    If dtsubheading(j)("headingname") = "(b) Reserves and surplus" Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = a1
                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & "Total Profit/Loss carried over from P&L Acct" & "</i>"
                                        dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                                        If dPandLamt < 0 Then
                                            dr("HeaderSLNo") = "(" & Val(dPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                        Else
                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff) & ")"
                                        End If

                                        dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                        If dPrevPandLamt < 0 Then
                                            dr("PrevyearTotoal") = "(" & Val(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                        Else
                                            If dPrevPandLamt = 0 Then
                                                dr("PrevyearTotoal") = "0.00"
                                            Else
                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff) & ")"
                                            End If
                                        End If

                                        sPandLAmount = (dPandLamt / iInAmt)
                                        dtdetails.Rows.Add(dr)
                                    End If
                                    dr = dtdetails.NewRow
                                    ' Idu beku total
                                    dr("SrNo") = a1
                                    dr("Headingname") = "<B>" & "Total" & "</B>"
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal") + Val(dPandLamt)
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                    Else
                                        DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        If Val(dPandLamt) < 0 Then
                                            TOTalHeading = Val(dtsubheading(j)("CrTotal")) - Val(dtsubheading(j)("DbTotal"))
                                            TOTalHeading = TOTalHeading + Val(dPandLamt)
                                        Else
                                            TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal") - Val(dPandLamt)
                                        End If
                                        headingTotal = headingTotal + TOTalHeading
                                        If TOTalHeading < 0 Then
                                            dr("HeaderSLNo") = "<B>" & "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                        Else
                                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                        End If
                                    End If
                                    If PrevCreditTotal > PrevDebitTotal Then
                                        PrevS2TotalAllHeadings = PrevCreditTotal + PrevDebitTotal + Val(dPrevPandLamt)
                                        If PrevS2TotalAllHeadings < 0 Then
                                            sTotal = 0
                                            sTotal = PrevS2TotalAllHeadings
                                            sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                            dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                        Else
                                            dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                        End If
                                    Else
                                        PrevS2TotalAllHeadings = PrevDebitTotal - PrevCreditTotal + Val(dPrevPandLamt)
                                        If PrevS2TotalAllHeadings < 0 Then
                                            dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                        Else
                                            dr("PrevyearTotoal") = "<B>" & "0.00" & "</B>"
                                        End If
                                    End If
                                    dPandLamt = 0 : dPrevPandLamt = 0
                                    dtdetails.Rows.Add(dr)
                                    If iChkPt = -1 Then
                                        If IsDBNull(dtsubheading(j)("ASHN_Description")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("SrNo") = a1
                                            dr("Headingname") = dtsubheading(j)("ASHN_Description")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    End If
                                    dr = dtdetails.NewRow
                                    dtdetails.Rows.Add(dr)
                                    TOTalHeading = 0
                                    headingTotal = 0
                                    PrevS2TotalAllHeadings = 0
                                    PrevCreditTotal = 0 : PrevDebitTotal = 0
                                    CreditTotal = 0 : DebitTotal = 0

                                Else
                                    'For SubHeading direct amount (10_07_23)
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = a1
                                    dr("Headingname") = "<B>" & dtsubheading(j)("headingname") & "</B>"
                                    dr("Notes") = dtsubheading(j)("Notes")
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                    Else
                                        DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                    End If
                                    ' PrevTOtal
                                    If PrevTOTalHeading < 0 Then
                                        sTotal = 0
                                        sTotal = PrevTOTalHeading
                                        sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                    Else
                                        If PrevTOTalHeading > 0 Then
                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                        Else
                                            dr("PrevyearTotoal") = "0.00"
                                        End If
                                    End If
                                    dtdetails.Rows.Add(dr)
                                    dr = dtdetails.NewRow
                                    dtdetails.Rows.Add(dr)
                                End If
DeescSubHead:               Next
                            'If dtheading(i)("ATBUD_Headingid") = 63 And orgTypeId = 68 Then
                            '    dr = dtdetails.NewRow
                            '    dr("SrNo") = a1
                            '    dr("Headingname") = "<B>" & "(b) Reserves And surplus " & "</B>"
                            '    dr("Notes") = "2"
                            '    dtdetails.Rows.Add(dr)
                            '    dr = dtdetails.NewRow
                            '    dr("SrNo") = a1
                            '    dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & "total Profit/Loss carried over from P&L Acct" & "</i>"
                            '    dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                            '    If dPandLamt < 0 Then
                            '        dr("HeaderSLNo") = "(" & Convert.ToDecimal(Val(dPandLamt / iInAmt)).ToString * ("N" & iRoundOff).Remove(0, 1) & ")"
                            '    Else
                            '        dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)
                            '    End If
                            '    dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                            '    If dPrevPandLamt < 0 Then
                            '        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(Val(dPrevPandLamt / iInAmt)).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                            '    Else
                            '        dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                            '    End If
                            '    sPandLAmount = dPandLamt
                            '    dtdetails.Rows.Add(dr)
                            '    dr = dtdetails.NewRow
                            '    dtdetails.Rows.Add(dr)
                            'End If
                        Else
                        End If
                    Next
                    TOTalHeading = 0
                End If

                '06/11/2023
                ''' Account Head 2
                sSql = "Select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  As CrTotal, "
                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  As DbTotal, a.ASH_Notes  from Acc_TrailBalance_Upload_Details "
                sSql = sSql & " left join ACC_ScheduleHeading a On a.ASH_ID=  ATBUD_Headingid"
                sSql = sSql & " left join Acc_TrailBalance_Upload d On d.ATBU_Description = ATBUD_Description And d.ATBU_Description = ATBUD_Description "
                sSql = sSql & " where  ATBUD_Schedule_type =" & iSchedulrTypeIdd & " And ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & ""
                If sSelectedBranches <> "0" Then
                    sSql = sSql & " And d.Atbu_Branchid In (" & sSelectedBranches & ")"
                End If
                sSql = sSql & " And EXISTS(Select * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid And AST_AccHeadId =2 ) group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
                dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtheading.Rows.Count > 0 Then
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then
                            'Fetch desc under Heading
                            sSql = "Select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name As headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  As CrTotal,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  As DbTotal  from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b On b.ATBUD_Description  = ATBU_Description   left join ACC_ScheduleHeading a On a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & "  And b.atbud_compid = " & iACID & " And ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  And ATBUD_CustId=" & ICustid & " And ATBUD_YEARId=" & IyearID & " And ATBU_YEARId=" & IyearID & ""
                            If sSelectedBranches <> "0" Then
                                sSql = sSql & " And Atbu_Branchid In (" & sSelectedBranches & ")"
                            End If
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name,ATBU_Branchid order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtdescdetails.Rows.Count > 0 Then
                                CreditTotal = 0 : DebitTotal = 0
                            End If
                        End If
                        sSql = "   Select  AST_SubHeadingID,AsSH_Name As headingname,ASSH_Notes As Notes FROM ACC_ScheduleTemplates
                                               Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID
                                               WHERE AST_Schedule_type  =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=2 and AST_HeadingID=" & dtheading(i)("ATBUD_Headingid") & "
                                               group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                        dtsubHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
                        'Sub Heading
                        sSql = ""
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotalPrev, "
                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotalPrev "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & "  and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & " and d.ATBU_Branchid=Atbud_Branchnameid  "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID and e.ASHN_CustomerId=" & ICustid & " and e.ASHN_YearID=" & IyearID & ""
                        sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description and ATBUD_SubItemId=0 and ATBUD_itemid=0 And f.ATBU_YEARId=" & IyearID & "  and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                        sSql = sSql & " left join Acc_TrailBalance_Upload g on g.ATBU_Description = ATBUD_Description and ATBUD_SubItemId=0 and ATBUD_itemid=0 And g.ATBU_YEARId=" & IyearID - 1 & "  and g.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & " and g.ATBU_Branchid=Atbud_Branchnameid "
                        If sSelectedBranches <> "0" Then
                            sSql = sSql & " And g.Atbu_Branchid in (" & sSelectedBranches & ")"
                        End If
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & "   And ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            headingTotal = 0
                            DebitTotal = 0
                            CreditTotal = 0
                            Dim iSubHeadingId, iId As Integer
                            For j = 0 To dtsubheading.Rows.Count - 1
                                iId = dtsubheading(j)("ATBUD_Subheading")
                                iSubHeadingId = objDBL.SQLExecuteScalar(sAC, " select 1  where " & iId & " in (" & sSelectedSHeading & ")  ")
                                If iSubHeadingId <> 1 Then
                                    If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        a1 = a1 + 1
                                        dr("SrNo") = a1
                                        dr("Headingname") = "<B>" & dtsubheading(j)("headingname") & "</B>"
                                        If dtsubheading(j)("Notes") = 0 Then
                                            dr("Notes") = ""
                                        Else
                                            dr("Notes") = dtsubheading(j)("Notes")
                                        End If
                                        If dtsubheading(j)("CrTotal1") > dtsubheading(j)("DbTotal1") Then
                                            CreditTotal = CreditTotal + dtsubheading(j)("CrTotal1")
                                            TOTalHeading = dtsubheading(j)("CrTotal1") - dtsubheading(j)("DbTotal1")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                            dr("HeaderSLNo") = ""
                                        Else
                                            DebitTotal = DebitTotal + dtsubheading(j)("CrTotal1")
                                            TOTalHeading = dtsubheading(j)("DbTotal1") - dtsubheading(j)("CrTotal1")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                            dr("HeaderSLNo") = ""
                                        End If
                                        dtdetails.Rows.Add(dr)
                                        '''' Description Under Sub Heading
                                        If dtsubheading(j)("CrTotal1") <> 0 Or dtsubheading(j)("DbTotal1") <> 0 Then
                                            sSql = ""
                                            sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
                                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
                                            sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                                            sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                                            sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description  And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & " and d.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID and e.ASHN_CustomerId=" & ICustid & " and e.ASHN_YearID=" & IyearID & ""
                                            sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & " and f.ATBU_Branchid=Atbud_Branchnameid "
                                            If sSelectedBranches <> "0" Then
                                                sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                            End If
                                            sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "   and ATBUD_SubItemId=0 and ATBUD_itemid=0"
                                            sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                CreditTotal = 0 : DebitTotal = 0
                                                For k = 0 To dtdescdetails.Rows.Count - 1
                                                    If iStat = 1 Then
                                                        If dtdescdetails(k)("CrTotal") = 0 And dtdescdetails(k)("DbTotal") = 0 And dtdescdetails(k)("PrevCrTotal") = 0 And dtdescdetails(k)("PrevDbTotal") = 0 Then
                                                            GoTo DescZero6
                                                        End If
                                                    End If
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = a1
                                                    dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
                                                    If dtheading(i)("headingname").ToString.Trim = "X Tax Expense" Then
                                                        If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
                                                            CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
                                                            TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            DebitTotal = DebitTotal + dtdescdetails(k)("DbTotal")
                                                            TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            If TOTalHeading < 0 Then
                                                                sTotal = TOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If TOTalHeading <> 0 Then
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("HeaderSLNo") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                    Else
                                                        If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
                                                            CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
                                                            TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            DebitTotal = DebitTotal + dtdescdetails(k)("DbTotal")
                                                            TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            If TOTalHeading < 0 Then
                                                                sTotal = TOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If TOTalHeading <> 0 Then
                                                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("HeaderSLNo") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                    ' PrevTOtal
                                                    If dtheading(i)("headingname").ToString.Trim = "X Tax Expense" Then
                                                        If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                            End If
                                                        Else
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = 0
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If PrevTOTalHeading > 0 Then
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("PrevyearTotoal") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                    Else
                                                        If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                            End If
                                                        Else
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevDbTotal") - dtdescdetails(k)("PrevCrTotal")
                                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = 0
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If PrevTOTalHeading > 0 Then
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("PrevyearTotoal") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                    dtdetails.Rows.Add(dr)
DescZero6:                                      Next
                                            End If
                                        Else
                                            ' Prev desc PrevYear
                                            If dtsubheading(j)("CrTotalPrev") <> 0 Or dtsubheading(j)("DbTotalPrev") <> 0 Then
                                                sSql = ""
                                                sSql = " select distinct(ATBUD_Subheading),ATBUD_Description,a.ASSH_Name as headingname,a.AsSh_Notes as Notes,"
                                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal ,e.ASHN_Description as  ASHN_Description, "
                                                sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                                                sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                                                sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description  And d.ATBU_YEARId=" & IyearID & "  and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & " and d.ATBU_Branchid=Atbud_Branchnameid "
                                                If sSelectedBranches <> "0" Then
                                                    sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                End If
                                                sSql = sSql & " left join ACC_SubHeadingNoteDesc e on e.ASHN_SubHeadingId = ASSH_ID and e.ASHN_CustomerId=" & ICustid & " and e.ASHN_YearID=" & IyearID & ""
                                                sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & " and f.ATBU_Branchid=Atbud_Branchnameid "
                                                If sSelectedBranches <> "0" Then
                                                    sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                End If
                                                sSql = sSql & " where  ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & "    and ATBUD_SubItemId=0 and ATBUD_itemid=0 "
                                                sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes,ASHN_Description,ATBUD_Description order by ATBUD_Subheading"
                                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                If dtdescdetails.Rows.Count > 0 Then
                                                    CreditTotal = 0 : DebitTotal = 0
                                                    For k = 0 To dtdescdetails.Rows.Count - 1
                                                        If iStat = 1 Then
                                                            If dtdescdetails(k)("CrTotal") = 0 And dtdescdetails(k)("DbTotal") = 0 And dtdescdetails(k)("PrevCrTotal") = 0 And dtdescdetails(k)("PrevDbTotal") = 0 Then
                                                                GoTo DescZero7
                                                            End If
                                                        End If
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = a1
                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
                                                        If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
                                                            CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
                                                            TOTalHeading = dtdescdetails(k)("CrTotal") - dtdescdetails(k)("DbTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
                                                            TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
                                                            headingTotal = headingTotal + TOTalHeading
                                                            If TOTalHeading < 0 Then
                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                            End If
                                                        End If
                                                        ' PrevTOtal
                                                        If dtdescdetails(k)("PrevCrTotal") > dtdescdetails(k)("PrevDbTotal") Then
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevCrTotal") - dtdescdetails(k)("PrevDbTotal")
                                                            PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                            Else
                                                                If PrevTOTalHeading <> 0 Then
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("PrevyearTotoal") = "0.00"
                                                                End If
                                                            End If
                                                        Else
                                                            PrevTOTalHeading = dtdescdetails(k)("PrevDbTotal") - dtdescdetails(k)("PrevCrTotal")
                                                            PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                            If PrevTOTalHeading < 0 Then
                                                                sTotal = PrevTOTalHeading
                                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                            Else
                                                                If PrevTOTalHeading <> 0 Then
                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    dr("PrevyearTotoal") = "0.00"
                                                                End If
                                                            End If
                                                        End If
                                                        dtdetails.Rows.Add(dr)
DescZero7:                                          Next
                                                End If
                                            End If
                                        End If
                                        TOTalHeading = 0
                                        sSql = ""
                                        sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount + 0), 0)  As CrTotal1, "
                                        sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount + 0), 0)  As DbTotal1, "
                                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalCredit_Amount + 0), 0)  As PrevCrTotal, "
                                        sSql = sSql & "  ISNULL(Sum(g.ATBU_Closing_TotalDebit_Amount + 0), 0)  As PrevDbTotal "
                                        sSql = sSql & "from Acc_TrailBalance_Upload_Details  "
                                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                                        If sSelectedBranches <> "0" Then
                                            sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                        End If
                                        sSql = sSql & "   left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description and ATBUD_SubItemId=0 And f.ATBU_YEARId=" & IyearID & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                                        If sSelectedBranches <> "0" Then
                                            sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                        End If
                                        sSql = sSql & "   left join Acc_TrailBalance_Upload g on g.ATBU_Description=ATBUD_Description and ATBUD_SubItemId=0 And g.ATBU_YEARId=" & IyearID - 1 & " and g.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  and g.ATBU_Branchid=Atbud_Branchnameid "
                                        If sSelectedBranches <> "0" Then
                                            sSql = sSql & " And g.Atbu_Branchid in (" & sSelectedBranches & ")"
                                        End If
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & "  And ATBUD_CustId=" & ICustid & ""
                                        sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0   group by ATBUD_itemid,a.ASI_Name"
                                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtitem.Rows.Count > 0 Then
                                            Dim iItemId, iIds As Integer
                                            For a = 0 To dtitem.Rows.Count - 1
                                                iIds = dtitem(a)("ATBUD_itemid")
                                                iItemId = objDBL.SQLExecuteScalar(sAC, " select 1  where " & iIds & " in (" & sSelectedItems & ")  ")
                                                If iItemId <> 1 Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = a1
                                                    dr("Headingname") = dtitem(a)("headingname")
                                                    If dtitem(a)("CrTotal1") > dtitem(a)("DbTotal1") Then
                                                        CreditTotal = CreditTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("CrTotal1") - dtitem(a)("DbTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        dr("HeaderSLNo") = ""
                                                    Else
                                                        DebitTotal = DebitTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("DbTotal1") - dtitem(a)("CrTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        dr("HeaderSLNo") = ""
                                                    End If
                                                    ' PrevTOtal
                                                    If PrevTOTalHeading < 0 Then
                                                        sTotal = 0
                                                        sTotal = PrevTOTalHeading
                                                        sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                    Else
                                                        If PrevTOTalHeading > 0 Then
                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            dr("PrevyearTotoal") = ""
                                                        End If
                                                    End If
                                                    dr("PrevyearTotoal") = ""
                                                    dtdetails.Rows.Add(dr)
                                                    'Description Under Item 
                                                    If dtitem(a)("CrTotal1") <> 0 Or dtitem(a)("DbTotal1") <> 0 Then
                                                        'Fetching Desc under Item Name  
                                                        sSql = "select ATBUD_Description, "
                                                        sSql = sSql & "  ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,
 ISNULL(Sum(b.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,
 ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal1,
 ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal1"
                                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_Description = ATBUD_Description and b.ATBU_Branchid=Atbud_Branchnameid   and b.ATBU_YEARId=" & IyearID & " and b.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  "
                                                        If sSelectedBranches <> "0" Then
                                                            sSql = sSql & " And b.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                        End If
                                                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description and e.ATBU_Branchid=Atbud_Branchnameid  And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  "
                                                        If sSelectedBranches <> "0" Then
                                                            sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                        End If
                                                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                                        If sSelectedBranches <> "0" Then
                                                            sSql = sSql & " And Atbud_Branchnameid in (" & sSelectedBranches & ")"
                                                        End If
                                                        sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
                                                        sSql = sSql & " group by ATBUD_Description "
                                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                        If dtdescdetails.Rows.Count > 0 Then
                                                            CreditTotal = 0 : DebitTotal = 0
                                                            For k = 0 To dtdescdetails.Rows.Count - 1
                                                                If iStat = 1 Then
                                                                    If dtdescdetails(k)("CrTotal") = 0 And dtdescdetails(k)("DbTotal") = 0 And dtdescdetails(k)("CrTotal1") = 0 And dtdescdetails(k)("DbTotal1") = 0 Then
                                                                        GoTo DescZero8
                                                                    End If
                                                                End If
                                                                dr = dtdetails.NewRow
                                                                dr("SrNo") = a1
                                                                dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(k)("ATBUD_Description") & "</i>"
                                                                If dtdescdetails(k)("CrTotal") > dtdescdetails(k)("DbTotal") Then
                                                                    CreditTotal = CreditTotal + dtdescdetails(k)("CrTotal")
                                                                    TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    If TOTalHeading < 0 Then
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff).Remove(0, 1).ToString & ")"
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                    End If

                                                                Else
                                                                    DebitTotal = DebitTotal + dtdescdetails(k)("CrTotal")
                                                                    TOTalHeading = dtdescdetails(k)("DbTotal") - dtdescdetails(k)("CrTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    If TOTalHeading < 0 Then
                                                                        sTotal = TOTalHeading
                                                                        sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                        dr("HeaderSLNo") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                    Else
                                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                    End If
                                                                End If
                                                                '01_11_23
                                                                ' PrevTOtal
                                                                If dtdescdetails(k)("Crtotal1") > dtdescdetails(k)("Dbtotal1") Then
                                                                    PrevTOTalHeading = dtdescdetails(k)("Dbtotal1") - dtdescdetails(k)("Crtotal1")
                                                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                                    If PrevTOTalHeading < 0 Then
                                                                        If PrevTOTalHeading < 0 Then
                                                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                        Else
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                        End If
                                                                    Else
                                                                        If PrevTOTalHeading <> 0 Then
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                        Else
                                                                            dr("PrevyearTotoal") = "0.00"
                                                                        End If
                                                                    End If
                                                                Else
                                                                    PrevTOTalHeading = dtdescdetails(k)("Dbtotal1") - dtdescdetails(k)("Crtotal1")
                                                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                                    If PrevTOTalHeading < 0 Then
                                                                        sTotal = PrevTOTalHeading
                                                                        sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                    Else
                                                                        If PrevTOTalHeading <> 0 Then
                                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                        Else
                                                                            dr("PrevyearTotoal") = "0.00"
                                                                        End If
                                                                    End If
                                                                End If
                                                                dtdetails.Rows.Add(dr)
DescZero8:                                                  Next
                                                        End If
                                                    Else
                                                        'only Prev desc PrevYear
                                                        If dtitem(a)("PrevCrTotal") <> 0 Or dtitem(a)("PrevDbTotal") <> 0 Then
                                                            sSql = "select ATBUD_Description, "
                                                            sSql = sSql & " ISNULL(Sum(b.ATBU_Closing_TotalCredit_Amount+b.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+e.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal "
                                                            sSql = sSql & " from Acc_TrailBalance_Upload_Details  left join Acc_TrailBalance_Upload b on b.ATBU_Description = ATBUD_Description  and b.ATBU_YEARId=" & IyearID & " and b.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  "
                                                            If sSelectedBranches <> "0" Then
                                                                sSql = sSql & " And b.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                            End If
                                                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID=  ATBUD_itemid   left join Acc_TrailBalance_Upload e on e.ATBU_Description = ATBUD_Description And e.ATBU_YEARId=" & IyearID - 1 & " and e.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  "
                                                            If sSelectedBranches <> "0" Then
                                                                sSql = sSql & " And e.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                            End If
                                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                                            sSql = sSql & "  and ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and ATBUD_itemid=" & dtitem(a)("ATBUD_itemid") & " and ATBUD_SubItemId=0  "
                                                            sSql = sSql & " group by ATBUD_Description "
                                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                            If dtdescdetails.Rows.Count > 0 Then
                                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                                        dr = dtdetails.NewRow
                                                                        dr("SrNo") = a1
                                                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(l)("ATBUD_Description") & "</i>"
                                                                        dr("HeaderSLNo") = Val(dtdescdetails(l)("Total") / iInAmt).ToString("N" & iRoundOff)
                                                                        dr("PrevyearTotoal") = Val(dtdescdetails(l)("PrevTotal") / iInAmt).ToString("N" & iRoundOff)
                                                                        dtdetails.Rows.Add(dr)
                                                                    End If
                                                                Next
                                                            End If
                                                        End If
                                                    End If
                                                    'Fetch desc Under Sub item
                                                    sSql = ""
                                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
                                                    sSql = sSql & "  ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal"
                                                    sSql = sSql & " from Acc_TrailBalance_Upload_Details "
                                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_Description = ATBUD_Description And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid "
                                                    If sSelectedBranches <> "0" Then
                                                        sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                    End If
                                                    sSql = sSql & "    left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID - 1 & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                                                    If sSelectedBranches <> "0" Then
                                                        sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                    End If
                                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0   group by ATBUD_SubItemId,a.ASSI_Name"
                                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                    If dtSubitem.Rows.Count > 0 Then
                                                        For L = 0 To dtSubitem.Rows.Count - 1
                                                            '  num = dtdetails.Rows.Count - 1
                                                            'dtdetails(num)("HeaderSLNo") = ""
                                                            headingTotal = 0
                                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                                dr = dtdetails.NewRow
                                                                dr("Srno") = a1
                                                                dr("Headingname") = dtSubitem(L)("headingname")
                                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                                    CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = Val(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                Else
                                                                    DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                                    headingTotal = headingTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = Val(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                End If
                                                                ' PrevTOtal
                                                                If PrevTOTalHeading < 0 Then
                                                                    sTotal = 0
                                                                    sTotal = PrevTOTalHeading
                                                                    sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                Else
                                                                    If PrevTOTalHeading > 0 Then
                                                                        dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                    Else
                                                                        dr("PrevyearTotoal") = "0.00"
                                                                    End If
                                                                End If
                                                                headingTotal = headingTotal + TOTalHeading
                                                                dtdetails.Rows.Add(dr)
                                                                'Fetch desc Under Sub item
                                                                sSql = "select distinct(ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
                                                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total,ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                                                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, "
                                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+f.ATBU_Closing_TotalDebit_Amount),0)  as PrevTotal, "
                                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                                                                sSql = sSql & " ISNULL(Sum(f.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal  "
                                                                sSql = sSql & " from Acc_TrailBalance_Upload_Details "
                                                                sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID=  ATBUD_SubItemId   left join Acc_TrailBalance_Upload  d on d.ATBU_Description = ATBUD_Description  And d.ATBU_YEARId=" & IyearID & " and d.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and d.ATBU_Branchid=Atbud_Branchnameid  "
                                                                If sSelectedBranches <> "0" Then
                                                                    sSql = sSql & " And d.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                                End If
                                                                sSql = sSql & " left join Acc_TrailBalance_Upload f on f.ATBU_Description = ATBUD_Description And f.ATBU_YEARId=" & IyearID - 1 & " and f.ATBU_CustId= " & ICustid & " and ATBUD_YEARId=" & IyearID & "  and f.ATBU_Branchid=Atbud_Branchnameid "
                                                                If sSelectedBranches <> "0" Then
                                                                    sSql = sSql & " And f.Atbu_Branchid in (" & sSelectedBranches & ")"
                                                                End If
                                                                sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                                                If sSelectedBranches <> "0" Then
                                                                    sSql = sSql & " And Atbud_Branchnameid in (" & sSelectedBranches & ")"
                                                                End If
                                                                sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_SubItemId= " & dtSubitem(L)("ATBUD_SubItemId") & " And ATBUD_itemid = " & dtitem(a)("ATBUD_itemid") & " and atbud_yearid=" & IyearID & "  "
                                                                sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
                                                                dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                                If dtdescdetails.Rows.Count > 0 Then
                                                                    num = dtdetails.Rows.Count - 1
                                                                    dtdetails(num)("HeaderSLNo") = ""
                                                                    dtdetails(num)("PrevyearTotoal") = ""
                                                                    For m = 0 To dtdescdetails.Rows.Count - 1
                                                                        If IsDBNull(dtdescdetails(m)("ATBUD_Description")) = False Then
                                                                            If iStat = 1 Then
                                                                                If dtdescdetails(m)("CrTotal") = 0 And dtdescdetails(m)("DbTotal") = 0 And dtdescdetails(m)("PrevCrTotal") = 0 And dtdescdetails(m)("PrevDbTotal") = 0 Then
                                                                                    GoTo DescZero9
                                                                                End If
                                                                            End If
                                                                            dr = dtdetails.NewRow
                                                                            dr("SrNo") = a1
                                                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtdescdetails(m)("ATBUD_Description")
                                                                            If dtdescdetails(m)("CrTotal") > dtdescdetails(m)("DbTotal") Then
                                                                                CreditTotal = 0 : DebitTotal = 0
                                                                                CreditTotal = CreditTotal + dtdescdetails(m)("CrTotal")
                                                                                TOTalHeading = dtdescdetails(m)("CrTotal") - dtdescdetails(m)("DbTotal")
                                                                                headingTotal = headingTotal + TOTalHeading
                                                                                dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                            Else
                                                                                DebitTotal = DebitTotal + dtdescdetails(m)("DbTotal")
                                                                                TOTalHeading = dtdescdetails(m)("DbTotal") - dtdescdetails(m)("CrTotal")
                                                                                headingTotal = headingTotal + TOTalHeading
                                                                                dr("HeaderSLNo") = "(" & Val(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                            End If
                                                                            ' PrevTOtal
                                                                            If dtdescdetails(m)("PrevCrTotal") > dtdescdetails(m)("PrevDbTotal") Then
                                                                                PrevTOTalHeading = dtdescdetails(m)("PrevCrTotal") - dtdescdetails(m)("PrevDbTotal")
                                                                                PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                                                                dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                            Else
                                                                                PrevTOTalHeading = dtdescdetails(m)("PrevDbTotal") - dtdescdetails(m)("PrevCrTotal")
                                                                                PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                                                                If PrevTOTalHeading < 0 Then
                                                                                    dr("PrevyearTotoal") = "(" & Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")"
                                                                                Else
                                                                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                                                End If
                                                                            End If
                                                                            headingTotal = headingTotal + TOTalHeading
                                                                            dtdetails.Rows.Add(dr)
                                                                        End If
DescZero9:                                                          Next
                                                                End If
                                                            End If
                                                        Next
                                                    Else
                                                    End If
                                                Else
                                                    'For Item direct amount (10_07_23)
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = a1
                                                    dr("Headingname") = "<B>" & dtitem(a)("headingname") & "</B>"
                                                    dr("Notes") = "-"
                                                    If dtitem(a)("CrTotal1") > dtitem(a)("DbTotal1") Then
                                                        CreditTotal = CreditTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("CrTotal1") - dtitem(a)("DbTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                    Else
                                                        DebitTotal = DebitTotal + dtitem(a)("CrTotal1")
                                                        TOTalHeading = dtitem(a)("DbTotal1") - dtitem(a)("CrTotal1")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                    End If
                                                    ' PrevTOtal
                                                    If PrevTOTalHeading < 0 Then
                                                        sTotal = 0
                                                        sTotal = PrevTOTalHeading
                                                        sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                                    Else
                                                        If PrevTOTalHeading > 0 Then
                                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                                        Else
                                                            dr("PrevyearTotoal") = "0.00"
                                                        End If
                                                    End If
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        Else
                                        End If
                                    End If
                                    If dtsubheading(j)("headingname") = "(b) Reserves and surplus" Then
                                        dr = dtdetails.NewRow
                                        dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & "Total Profit/Loss carried over from P&L Acct" & "</i>"
                                        dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                                        If dPandLamt < 0 Then
                                            dr("HeaderSLNo") = "(" & Val(dPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                        Else
                                            dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)

                                        End If
                                        dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                        If dPrevPandLamt < 0 Then
                                            dr("PrevyearTotoal") = "(" & Val(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                        Else
                                            If dPrevPandLamt = 0 Then
                                                dr("PrevyearTotoal") = "0.00"
                                            Else
                                                dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                            End If
                                        End If
                                        sPandLAmount = dPandLamt
                                        dtdetails.Rows.Add(dr)
                                    End If
                                    dr = dtdetails.NewRow
                                    ' Idu beku total
                                    dr("SrNo") = a1
                                    dr("Headingname") = "<B>" & "Total" & "</B>"
                                    If dtheading(i)("headingname").ToString.Trim = "X Tax Expense" Then
                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                            CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                            TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal") + Val(dPandLamt)
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                        Else
                                            DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                            TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal") - Val(dPandLamt)
                                            headingTotal = headingTotal + TOTalHeading
                                            Dim sDTotal As String = TOTalHeading
                                            If TOTalHeading < 0 Then
                                                dr("HeaderSLNo") = "<B>" & "(" & Convert.ToDecimal(Val(sDTotal / iInAmt).ToString.Remove(0, 1)).ToString("N" & iRoundOff) & ")" & "</B>"
                                            Else
                                                dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                            End If
                                        End If
                                    Else
                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                            CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                            TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal") + Val(dPandLamt)
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(TOTalHeading).ToString("N" & iRoundOff) & "</B>"
                                        Else
                                            DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                            TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal") - Val(dPandLamt)
                                            headingTotal = headingTotal + TOTalHeading
                                            If TOTalHeading < 0 Then
                                                dr("HeaderSLNo") = "<B>" & "(" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                            Else
                                                dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                            End If
                                        End If
                                    End If
                                    If dtheading(i)("headingname").ToString.Trim = "X Tax Expense" Then
                                        If PrevCreditTotal > PrevDebitTotal Then
                                            PrevS2TotalAllHeadings = PrevCreditTotal + PrevDebitTotal + Val(dPrevPandLamt)
                                            If PrevS2TotalAllHeadings < 0 Then
                                                sTotal = 0
                                                sTotal = PrevS2TotalAllHeadings
                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                            Else
                                                dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                            End If
                                        Else
                                            PrevS2TotalAllHeadings = PrevCreditTotal - PrevDebitTotal + Val(dPrevPandLamt)
                                            If PrevS2TotalAllHeadings < 0 Then
                                                dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                            Else
                                                If PrevS2TotalAllHeadings <> 0 Then
                                                    dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                                Else
                                                    dr("PrevyearTotoal") = "<B>" & "0.00" & "</B>"
                                                End If
                                            End If
                                        End If
                                    Else
                                        If PrevCreditTotal > PrevDebitTotal Then
                                            PrevS2TotalAllHeadings = PrevCreditTotal + PrevDebitTotal + Val(dPrevPandLamt)
                                            If PrevS2TotalAllHeadings < 0 Then
                                                sTotal = 0
                                                sTotal = PrevS2TotalAllHeadings
                                                sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                                dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                            Else
                                                dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                            End If
                                        Else
                                            PrevS2TotalAllHeadings = PrevDebitTotal - PrevCreditTotal + Val(dPrevPandLamt)
                                            If PrevS2TotalAllHeadings < 0 Then
                                                dr("PrevyearTotoal") = "<B>" & "(" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & ")" & "</B>"
                                            Else
                                                If PrevS2TotalAllHeadings <> 0 Then
                                                    dr("PrevyearTotoal") = "<B>" & Convert.ToDecimal(PrevS2TotalAllHeadings / iInAmt).ToString("N" & iRoundOff) & "</B>"
                                                Else
                                                    dr("PrevyearTotoal") = "<B>" & "0.00" & "</B>"
                                                End If
                                            End If
                                        End If
                                    End If
                                    dPandLamt = 0 : dPrevPandLamt = 0
                                    dtdetails.Rows.Add(dr)
                                    If iChkPt = -1 Then
                                        If IsDBNull(dtsubheading(j)("ASHN_Description")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("SrNo") = a1
                                            dr("Headingname") = dtsubheading(j)("ASHN_Description")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    End If
                                    dr = dtdetails.NewRow
                                    dtdetails.Rows.Add(dr)
                                    TOTalHeading = 0
                                    headingTotal = 0
                                    PrevS2TotalAllHeadings = 0
                                    PrevCreditTotal = 0 : PrevDebitTotal = 0
                                    CreditTotal = 0 : DebitTotal = 0
                                Else
                                    'For SubHeading direct amount (10_07_23)
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = a1
                                    dr("Headingname") = "<B>" & dtsubheading(j)("headingname") & "</B>"
                                    dr("Notes") = dtsubheading(j)("Notes")
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                    Else
                                        DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading / iInAmt).ToString("N" & iRoundOff)
                                    End If
                                    ' PrevTOtal
                                    If PrevTOTalHeading < 0 Then
                                        sTotal = 0
                                        sTotal = PrevTOTalHeading
                                        sTotal = Convert.ToDecimal(sTotal.Remove(0, 1)).ToString("#,##0.00")
                                        dr("PrevyearTotoal") = "(" & Convert.ToDecimal(sTotal / iInAmt).ToString("N" & iRoundOff) & ")"
                                    Else
                                        If PrevTOTalHeading > 0 Then
                                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("N" & iRoundOff)
                                        Else
                                            dr("PrevyearTotoal") = "0.00"
                                        End If
                                    End If
                                    dtdetails.Rows.Add(dr)
                                    dr = dtdetails.NewRow
                                    dtdetails.Rows.Add(dr)
                                End If
                            Next
                            If dtheading(i)("ATBUD_Headingid") = 63 And orgTypeId = 68 Then
                                dr = dtdetails.NewRow
                                dr("SrNo") = a1
                                dr("Headingname") = "<B>" & "(b) Reserves And surplus " & "</B>"
                                dr("Notes") = "2"
                                dtdetails.Rows.Add(dr)
                                dr = dtdetails.NewRow
                                dr("SrNo") = a1
                                dr("Headingname") = "<i>" & "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & "Total Profit/Loss carried over from P&L Acct" & "</i>"
                                dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, sSelectedBranches)
                                If dPandLamt < 0 Then
                                    dr("HeaderSLNo") = "(" & Val(dPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                Else
                                    dr("HeaderSLNo") = Convert.ToDecimal(dPandLamt / iInAmt).ToString("N" & iRoundOff)
                                End If
                                dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, sSelectedBranches)
                                If dPrevPandLamt < 0 Then
                                    dr("PrevyearTotoal") = "(" & Val(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff).Remove(0, 1) & ")"
                                Else
                                    dr("PrevyearTotoal") = Convert.ToDecimal(dPrevPandLamt / iInAmt).ToString("N" & iRoundOff)
                                End If
                                sPandLAmount = dPandLamt
                                dtdetails.Rows.Add(dr)
                                dr = dtdetails.NewRow
                                dtdetails.Rows.Add(dr)
                            End If
                        Else
                        End If
                    Next
                    TOTalHeading = 0
                End If
                TOTalHeading = 0
                headingTotal = 0
            End If
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function getBalSheetNonpvt(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iRepType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim S3TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer = 0
        Dim TOTalHeading As Double = 0
        Dim TOTalHeadingDb As Double = 0
        Dim TOTalHeadingCr As Double = 0
        Dim CreditTotal As Double = 0
        Dim DebitTotal As Double = 0
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            'AST_AccHeadId =1 
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal   from Acc_TrailBalance_Upload_Details "
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & ""
            sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId =1)group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"

            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            dr = dtdetails.NewRow
            dr("SrNo") = ""
            dr("Headingname") = "<B>" & "SOURCE OF FUNDS" & "</B>"
            dtdetails.Rows.Add(dr)
            If iRepType = 1 Then
                If dtheading.Rows.Count > 0 Then
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = i + 1
                            dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                            If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                CreditTotal = CreditTotal + TOTalHeading
                                dr("HeaderSLNo") = TOTalHeading & "Cr"
                            Else
                                'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                DebitTotal = DebitTotal + TOTalHeading
                                dr("HeaderSLNo") = TOTalHeading & "Dr"
                            End If
                            'S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                            dtdetails.Rows.Add(dr)
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = i + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        'CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        CreditTotal = 0
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                        CreditTotal = CreditTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                    Else
                                        'DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        DebitTotal = 0
                                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                        DebitTotal = DebitTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                    End If
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    'headingTotal = TOTalHeading
                                    S2TotalAllHeadings = S2TotalAllHeadings + TOTalHeading
                                    dtdetails.Rows.Add(dr)
                                End If
                                'item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    num = dtdetails.Rows.Count - 1
                                    dtdetails(num)("HeaderSLNo") = ""
                                    headingTotal = 0
                                    For k = 0 To dtitem.Rows.Count - 1
                                        headingTotal = 0
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                                CreditTotal = 0
                                                'CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                                                TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                                CreditTotal = CreditTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Cr"
                                            Else
                                                DebitTotal = 0
                                                'DebitTotal = DebitTotal + dtitem(k)("DbTotal")
                                                TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                                DebitTotal = DebitTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Dr"
                                            End If
                                            'dr("HeaderSLNo") = dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                num = dtdetails.Rows.Count - 1
                                                dtdetails(num)("HeaderSLNo") = ""
                                                headingTotal = 0
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                        'CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                        CreditTotal = 0
                                                        TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                        CreditTotal = CreditTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                    Else
                                                        'DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                        DebitTotal = 0
                                                        TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                        DebitTotal = DebitTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                    End If
                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    'headingTotal = headingTotal + TOTalHeading
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            If CreditTotal > DebitTotal Then
                                                dr("SubHeaderSLNo") = "-" & (CreditTotal)
                                                TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                            Else
                                                dr("SubHeaderSLNo") = (DebitTotal)
                                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                            End If
                                            'dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                            S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                        Else
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            If CreditTotal > DebitTotal Then
                                                dr("SubHeaderSLNo") = "-" & (CreditTotal)
                                                TOTalHeadingCr = TOTalHeadingCr + (DebitTotal)
                                            Else
                                                dr("SubHeaderSLNo") = (DebitTotal)
                                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                            End If
                                            'dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                            S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                        End If
                                    Next
                                Else
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    If CreditTotal > DebitTotal Then
                                        dr("SubHeaderSLNo") = "-" & (CreditTotal)
                                        TOTalHeadingCr = TOTalHeadingCr + (DebitTotal)
                                    Else
                                        dr("SubHeaderSLNo") = (DebitTotal)
                                        TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                    End If
                                    'dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                    S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                End If
                            Next
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                num = dtdetails.Rows.Count - 1
                                dtdetails(num)("HeaderSLNo") = ""
                                DebitTotal = 0
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                            CreditTotal = 0
                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            DebitTotal = 0
                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If
                                        'dr("HeaderSLNo") = dtitem(k)("Total")

                                        'headingTotal = headingTotal + TOTalHeading
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            Else  ' Dk 27_06_221
                                dr = dtdetails.NewRow
                                If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                    'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                    TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                    dr("SubHeaderSLNo") = "-" & (TOTalHeading)
                                Else
                                    'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                    TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                    dr("SubHeaderSLNo") = TOTalHeading
                                End If
                                dtdetails.Rows.Add(dr)
                            End If
                        End If
                    Next
                End If

                dr = dtdetails.NewRow
                dr("Srno") = ""
                dr("Headingname") = "<B>" & "Total" & "</B>"
                If CreditTotal > DebitTotal Then
                    dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                Else
                    dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                End If
                dr("HeaderSLNo") = ""
                S3TotalAllHeadings = dr("SubHeaderSLNo")
                S1TotalAllHeadings = 0
                dtdetails.Rows.Add(dr)
                headingTotal = 0


                ' AST_AccHeadId = 2
                CreditTotal = 0
                DebitTotal = 0
                TOTalHeading = 0

                sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal   from Acc_TrailBalance_Upload_Details "
                sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & "And ATBUD_CustId=" & ICustid & ""
                sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId =2)group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
                dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtheading.Rows.Count > 0 Then
                    dr = dtdetails.NewRow
                    dr("SrNo") = ""
                    dr("Headingname") = "<B>" & "APPLICATION OF FUNDS" & "</B>"
                    dtdetails.Rows.Add(dr)
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = i + 1
                            dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                            If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                CreditTotal = CreditTotal + TOTalHeading
                                dr("HeaderSLNo") = TOTalHeading & "Cr"
                            Else
                                'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                DebitTotal = DebitTotal + TOTalHeading
                                dr("HeaderSLNo") = TOTalHeading & "Dr"
                            End If
                            'S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                            dtdetails.Rows.Add(dr)
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = i + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        ' CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        CreditTotal = 0
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                        'CreditTotal = CreditTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                    Else
                                        'DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        DebitTotal = 0
                                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                        DebitTotal = DebitTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                    End If
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    'headingTotal = TOTalHeading
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                End If
                                'item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    num = dtdetails.Rows.Count - 1
                                    dtdetails(num)("HeaderSLNo") = ""
                                    headingTotal = 0
                                    For k = 0 To dtitem.Rows.Count - 1
                                        headingTotal = 0
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                                CreditTotal = 0
                                                'CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                                                TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                                CreditTotal = CreditTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Cr"
                                            Else
                                                DebitTotal = 0
                                                'DebitTotal = DebitTotal + dtitem(k)("DbTotal")
                                                TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                                DebitTotal = DebitTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Dr"
                                            End If
                                            'dr("HeaderSLNo") = dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                num = dtdetails.Rows.Count - 1
                                                dtdetails(num)("HeaderSLNo") = ""
                                                headingTotal = 0
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                        'CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                        CreditTotal = 0
                                                        TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                        CreditTotal = CreditTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                    Else
                                                        DebitTotal = 0
                                                        'DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                        TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                        DebitTotal = DebitTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                    End If
                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    'headingTotal = headingTotal + TOTalHeading
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "<B>" & "Total" & "</B>"
                                            If CreditTotal > DebitTotal Then
                                                dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                            Else
                                                dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                            End If
                                            dr("HeaderSLNo") = ""
                                            'S3TotalAllHeadings = dr("SubHeaderSLNo")
                                            S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                            'S1TotalAllHeadings = 0
                                            dtdetails.Rows.Add(dr)
                                            headingTotal = 0
                                            CreditTotal = 0
                                            DebitTotal = 0
                                        Else
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            If CreditTotal > DebitTotal Then
                                                dr("SubHeaderSLNo") = "-" & (TOTalHeading)
                                                TOTalHeadingCr = TOTalHeadingCr + (DebitTotal)
                                            Else
                                                dr("SubHeaderSLNo") = (TOTalHeading)
                                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                            End If
                                            'dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                            CreditTotal = 0
                                            DebitTotal = 0
                                            S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                        End If
                                    Next
                                Else
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    If CreditTotal > DebitTotal Then
                                        dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                        TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                    Else
                                        dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                        TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                    End If
                                    'dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                    CreditTotal = 0
                                    DebitTotal = 0
                                    S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                End If
                            Next
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                num = dtdetails.Rows.Count - 1
                                dtdetails(num)("HeaderSLNo") = ""
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                            CreditTotal = 0
                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            DebitTotal = 0
                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If
                                        'dr("HeaderSLNo") = dtitem(k)("Total")

                                        'headingTotal = headingTotal + TOTalHeading
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        'S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                    Next
                    dr = dtdetails.NewRow
                    dr("Srno") = ""
                    dr("Headingname") = "<B>" & "Application Funds Total" & "</B>"
                    'If TOTalHeadingCr > TOTalHeadingDb Then
                    '    dr("SubHeaderSLNo") = "-" & (TOTalHeadingCr - TOTalHeadingDb)
                    'Else
                    '    dr("SubHeaderSLNo") = (TOTalHeadingDb - TOTalHeadingCr)
                    'End If
                    '         dr("SubHeaderSLNo") = S3TotalAllHeadings
                    dr("SubHeaderSLNo") = (Val(S1TotalAllHeadings))
                    dr("HeaderSLNo") = ""
                    'S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
                    'S1TotalAllHeadings = 0
                    dtdetails.Rows.Add(dr)
                End If

                dr = dtdetails.NewRow
                dr("Srno") = ""
                dr("Headingname") = "<B>" & "Grand Total" & "</B>"
                'If TOTalHeadingCr > TOTalHeadingDb Then
                '    dr("SubHeaderSLNo") = "-" & (TOTalHeadingCr - TOTalHeadingDb)
                'Else
                '    dr("SubHeaderSLNo") = (TOTalHeadingDb - TOTalHeadingCr)
                'End If
                '         dr("SubHeaderSLNo") = S3TotalAllHeadings
                dr("SubHeaderSLNo") = (Val(S3TotalAllHeadings))
                dr("HeaderSLNo") = ""
                S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
                S1TotalAllHeadings = 0
                dtdetails.Rows.Add(dr)
                headingTotal = 0
                TOTalHeadingCr = 0
                TOTalHeadingDb = 0
            ElseIf iRepType = 2 Then
                S1TotalAllHeadings = 0
                If dtheading.Rows.Count > 0 Then
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then

                            If IsDBNull(dtheading(i)("headingname")) = False Then
                                dr = dtdetails.NewRow
                                dr("SrNo") = i + 1
                                dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                                If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                    CreditTotal = 0
                                    'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                    TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                    CreditTotal = CreditTotal + TOTalHeading
                                    dr("SubHeaderSLNo") = TOTalHeading & "Cr"
                                Else
                                    DebitTotal = 0
                                    'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                    TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                    DebitTotal = DebitTotal + TOTalHeading
                                    dr("SubHeaderSLNo") = TOTalHeading & "Dr"
                                End If
                                '        S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                dtdetails.Rows.Add(dr)
                                TOTalHeading = 0

                            End If
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtdescdetails.Rows.Count > 0 Then
                                CreditTotal = 0 : DebitTotal = 0
                                For l = 0 To dtdescdetails.Rows.Count - 1
                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = "Description" & l + 1
                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                        If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                                            '  CreditTotal = 0
                                            'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                            TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            '     DebitTotal = 0
                                            '     DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                            TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If

                                        dtdetails.Rows.Add(dr)

                                    End If
                                Next
                                dr = dtdetails.NewRow
                                dr("Srno") = ""
                                dr("Headingname") = "<B>" & "Total" & "</B>"
                                If CreditTotal > DebitTotal Then
                                    dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                    TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                Else
                                    dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                    TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                End If
                                dtdetails.Rows.Add(dr)
                                S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                            End If
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = i + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        CreditTotal = 0
                                        CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("SubHeaderSLNo") = TOTalHeading & "Cr"
                                    Else
                                        DebitTotal = 0
                                        DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("SubHeaderSLNo") = TOTalHeading & "Dr"
                                    End If
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")

                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)

                                    CreditTotal = 0
                                    DebitTotal = 0 : TOTalHeading = 0
                                    'Fetch desc Under Sub heading
                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
                                    sSql = sSql & " from Acc_TrailBalance_Upload "
                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                    sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtdescdetails.Rows.Count > 0 Then
                                        For l = 0 To dtdescdetails.Rows.Count - 1
                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                                                dr = dtdetails.NewRow
                                                dr("SrNo") = "Description" & l + 1
                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then

                                                    'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                    TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                                    CreditTotal = CreditTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                Else

                                                    'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                    TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                                    DebitTotal = DebitTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                End If
                                                '      S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                dtdetails.Rows.Add(dr)

                                            End If
                                        Next
                                        dr = dtdetails.NewRow
                                        dr("Srno") = ""
                                        dr("Headingname") = "<B>" & "Total" & "</B>"
                                        If CreditTotal > DebitTotal Then
                                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                        Else
                                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                        End If
                                        S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                        dtdetails.Rows.Add(dr)
                                        CreditTotal = 0
                                        DebitTotal = 0
                                        ' headingTotal = TOTalHeadingDb
                                    End If
                                End If
                                'Item
                                sSql = ""

                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    num = dtdetails.Rows.Count - 1
                                    dtdetails(num)("HeaderSLNo") = ""
                                    headingTotal = 0
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                                CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                                                TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                                headingTotal = headingTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Cr"
                                            Else
                                                DebitTotal = DebitTotal + dtitem(k)("DbTotal")
                                                TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                                headingTotal = headingTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Dr"
                                            End If
                                            'dr("HeaderSLNo") = dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                            'Fetching Item Name
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
                                            sSql = sSql & " from Acc_TrailBalance_Upload "
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Desc" & l + 1
                                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                        If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                                                            'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                            TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                                            CreditTotal = CreditTotal + TOTalHeading
                                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                        Else
                                                            'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                            TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                                            DebitTotal = DebitTotal + TOTalHeading
                                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                        End If
                                                        '  S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                        dtdetails.Rows.Add(dr)

                                                    End If
                                                Next
                                                dr = dtdetails.NewRow
                                                dr("Srno") = ""
                                                dr("Headingname") = "<B>" & "Total" & "</B>"
                                                If CreditTotal > DebitTotal Then
                                                    dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                                    TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                                Else
                                                    dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                                    TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                                End If
                                                S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                num = dtdetails.Rows.Count - 1
                                                dtdetails(num)("HeaderSLNo") = ""
                                                headingTotal = 0
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                        CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                        TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                    Else
                                                        DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                        TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                    End If
                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + TOTalHeading
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                    'Fetch desc Under Sub item
                                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
                                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0) as dbTotal from Acc_TrailBalance_Upload"
                                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubItems a on a.ASSI_ID=  b.ATBUD_SubItemId"
                                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid")
                                                    sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid")
                                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
                                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                    If dtdescdetails.Rows.Count > 0 Then
                                                        For m = 0 To dtdescdetails.Rows.Count - 1
                                                            If IsDBNull(dtdescdetails(m)("ATBUD_Description")) = False Then

                                                                dr = dtdetails.NewRow
                                                                dr("SrNo") = "Desc" & m + 1
                                                                dr("Headingname") = dtdescdetails(m)("ATBUD_Description")
                                                                If dtdescdetails(m)("CrTotal") > dtdescdetails(m)("DbTotal") Then
                                                                    'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                                    TOTalHeading = dtdescdetails(m)("CrTotal") - dtdescdetails(m)("DbTotal")
                                                                    CreditTotal = CreditTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                                Else
                                                                    'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                                    TOTalHeading = dtdescdetails(m)("DbTotal") - dtdescdetails(m)("CrTotal")
                                                                    DebitTotal = DebitTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                                End If
                                                                '  S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                                dtdetails.Rows.Add(dr)

                                                            End If
                                                        Next
                                                        dr = dtdetails.NewRow
                                                        dr("Srno") = ""
                                                        dr("Headingname") = "<B>" & "Total" & "</B>"

                                                        If CreditTotal > DebitTotal Then
                                                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                                        Else
                                                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                                        End If
                                                        S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                End If
                                            Next
                                            'dr = dtdetails.NewRow
                                            'dr("Srno") = ""
                                            'dr("Headingname") = "Total"
                                            'dr("SubHeaderSLNo") = headingTotal
                                            'dr("HeaderSLNo") = ""
                                            'headingTotal = 0
                                            'dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                Else
                                End If
                            Next
                            dr = dtdetails.NewRow
                            dr("Srno") = ""
                            dr("Headingname") = "Total"
                            If CreditTotal > DebitTotal Then
                                dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                            Else
                                dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                            End If
                            dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                            headingTotal = 0
                            dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    num = dtdetails.Rows.Count - 1
                                    dtdetails(num)("HeaderSLNo") = ""
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If
                                        'dr("HeaderSLNo") = dtitem(k)("Total")

                                        headingTotal = headingTotal + TOTalHeading
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        ' S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                        'Fetching Items under Subitem Heading
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total
                                                        from Acc_TrailBalance_Upload"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                        sSql = sSql & " and ATBUD_Subheading=0 And ATBUD_itemid<>0 and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & ""
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Desc" & l + 1
                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                    If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                                                        'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                        TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                                        CreditTotal = CreditTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                    Else
                                                        'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                        TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                                        DebitTotal = DebitTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                    End If
                                                    '  S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                    dtdetails.Rows.Add(dr)

                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "<B>" & "Total" & "</B>"
                                            If CreditTotal > DebitTotal Then
                                                dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                                TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                            Else
                                                dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                            End If
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                    DebitTotal = 0 : CreditTotal = 0
                    TOTalHeading = 0
                End If
                dr = dtdetails.NewRow
                dr("Srno") = 4
                dr("Headingname") = "<B>" & "Application Of Funds" & "</B>"
                dr("SubHeaderSLNo") = ""
                dr("HeaderSLNo") = S1TotalAllHeadings
                ' S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
                '  S1TotalAllHeadings = 0
                dtdetails.Rows.Add(dr)
                headingTotal = 0
                ' AST_AccHeadId = 2

                sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal   from Acc_TrailBalance_Upload_Details "
                sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & ""
                sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId =2)group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
                dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dtheading.Rows.Count > 0 Then
                    For i = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(i)("headingname")) = False Then

                            If IsDBNull(dtheading(i)("headingname")) = False Then
                                dr = dtdetails.NewRow
                                dr("SrNo") = i + 1
                                dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                                If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                    CreditTotal = 0
                                    'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                    TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                    CreditTotal = CreditTotal + TOTalHeading
                                    dr("SubHeaderSLNo") = TOTalHeading & "Cr"
                                Else
                                    DebitTotal = 0
                                    'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                    TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                    DebitTotal = DebitTotal + TOTalHeading
                                    dr("SubHeaderSLNo") = TOTalHeading & "Dr"
                                End If
                                '        S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                dtdetails.Rows.Add(dr)
                                TOTalHeading = 0

                            End If
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_SChedule_Type=" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(i)("ATBUD_HeadingID") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtdescdetails.Rows.Count > 0 Then
                                CreditTotal = 0 : DebitTotal = 0
                                For l = 0 To dtdescdetails.Rows.Count - 1
                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = "Desc" & l + 1
                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                        If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                                            '  CreditTotal = 0
                                            'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                            TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                            CreditTotal = CreditTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            '     DebitTotal = 0
                                            '     DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                            TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                            DebitTotal = DebitTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If

                                        dtdetails.Rows.Add(dr)

                                    End If
                                Next
                                dr = dtdetails.NewRow
                                dr("Srno") = ""
                                dr("Headingname") = "<B>" & "Total" & "</B>"
                                If CreditTotal > DebitTotal Then
                                    dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                    TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                Else
                                    dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                    TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                End If
                                dtdetails.Rows.Add(dr)
                                S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                            End If
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = i + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                        CreditTotal = 0
                                        CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("SubHeaderSLNo") = TOTalHeading & "Cr"
                                    Else
                                        DebitTotal = 0
                                        DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                        TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("SubHeaderSLNo") = TOTalHeading & "Dr"
                                    End If
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")

                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)

                                    CreditTotal = 0
                                    DebitTotal = 0 : TOTalHeading = 0
                                    'Fetch desc Under Sub heading
                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
                                    sSql = sSql & " from Acc_TrailBalance_Upload "
                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                    sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtdescdetails.Rows.Count > 0 Then
                                        For l = 0 To dtdescdetails.Rows.Count - 1
                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                                                dr = dtdetails.NewRow
                                                dr("SrNo") = "Desc" & l + 1
                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then

                                                    'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                    TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                                    CreditTotal = CreditTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                Else

                                                    'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                    TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                                    DebitTotal = DebitTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                End If
                                                '      S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                dtdetails.Rows.Add(dr)

                                            End If
                                        Next
                                        dr = dtdetails.NewRow
                                        dr("Srno") = ""
                                        dr("Headingname") = "<B>" & "Total" & "</B>"
                                        If CreditTotal > DebitTotal Then
                                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                        Else
                                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                        End If
                                        S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                        dtdetails.Rows.Add(dr)
                                        CreditTotal = 0
                                        DebitTotal = 0
                                        ' headingTotal = TOTalHeadingDb
                                    End If
                                End If
                                'Item
                                sSql = ""

                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    num = dtdetails.Rows.Count - 1
                                    dtdetails(num)("HeaderSLNo") = ""
                                    headingTotal = 0
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                                CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                                                TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                                headingTotal = headingTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Cr"
                                            Else
                                                DebitTotal = DebitTotal + dtitem(k)("DbTotal")
                                                TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                                headingTotal = headingTotal + TOTalHeading
                                                dr("HeaderSLNo") = TOTalHeading & "Dr"
                                            End If
                                            'dr("HeaderSLNo") = dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                            'Fetching Item Name
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
                                            sSql = sSql & " from Acc_TrailBalance_Upload "
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Desc" & l + 1
                                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                        If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                                                            'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                            TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                                            CreditTotal = CreditTotal + TOTalHeading
                                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                        Else
                                                            'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                            TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                                            DebitTotal = DebitTotal + TOTalHeading
                                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                        End If
                                                        '  S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                        dtdetails.Rows.Add(dr)

                                                    End If
                                                Next
                                                dr = dtdetails.NewRow
                                                dr("Srno") = ""
                                                dr("Headingname") = "<B>" & "Total" & "</B>"
                                                If CreditTotal > DebitTotal Then
                                                    dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                                    TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                                Else
                                                    dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                                    TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                                End If
                                                S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                num = dtdetails.Rows.Count - 1
                                                dtdetails(num)("HeaderSLNo") = ""
                                                headingTotal = 0
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                        CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                        TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                    Else
                                                        DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                        TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                        headingTotal = headingTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                    End If
                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + TOTalHeading
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                    'Fetch desc Under Sub item
                                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSI_ID, a.ASSI_Name as headingname,"
                                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal,ISNULL(Sum(ATBU_Closing_TotalDebit_Amount+0),0) as dbTotal from Acc_TrailBalance_Upload"
                                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubItems a on a.ASSI_ID=  b.ATBUD_SubItemId"
                                                    sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid")
                                                    sSql = sSql & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid")
                                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,a.ASSI_ID, a.ASSI_Name order by ATBUD_ID"
                                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                                    If dtdescdetails.Rows.Count > 0 Then
                                                        For m = 0 To dtdescdetails.Rows.Count - 1
                                                            If IsDBNull(dtdescdetails(m)("ATBUD_Description")) = False Then

                                                                dr = dtdetails.NewRow
                                                                dr("SrNo") = "Desc" & m + 1
                                                                dr("Headingname") = dtdescdetails(m)("ATBUD_Description")
                                                                If dtdescdetails(m)("CrTotal") > dtdescdetails(m)("DbTotal") Then
                                                                    'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                                    TOTalHeading = dtdescdetails(m)("CrTotal") - dtdescdetails(m)("DbTotal")
                                                                    CreditTotal = CreditTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                                Else
                                                                    'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                                    TOTalHeading = dtdescdetails(m)("DbTotal") - dtdescdetails(m)("CrTotal")
                                                                    DebitTotal = DebitTotal + TOTalHeading
                                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                                End If
                                                                '  S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                                dtdetails.Rows.Add(dr)

                                                            End If
                                                        Next
                                                        dr = dtdetails.NewRow
                                                        dr("Srno") = ""
                                                        dr("Headingname") = "<B>" & "Total" & "</B>"

                                                        If CreditTotal > DebitTotal Then
                                                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                                        Else
                                                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                                        End If
                                                        S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                End If
                                            Next
                                            'dr = dtdetails.NewRow
                                            'dr("Srno") = ""
                                            'dr("Headingname") = "Total"
                                            'dr("SubHeaderSLNo") = headingTotal
                                            'dr("HeaderSLNo") = ""
                                            'headingTotal = 0
                                            'dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                Else
                                End If
                            Next
                            dr = dtdetails.NewRow
                            dr("Srno") = ""
                            dr("Headingname") = "Total"
                            If CreditTotal > DebitTotal Then
                                dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                            Else
                                dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                            End If
                            dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + dr("SubHeaderSLNo")
                            headingTotal = 0
                            dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    num = dtdetails.Rows.Count - 1
                                    dtdetails(num)("HeaderSLNo") = ""
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If
                                        'dr("HeaderSLNo") = dtitem(k)("Total")

                                        headingTotal = headingTotal + TOTalHeading
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        ' S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                        'Fetching Items under Subitem Heading
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total
                                                        from Acc_TrailBalance_Upload"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                        sSql = sSql & " where ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & ""
                                        sSql = sSql & " and ATBUD_Subheading=0 And ATBUD_itemid<>0 and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & ""
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then

                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Desc" & l + 1
                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                    If dtdescdetails(l)("CrTotal") > dtdescdetails(l)("DbTotal") Then
                                                        'CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                                                        TOTalHeading = dtdescdetails(l)("CrTotal") - dtdescdetails(l)("DbTotal")
                                                        CreditTotal = CreditTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                    Else
                                                        'DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                                                        TOTalHeading = dtdescdetails(l)("DbTotal") - dtdescdetails(l)("CrTotal")
                                                        DebitTotal = DebitTotal + TOTalHeading
                                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                    End If
                                                    '  S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                                                    dtdetails.Rows.Add(dr)

                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "<B>" & "Total" & "</B>"
                                            If CreditTotal > DebitTotal Then
                                                dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                                TOTalHeadingCr = TOTalHeadingCr + (CreditTotal)
                                            Else
                                                dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                                TOTalHeadingDb = TOTalHeadingDb + (DebitTotal)
                                            End If
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                    DebitTotal = 0 : CreditTotal = 0
                    TOTalHeading = 0
                End If
                'dr = dtdetails.NewRow
                'dr("Srno") = 5
                'dr("Headingname") = "<B>" & "Application Of Funds" & "</B>"
                'dr("HeaderSLNo") = ""
                'dr("SubHeaderSLNo") = S2TotalAllHeadings
                'S3TotalAllHeadings = S3TotalAllHeadings + S2TotalAllHeadings
                'S2TotalAllHeadings = 0
                'dtdetails.Rows.Add(dr)
                dr = dtdetails.NewRow
                dr("Srno") = ""
                dr("Headingname") = "<B>" & " Grand Total" & "</B>"
                dr("HeaderSLNo") = ""
                dr("SubHeaderSLNo") = (Val(S3TotalAllHeadings))
                S3TotalAllHeadings = 0
                dtdetails.Rows.Add(dr)
            End If
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getBalAssetSheet(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iRepType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim S3TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer = 0
        Dim TOTalHeading As Double = 0
        Dim TOTalHeadingDb As Double = 0
        Dim TOTalHeadingCr As Double = 0
        Dim CreditTotal As Double = 0
        Dim DebitTotal As Double = 0
        Try

            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname, "
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
            sSql = sSql & "  from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " left join ACC_ScheduleTemplates b on AST_HeadingID = ATBUD_Headingid "
            sSql = sSql & " where ATBUD_Headingid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " and b.AST_AccHeadId =1 And ATBUD_CustId=" & ICustid & ""
            sSql = sSql & " group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            dr = dtdetails.NewRow
            dr("SrNo") = ""
            dr("Headingname") = "<B>" & "SOURCE OF FUNDS" & "</B>"
            dtdetails.Rows.Add(dr)

            If dtheading.Rows.Count > 0 Then
                For i = 0 To dtheading.Rows.Count - 1
                    If IsDBNull(dtheading(i)("headingname")) = False Then
                        dr = dtdetails.NewRow
                        dr("SrNo") = i + 1
                        dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                        If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                            CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                            headingTotal = headingTotal + TOTalHeading
                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                        Else
                            DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                            headingTotal = headingTotal + TOTalHeading
                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                        End If
                        S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                        dtdetails.Rows.Add(dr)
                    End If
                    'Sub Heading
                    sSql = ""
                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading <>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                    If dtsubheading.Rows.Count > 0 Then
                        num = dtdetails.Rows.Count - 1
                        dtdetails(num)("HeaderSLNo") = ""
                        headingTotal = 0
                        DebitTotal = 0
                        CreditTotal = 0
                        For j = 0 To dtsubheading.Rows.Count - 1
                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                dr = dtdetails.NewRow
                                dr("SrNo") = i + 1 & "-" & j + 1
                                dr("Headingname") = dtsubheading(j)("headingname")
                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                    CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                    TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                    headingTotal = headingTotal + TOTalHeading
                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                Else
                                    DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                    TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                    headingTotal = headingTotal + TOTalHeading
                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                End If
                                'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                headingTotal = TOTalHeading
                                'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                dtdetails.Rows.Add(dr)
                            End If
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                            sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " And ATBUD_itemid<>0 and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            Dim z As Integer = 0
                            If dtitem.Rows.Count > 0 Then
                                z = z + 1
                                num = dtdetails.Rows.Count - 1
                                dtdetails(num)("HeaderSLNo") = ""
                                headingTotal = 0
                                DebitTotal = 0
                                CreditTotal = 0
                                For k = 0 To dtitem.Rows.Count - 1
                                    headingTotal = 0
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                            CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            DebitTotal = DebitTotal + dtitem(k)("DbTotal")
                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If
                                        'dr("HeaderSLNo") = dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        dtdetails.Rows.Add(dr)
                                    End If
                                    'Sub item
                                    sSql = ""
                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtSubitem.Rows.Count > 0 Then
                                        For L = 0 To dtSubitem.Rows.Count - 1
                                            num = dtdetails.Rows.Count - 1
                                            dtdetails(num)("HeaderSLNo") = ""
                                            headingTotal = 0
                                            DebitTotal = 0
                                            CreditTotal = 0
                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                dr("Headingname") = dtSubitem(L)("headingname")
                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                    CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                    headingTotal = headingTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                Else
                                                    DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                    headingTotal = headingTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                End If
                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                headingTotal = headingTotal + TOTalHeading
                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                        dr = dtdetails.NewRow
                                        dr("Srno") = ""
                                        dr("Headingname") = "Total"
                                        If CreditTotal > DebitTotal Then
                                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal - DebitTotal)
                                        Else
                                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal - CreditTotal)
                                        End If
                                        'dr("SubHeaderSLNo") = headingTotal
                                        dr("HeaderSLNo") = ""
                                        headingTotal = 0
                                        dtdetails.Rows.Add(dr)
                                    Else
                                    End If
                                Next
                            Else
                            End If
                        Next
                        dr = dtdetails.NewRow
                        dr("Srno") = ""
                        dr("Headingname") = "Total"
                        If CreditTotal > DebitTotal Then
                            dr("SubHeaderSLNo") = "-" & (headingTotal - DebitTotal)
                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal - DebitTotal)
                        Else
                            dr("SubHeaderSLNo") = (headingTotal - CreditTotal)
                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal - CreditTotal)
                        End If
                        dr("HeaderSLNo") = ""
                        'dr("SubHeaderSLNo") = headingTotal
                        'dr("HeaderSLNo") = ""
                        headingTotal = 0
                        dtdetails.Rows.Add(dr)
                    Else
                        'item
                        sSql = ""
                        sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                        sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtitem.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            DebitTotal = 0
                            CreditTotal = 0
                            For k = 0 To dtitem.Rows.Count - 1
                                If IsDBNull(dtitem(k)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
                                    dr("Headingname") = dtitem(k)("headingname")
                                    If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                        TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                    Else
                                        TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                    End If
                                    'dr("HeaderSLNo") = dtitem(k)("Total")

                                    headingTotal = headingTotal + TOTalHeading
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                    S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                    dtdetails.Rows.Add(dr)
                                End If
                            Next
                        End If
                    End If
                Next
            End If

            dr = dtdetails.NewRow
            dr("Srno") = 4
            dr("Headingname") = "<B>" & "Source Of Funds" & "</B>"
            If TOTalHeadingCr > TOTalHeadingDb Then
                dr("SubHeaderSLNo") = "-" & (TOTalHeadingCr - TOTalHeadingDb)
            Else
                dr("SubHeaderSLNo") = (TOTalHeadingDb - TOTalHeadingCr)
            End If
            dr("HeaderSLNo") = ""
            S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
            S1TotalAllHeadings = 0
            dtdetails.Rows.Add(dr)
            headingTotal = 0
            TOTalHeadingCr = 0
            TOTalHeadingDb = 0
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getBalLiabilitySheet(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iRepType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim S3TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer = 0
        Dim TOTalHeading As Double = 0
        Dim TOTalHeadingDb As Double = 0
        Dim TOTalHeadingCr As Double = 0
        Dim CreditTotal As Double = 0
        Dim DebitTotal As Double = 0
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            'heading
            sSql = ""
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname, "
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal "
            sSql = sSql & "  from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " left join ACC_ScheduleTemplates b on AST_HeadingID = ATBUD_Headingid "
            sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " and b.AST_AccHeadId =2 And ATBUD_CustId=" & ICustid & ""
            sSql = sSql & " group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid"
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            dr = dtdetails.NewRow
            dr("SrNo") = ""
            dr("Headingname") = "<B>" & "Application OF FUNDS" & "</B>"
            dtdetails.Rows.Add(dr)
            If dtheading.Rows.Count > 0 Then
                For i = 0 To dtheading.Rows.Count - 1
                    If IsDBNull(dtheading(i)("headingname")) = False Then
                        dr = dtdetails.NewRow
                        dr("SrNo") = i + 1
                        dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                        If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                            CreditTotal = CreditTotal + dtheading(i)("CrTotal")
                            TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                            headingTotal = headingTotal + TOTalHeading
                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                        Else
                            DebitTotal = DebitTotal + dtheading(i)("DbTotal")
                            TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                            headingTotal = headingTotal + TOTalHeading
                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                        End If
                        S1TotalAllHeadings = S1TotalAllHeadings + TOTalHeading
                        dtdetails.Rows.Add(dr)
                    End If
                    'Sub Heading
                    sSql = ""
                    sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal  "
                    sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                    sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                    sSql = sSql & " where  ATBUD_Headingid= " & dtheading(i)("ATBUD_Headingid") & " and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & ""
                    sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                    dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                    If dtsubheading.Rows.Count > 0 Then
                        num = dtdetails.Rows.Count - 1
                        dtdetails(num)("HeaderSLNo") = ""
                        headingTotal = 0
                        DebitTotal = 0
                        CreditTotal = 0
                        For j = 0 To dtsubheading.Rows.Count - 1
                            If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                dr = dtdetails.NewRow
                                dr("SrNo") = i + 1 & "-" & j + 1
                                dr("Headingname") = dtsubheading(j)("headingname")
                                If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                    CreditTotal = CreditTotal + dtsubheading(j)("CrTotal")
                                    TOTalHeading = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                    headingTotal = headingTotal + TOTalHeading
                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                Else
                                    DebitTotal = DebitTotal + dtsubheading(j)("CrTotal")
                                    TOTalHeading = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                    headingTotal = headingTotal + TOTalHeading
                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                End If
                                'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                headingTotal = TOTalHeading
                                'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                dtdetails.Rows.Add(dr)
                            End If
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                            sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details  "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                            sSql = sSql & " and ATBUD_SChedule_Type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            Dim z As Integer = 0
                            If dtitem.Rows.Count > 0 Then
                                z = z + 1
                                num = dtdetails.Rows.Count - 1
                                dtdetails(num)("HeaderSLNo") = ""
                                headingTotal = 0
                                DebitTotal = 0
                                CreditTotal = 0
                                For k = 0 To dtitem.Rows.Count - 1
                                    headingTotal = 0
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                            CreditTotal = CreditTotal + dtitem(k)("CrTotal")
                                            TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Cr"
                                        Else
                                            DebitTotal = DebitTotal + dtitem(k)("DbTotal")
                                            TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                            headingTotal = headingTotal + TOTalHeading
                                            dr("HeaderSLNo") = TOTalHeading & "Dr"
                                        End If
                                        'dr("HeaderSLNo") = dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        dtdetails.Rows.Add(dr)
                                    End If
                                    'Sub item
                                    sSql = ""
                                    sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                    sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                                    sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                    sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                    sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type =" & iSchedulrTypeIdd & "  and ATBUD_CustId=" & ICustid & "And ATBUD_SubItemId<>0 group by ATBUD_SubItemId,a.ASSI_Name"
                                    dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtSubitem.Rows.Count > 0 Then
                                        For L = 0 To dtSubitem.Rows.Count - 1
                                            num = dtdetails.Rows.Count - 1
                                            dtdetails(num)("HeaderSLNo") = ""
                                            headingTotal = 0
                                            DebitTotal = 0
                                            CreditTotal = 0
                                            If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("Srno") = i + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                dr("Headingname") = dtSubitem(L)("headingname")
                                                If dtSubitem(L)("CrTotal") > dtSubitem(L)("DbTotal") Then
                                                    CreditTotal = CreditTotal + dtSubitem(L)("CrTotal")
                                                    TOTalHeading = dtSubitem(L)("CrTotal") - dtSubitem(L)("DbTotal")
                                                    headingTotal = headingTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Cr"
                                                Else
                                                    DebitTotal = DebitTotal + dtSubitem(L)("DbTotal")
                                                    TOTalHeading = dtSubitem(L)("DbTotal") - dtSubitem(L)("CrTotal")
                                                    headingTotal = headingTotal + TOTalHeading
                                                    dr("HeaderSLNo") = TOTalHeading & "Dr"
                                                End If
                                                'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                headingTotal = headingTotal + TOTalHeading
                                                'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                        dr = dtdetails.NewRow
                                        dr("Srno") = ""
                                        dr("Headingname") = "Total"
                                        If CreditTotal > DebitTotal Then
                                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal - DebitTotal)
                                        Else
                                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal - CreditTotal)
                                        End If
                                        'dr("SubHeaderSLNo") = headingTotal
                                        dr("HeaderSLNo") = ""
                                        headingTotal = 0
                                        dtdetails.Rows.Add(dr)
                                    Else
                                    End If
                                Next
                            Else
                            End If
                        Next
                        dr = dtdetails.NewRow
                        dr("Srno") = ""
                        dr("Headingname") = "Total"
                        If CreditTotal > DebitTotal Then
                            dr("SubHeaderSLNo") = "-" & (CreditTotal - DebitTotal)
                            TOTalHeadingCr = TOTalHeadingCr + (CreditTotal - DebitTotal)
                        Else
                            dr("SubHeaderSLNo") = (DebitTotal - CreditTotal)
                            TOTalHeadingDb = TOTalHeadingDb + (DebitTotal - CreditTotal)
                        End If
                        dr("HeaderSLNo") = ""
                        'dr("SubHeaderSLNo") = headingTotal
                        'dr("HeaderSLNo") = ""
                        headingTotal = 0
                        dtdetails.Rows.Add(dr)
                    Else
                        'item
                        sSql = ""
                        sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal from Acc_TrailBalance_Upload_Details "
                        sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                        sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(i)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_itemid<>0 and ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                        dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtitem.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            DebitTotal = 0
                            CreditTotal = 0
                            For k = 0 To dtitem.Rows.Count - 1
                                If IsDBNull(dtitem(k)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("Srno") = i + 1 & "-" & "0" & "-" & k + 1
                                    dr("Headingname") = dtitem(k)("headingname")
                                    If dtitem(k)("CrTotal") > dtitem(k)("DbTotal") Then
                                        TOTalHeading = dtitem(k)("CrTotal") - dtitem(k)("DbTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Cr"
                                    Else
                                        TOTalHeading = dtitem(k)("DbTotal") - dtitem(k)("CrTotal")
                                        headingTotal = headingTotal + TOTalHeading
                                        dr("HeaderSLNo") = TOTalHeading & "Dr"
                                    End If
                                    'dr("HeaderSLNo") = dtitem(k)("Total")

                                    headingTotal = headingTotal + TOTalHeading
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                    S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                    dtdetails.Rows.Add(dr)
                                End If
                            Next
                        End If
                    End If
                Next
            End If

            dr = dtdetails.NewRow
            dr("Srno") = 4
            dr("Headingname") = "<B>" & "Source Of Funds" & "</B>"
            If TOTalHeadingCr > TOTalHeadingDb Then
                dr("SubHeaderSLNo") = "-" & (TOTalHeadingCr - TOTalHeadingDb)
            Else
                dr("SubHeaderSLNo") = (TOTalHeadingDb - TOTalHeadingCr)
            End If
            dr("HeaderSLNo") = ""
            S3TotalAllHeadings = S3TotalAllHeadings + S1TotalAllHeadings
            S1TotalAllHeadings = 0
            dtdetails.Rows.Add(dr)
            headingTotal = 0
            TOTalHeadingCr = 0
            TOTalHeadingDb = 0
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getPAndLIncome(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iReportType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            'Heading
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,"
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total "
            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " And ATBUD_Headingid in (13,14)"
            sSql = sSql & " group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid "
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            If iReportType = 3 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid in (13,14) and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then

                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid in (13,14) And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid in (13,14) And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "STotal"
                            'dr("SubHeaderSLNo") = S2TotalAllHeadings
                            'dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            'dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid in (13,14) And ATBUD_Subheading=0 And ATBUD_SubItemId<>0 and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    num = dtdetails.Rows.Count - 1
                                    headingTotal = 0
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            ElseIf iReportType = 4 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid in (13,14)  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtheading.Rows.Count > 0 Then
                                For l = 0 To dtdescdetails.Rows.Count - 1
                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = "Description" & l + 1
                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                        'dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                        'Sub heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid in (13,14) and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = headingTotal + dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                    'Fetch desc Under Sub heading
                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                    sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid in (13,14)"
                                    sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtdescdetails.Rows.Count > 0 Then
                                        For l = 0 To dtdescdetails.Rows.Count - 1
                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("SrNo") = "Description: " & l + 1
                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid in (13,14)And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            'dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                            'Fetch desc under item
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid in (13,14)"
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Description: " & l + 1
                                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            End If
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid in (13,14) And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "STotal"
                            'dr("SubHeaderSLNo") = S2TotalAllHeadings
                            'dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            'dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid in (13,14) And ATBUD_Subheading=0 And ATBUD_SubItemId<>0 and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                num = dtdetails.Rows.Count - 1
                                headingTotal = 0
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        'dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                        sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid in (13,14)"
                                        sSql = sSql & " and b.ATBUD_Subheading=0 and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Description: " & l + 1
                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            End If
            dr = dtdetails.NewRow
            dr("Srno") = ""
            dr("Headingname") = "Grand Total"
            dr("HeaderSLNo") = ""
            dr("SubHeaderSLNo") = S2TotalAllHeadings
            S1TotalAllHeadings = 0
            dtdetails.Rows.Add(dr)
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getPAndLExpense(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iReportType As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            'Heading
            sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,"
            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total "
            sSql = sSql & " from Acc_TrailBalance_Upload_Details"
            sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid"
            sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
            sSql = sSql & " group by ATBUD_Headingid,ASH_Name order by ATBUD_Headingid "
            dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
            If iReportType = 1 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                        End If
                        'Sub Heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(m)("ATBUD_Headingid") & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then

                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "STotal"
                            'dr("SubHeaderSLNo") = S2TotalAllHeadings
                            'dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            'dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_SubItemId<>0 and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                For k = 0 To dtitem.Rows.Count - 1
                                    num = dtdetails.Rows.Count - 1
                                    headingTotal = 0
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            ElseIf iReportType = 2 Then
                If dtheading.Rows.Count > 0 Then
                    For m = 0 To dtheading.Rows.Count - 1
                        If IsDBNull(dtheading(m)("headingname")) = False Then
                            dr = dtdetails.NewRow
                            dr("SrNo") = m + 1
                            dr("Headingname") = "<B>" & dtheading(m)("headingname") & "</B>"
                            dr("HeaderSLNo") = dtheading(m)("Total")
                            headingTotal = headingTotal + dtheading(m)("Total")
                            S2TotalAllHeadings = S2TotalAllHeadings + dtheading(m)("Total")
                            dtdetails.Rows.Add(dr)
                            'Fetch desc under Heading
                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASH_ID, a.ash_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID  left join ACC_ScheduleHeading a on a.ASH_ID=  b.ATBUD_Headingid"
                            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & "  and b.ATBUD_Subheading=0 and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASH_ID,ash_Name order by ATBUD_ID"
                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtheading.Rows.Count > 0 Then
                                For l = 0 To dtdescdetails.Rows.Count - 1
                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("SrNo") = "Description" & l + 1
                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                        'dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                        dtdetails.Rows.Add(dr)
                                    End If
                                Next
                            End If
                        End If
                        'Sub heading
                        sSql = ""
                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname,"
                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total  "
                        sSql = sSql & " from Acc_TrailBalance_Upload_Details  "
                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                        sSql = sSql & " where  ATBUD_Headingid= " & dtheading(m)("ATBUD_Headingid") & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & ""
                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name order by ATBUD_Subheading"
                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubheading.Rows.Count > 0 Then
                            num = dtdetails.Rows.Count - 1
                            dtdetails(num)("HeaderSLNo") = ""
                            headingTotal = 0
                            For j = 0 To dtsubheading.Rows.Count - 1
                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("SrNo") = m + 1 & "-" & j + 1
                                    dr("Headingname") = dtsubheading(j)("headingname")
                                    'dr("HeaderSLNo") = dtsubheading(j)("Total")
                                    headingTotal = headingTotal + dtsubheading(j)("Total")
                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtsubheading(j)("Total")
                                    dtdetails.Rows.Add(dr)
                                    'Fetch desc Under Sub heading
                                    sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
                                    sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                    sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
                                    sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & ""
                                    sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=0 and b.ATBUD_SubItemId=0"
                                    sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                    dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                    If dtdescdetails.Rows.Count > 0 Then
                                        For l = 0 To dtdescdetails.Rows.Count - 1
                                            If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                dr = dtdetails.NewRow
                                                dr("SrNo") = "Description: " & l + 1
                                                dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                dtdetails.Rows.Add(dr)
                                            End If
                                        Next
                                    End If
                                End If
                                'Item
                                sSql = ""
                                sSql = " select distinct(ATBUD_itemid),a.ASI_Name as headingname, "
                                sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details  "
                                sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                                sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                                sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                sSql = sSql & " and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                                dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                Dim z As Integer = 0
                                If dtitem.Rows.Count > 0 Then
                                    z = z + 1
                                    For k = 0 To dtitem.Rows.Count - 1
                                        If IsDBNull(dtitem(k)("headingname")) = False Then
                                            dr = dtdetails.NewRow
                                            dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1
                                            dr("Headingname") = dtitem(k)("headingname")
                                            'dr("HeaderSLNo") = dtitem(k)("Total")
                                            headingTotal = headingTotal + dtitem(k)("Total")
                                            'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                            dtdetails.Rows.Add(dr)
                                            'Fetch desc under item
                                            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                            sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & ""
                                            sSql = sSql & " and b.ATBUD_Subheading=" & dtsubheading(j)("ATBUD_Subheading") & " and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASI_ID,ASI_Name order by ATBUD_ID"
                                            dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                            If dtdescdetails.Rows.Count > 0 Then
                                                For l = 0 To dtdescdetails.Rows.Count - 1
                                                    If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                        dr = dtdetails.NewRow
                                                        dr("SrNo") = "Description: " & l + 1
                                                        dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                        dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                        dtdetails.Rows.Add(dr)
                                                    End If
                                                Next
                                            End If
                                        End If
                                        'Sub item
                                        sSql = ""
                                        sSql = sSql & " select distinct(ATBUD_SubItemId),a.ASSI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                                        sSql = sSql & " left join ACC_ScheduleSubItems a on a.ASSI_ID= ATBUD_SubItemId "
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid "
                                        sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading= " & dtsubheading(j)("ATBUD_Subheading") & ""
                                        sSql = sSql & " And ATBUD_SubItemId<>0 And ATBUD_itemid = " & dtitem.Rows(k)("ATBUD_itemid") & " And ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_SubItemId,a.ASSI_Name"
                                        dtSubitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtSubitem.Rows.Count > 0 Then
                                            For L = 0 To dtSubitem.Rows.Count - 1
                                                If IsDBNull(dtSubitem(L)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("Srno") = m + 1 & "-" & j + 1 & "-" & k + 1 & "-" & L + 1
                                                    dr("Headingname") = dtSubitem(L)("headingname")
                                                    'dr("HeaderSLNo") = dtSubitem(L)("Total")
                                                    headingTotal = headingTotal + dtSubitem(L)("Total")
                                                    'S2TotalAllHeadings = S2TotalAllHeadings + dtSubitem(L)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                            dr = dtdetails.NewRow
                                            dr("Srno") = ""
                                            dr("Headingname") = "Total"
                                            dr("SubHeaderSLNo") = headingTotal
                                            dr("HeaderSLNo") = ""
                                            headingTotal = 0
                                            dtdetails.Rows.Add(dr)
                                        Else
                                        End If
                                    Next
                                    dr = dtdetails.NewRow
                                    dr("Srno") = ""
                                    dr("Headingname") = "Total"
                                    dr("SubHeaderSLNo") = headingTotal
                                    dr("HeaderSLNo") = ""
                                    headingTotal = 0
                                    dtdetails.Rows.Add(dr)
                                Else
                                End If
                            Next
                            'dr = dtdetails.NewRow
                            'dr("Srno") = ""
                            'dr("Headingname") = "STotal"
                            'dr("SubHeaderSLNo") = S2TotalAllHeadings
                            'dr("HeaderSLNo") = ""
                            S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                            'dtdetails.Rows.Add(dr)
                        Else
                            'item
                            sSql = ""
                            sSql = " select distinct(ATBUD_itemid),a.ASSI_Name as headingname,"
                            sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+d.ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload_Details "
                            sSql = sSql & " left join ACC_ScheduleItems a on a.ASI_ID= ATBUD_itemid"
                            sSql = sSql & " Left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid"
                            sSql = sSql & " where ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & " And ATBUD_Subheading=0 And ATBUD_SubItemId<>0 and ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " group by ATBUD_itemid,a.ASI_Name"
                            dtitem = objDBL.SQLExecuteDataTable(sAC, sSql)
                            If dtitem.Rows.Count > 0 Then
                                num = dtdetails.Rows.Count - 1
                                headingTotal = 0
                                For k = 0 To dtitem.Rows.Count - 1
                                    If IsDBNull(dtitem(k)("headingname")) = False Then
                                        dr = dtdetails.NewRow
                                        dr("Srno") = m + 1 & "-" & "0" & "-" & k + 1
                                        dr("Headingname") = dtitem(k)("headingname")
                                        'dr("HeaderSLNo") = dtitem(k)("Total")
                                        headingTotal = headingTotal + dtitem(k)("Total")
                                        'S2TotalAllHeadings = S2TotalAllHeadings + dtitem(k)("Total")
                                        S1TotalAllHeadings = S1TotalAllHeadings + S2TotalAllHeadings
                                        dtdetails.Rows.Add(dr)
                                        sSql = "select distinct(b.ATBUD_ID),ATBUD_Description,a.ASI_ID, a.ASI_Name as headingname,"
                                        sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleItems a on a.ASI_ID=  b.ATBUD_itemid"
                                        sSql = sSql & " where ATBUD_Schedule_type in(1,2,3) and ATBUD_CustId=" & ICustid & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & dtheading(m)("ATBUD_Headingid") & ""
                                        sSql = sSql & " and b.ATBUD_Subheading=0 and b.ATBUD_itemid=" & dtitem(k)("ATBUD_itemid") & " and b.ATBUD_SubItemId=0"
                                        sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
                                        dtdescdetails = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtdescdetails.Rows.Count > 0 Then
                                            For l = 0 To dtdescdetails.Rows.Count - 1
                                                If IsDBNull(dtdescdetails(l)("ATBUD_Description")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = "Description: " & l + 1
                                                    dr("Headingname") = dtdescdetails(l)("ATBUD_Description")
                                                    dr("HeaderSLNo") = dtdescdetails(l)("Total")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        End If
                                    End If
                                Next
                            End If
                        End If
                    Next
                End If
            End If
            dr = dtdetails.NewRow
            dr("Srno") = ""
            dr("Headingname") = "Grand Total"
            dr("HeaderSLNo") = ""
            dr("SubHeaderSLNo") = S2TotalAllHeadings
            S1TotalAllHeadings = 0
            dtdetails.Rows.Add(dr)
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadNonLinkeddescrition(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeId As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Try
            sSql = " select ROW_NUMBER() OVER (ORDER BY ATBUd_ID ASC) AS SrNo,ATBUD_Description As Description from  Acc_TrailBalance_Upload_Details"
            sSql = sSql & " Where ATBUD_CustId=" & ICustid & " and ATBUD_YEARId=" & IyearID & ""
            sSql = sSql & " And ATBUD_Headingid=0 And ATBUD_Subheading=0 And ATBUD_itemid=0 And ATBUD_SubItemId=0"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadCustomerdetails(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer) As DataTable
        Dim sSql As String
        Try
            sSql = "Select CUST_COMM_ADDRESS + CUST_COMM_PIN as CUST_COMM_ADDRESS,CUST_NAME,CUST_ConEmailID from SAD_CUSTOMER_MASTER Where CUST_ID=" & iCustId & " and cust_Compid=" & iACID & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadCustomerpartners(ByVal sAC As String, ByVal iACID As Integer, ByVal iDetails As Integer) As DataTable
        Dim sSql As String
        Try

            If iDetails <> 0 Then
                sSql = "select usr_Id,usr_FullName as Fullname, usr_PhoneNo,org_name from Sad_UserDetails"
                sSql = sSql & " Left join sad_org_structure a On a.org_node=usr_OrgnId where usr_partner=1 And Usr_CompId=" & iACID & " And usr_Id=" & iDetails & ""
            Else
                sSql = "Select  usr_Id, usr_Code + '-' + usr_FullName as Fullname"
                sSql = sSql & " from Sad_UserDetails where usr_partner=1 and Usr_CompId=" & iACID & ""
            End If
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadCustomerdirectors(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustid As Integer) As DataTable
        Dim sSql As String
        Dim dt As New DataTable
        Dim dtdetails As New DataTable
        Dim sSplitAry() As String
        Dim dr As DataRow
        Try
            dtdetails.Columns.Add("Board_directors")
            sSql = " select  CUST_BOARDOFDIRECTORS as Board_directors from SAD_CUSTOMER_MASTER where CUST_ID=" & iCustid & " and CUST_CompId=" & iACID & ""
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            sSplitAry = dt.Rows(0)("Board_directors").Split(",")
            For i = 0 To sSplitAry.Length - 1
                If sSplitAry(i).ToString <> "" Then
                    dr = dtdetails.NewRow
                    dr("Board_directors") = sSplitAry(i).ToString
                    dtdetails.Rows.Add(dr)
                End If
            Next
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadOrgtype(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustid As Integer, ByVal iYearID As Integer) As String
        Dim sSql As String
        Dim dt As New DataTable
        Dim sOrgtype As String
        Try
            sSql = "SELECT cmm_Desc FROM SAD_CUSTOMER_MASTER LEFT JOIN Content_Management_Master ON Content_Management_Master.cmm_id = SAD_CUSTOMER_MASTER .CUST_ORGTYPEID WHERE SAD_CUSTOMER_MASTER.CUST_ID =" & iCustid & ""
            sOrgtype = objDBL.SQLExecuteScalar(sAC, sSql)
            Return sOrgtype

        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function Loadpartner1(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal iCustPartnerPKId As Integer, ByVal sDirandPatnr As String, ByVal sAccPol As String) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim dttab As New DataTable
        Dim dRow As DataRow
        Dim dr As OleDb.OleDbDataReader
        Dim sCity As String = "", sScope As String = ""
        Dim j As Integer = 0
        Dim k As Integer = 0
        Try
            dt.Columns.Add("Name")
            dt.Columns.Add("DIN")

            If sDirandPatnr <> "" Then
                sSql = "Select SSP_Id as PartnerPkID,SSP_PartnerName,SSP_PAN,SSP_DOJ,SSP_ShareOfProfit,SSP_DelFlag from SAD_Statutory_PartnerDetails where SSP_Id in(" & sDirandPatnr & ") and SSP_CustID=" & iCustId & " and SSP_CompID=" & iACID & ""
            ElseIf sAccPol = "AccPoli" Then
                sSql = "Select SSP_Id as PartnerPkID,SSP_PartnerName,SSP_PAN,SSP_DOJ,SSP_ShareOfProfit,SSP_DelFlag from SAD_Statutory_PartnerDetails where SSP_CustID=" & iCustId & " and SSP_CompID=" & iACID & ""
            End If
            dttab = objDBL.SQLExecuteDataTable(sAC, sSql)
            dr = objDBL.SQLDataReader(sAC, sSql)
            If dttab.Rows.Count > 0 Then
                For i = 0 To dttab.Rows.Count - 1
                    If i Mod 2 = 0 Then
                        dRow = dt.NewRow()
                        dRow("Name") = dttab(i)("SSP_PartnerName")
                        dt.Rows.Add(dRow)
                        dRow = dt.NewRow()
                        dRow("Name") = "Partner"
                        dt.Rows.Add(dRow)
                        j = j + 2
                    Else
                        dt(k)("DIN") = dttab(i)("SSP_PartnerName")
                        dt(k + 1)("DIN") = "Partner"
                        k = k + 3
                        dRow = dt.NewRow()
                        dt.Rows.Add(dRow)
                    End If
                Next
            End If
            Return dt
        Catch ex As Exception

        End Try
    End Function
    Public Function Loadpartners(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal iCustPartnerPKId As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim dttab As New DataTable
        Try
            sSql = "Select SSP_Id as PartnerPkID,SSP_PartnerName from SAD_Statutory_PartnerDetails where SSP_CustID=" & iCustId & " and SSP_CompID=" & iACID & ""
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception

        End Try
    End Function
    Public Function GetAccountPoliciesDescription(ByVal sAC As String, ByVal iCompID As Integer, ByVal ICustid As Integer, ByVal sSelectedBranches As String, ByVal iYearid As Integer)
        Try
            Dim sSql As String
            Try
                sSql = "select * from Acc_Account_policies Where ACP_Custid= " & ICustid & " And ACP_Branchid RCM_CompID=" & iCompID & ""
                Return objDBL.SQLExecuteDataTable(sAC, sSql)
            Catch ex As Exception
                MsgBox(ex.Message, MsgBoxStyle.Information)
                Throw
            End Try
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadOrgtypeId(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustid As Integer, ByVal iYearID As Integer) As String
        Dim sSql As String
        Dim dt As New DataTable
        Dim sOrgtype As String
        Try
            sSql = "SELECT cmm_Id FROM SAD_CUSTOMER_MASTER LEFT JOIN Content_Management_Master ON Content_Management_Master.cmm_id = SAD_CUSTOMER_MASTER .CUST_ORGTYPEID WHERE SAD_CUSTOMER_MASTER.CUST_ID =" & iCustid & ""
            sOrgtype = objDBL.SQLExecuteScalar(sAC, sSql)
            Return sOrgtype

        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetAccountPoliciesdetails(ByVal sAC As String, ByVal iCompID As Integer, ByVal ICustid As Integer, ByVal sSelectedBranches As String, ByVal iYearid As Integer)
        Try
            Dim sSql As String
            Dim dtDetails As New DataTable
            Dim dt As New DataTable
            Dim dsDetails As New DataSet
            Dim drow As DataRow
            Try
                dtDetails.Columns.Add("SrNo")
                dtDetails.Columns.Add("PKID")
                dtDetails.Columns.Add("ReportType")
                dtDetails.Columns.Add("Heading")
                dtDetails.Columns.Add("ReportID")
                dtDetails.Columns.Add("Description")

                sSql = "select * from SAD_ReportContentMaster Where RCM_ReportId=1 And RCM_CompID=" & iCompID & ""
                dt = objDBL.SQLExecuteDataTable(sAC, sSql)

                For i = 0 To dt.Rows.Count - 1
                    drow = dtDetails.NewRow
                    drow("SrNo") = i + 1
                    drow("PKID") = dt.Rows(i)("RCM_Id")
                    drow("ReportType") = dt.Rows(i)("RCM_ReportName")
                    drow("Heading") = dt.Rows(i)("RCM_Heading")
                    drow("ReportID") = dt.Rows(i)("RCM_ReportId")
                    drow("Description") = dt.Rows(i)("RCM_Description")
                    dtDetails.Rows.Add(drow)
                Next
                Return dtDetails
            Catch ex As Exception
                MsgBox(ex.Message, MsgBoxStyle.Information)
                Throw
            End Try
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadDirector1(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal iCustDirectorPKId As Integer, ByVal sDirandPatnr As String, ByVal sAccPol As String) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim dttab As New DataTable
        Dim dRow As DataRow
        Dim dr As OleDb.OleDbDataReader
        Dim sCity As String = "", sScope As String = ""
        Dim j As Integer = 0
        Dim k As Integer = 0
        Try

            dt.Columns.Add("Name")
            dt.Columns.Add("DIN")


            If sDirandPatnr <> "" Then
                sSql = "Select SSD_Id,SSD_DirectorName,SSD_DOB,SSD_DIN,SSD_MobileNo,SSD_Email,SSD_Remarks,SSD_DelFlag from SAD_Statutory_DirectorDetails where SSD_Id in(" & sDirandPatnr & ") and SSD_CustID=" & iCustId & " and SSD_CompID=" & iACID & ""
            ElseIf sAccPol = "AccPoli" Then
                sSql = "Select SSD_Id,SSD_DirectorName,SSD_DOB,SSD_DIN,SSD_MobileNo,SSD_Email,SSD_Remarks,SSD_DelFlag from SAD_Statutory_DirectorDetails where SSD_CustID=" & iCustId & " and SSD_CompID=" & iACID & ""
            End If
            dttab = objDBL.SQLExecuteDataTable(sAC, sSql)
            dr = objDBL.SQLDataReader(sAC, sSql)
            If dttab.Rows.Count > 0 Then
                For i = 0 To dttab.Rows.Count - 1
                    If i Mod 2 = 0 Then
                        dRow = dt.NewRow()
                        dRow("Name") = dttab(i)("SSD_DirectorName")
                        dt.Rows.Add(dRow)
                        dRow = dt.NewRow()
                        dRow("Name") = "Director"
                        dt.Rows.Add(dRow)
                        dRow = dt.NewRow()
                        dRow("Name") = dttab(i)("SSD_DIN")
                        dt.Rows.Add(dRow)
                        j = j + 3
                    Else
                        dt(k)("DIN") = dttab(i)("SSD_DirectorName")
                        dt(k + 1)("DIN") = "Director"
                        dt(k + 2)("DIN") = dttab(i)("SSD_DIN")
                        k = k + 4
                        dRow = dt.NewRow()
                        dt.Rows.Add(dRow)
                    End If
                Next
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadDirectors(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal iCustDirectorPKId As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim dttab As New DataTable
        Try
            sSql = "Select SSD_Id,SSD_DirectorName from SAD_Statutory_DirectorDetails where SSD_CustID=" & iCustId & " and SSD_CompID=" & iACID & ""
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function


    Public Function LoadCompanydetails(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer) As DataTable
        Dim sSql As String
        Try
            sSql = "select Top 1 Company_Name,Company_Code from Trace_CompanyDetails Where Company_ID=" & iACID & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadPartnars(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal iCustDirectorPKId As Integer) As DataTable
        Dim sSql As String = ""
        Dim dt As New DataTable
        Dim dRow As DataRow
        Dim dr As OleDb.OleDbDataReader
        Dim sCity As String = "", sScope As String = ""
        Try
            dt.Columns.Add("DirectorPkID")
            dt.Columns.Add("Name")
            dt.Columns.Add("DOB")
            dt.Columns.Add("DIN")
            dt.Columns.Add("MobileNo")
            dt.Columns.Add("Email")
            dt.Columns.Add("Remarks")
            dt.Columns.Add("Status")

            sSql = "Select SSD_Id,SSD_DirectorName,SSD_DOB,SSD_DIN,SSD_MobileNo,SSD_Email,SSD_Remarks,SSD_DelFlag from SAD_Statutory_DirectorDetails where SSD_CustID=" & iCustId & " and SSD_CompID=" & iACID & ""

            dr = objDBL.SQLDataReader(sAC, sSql)
            If dr.HasRows Then
                While dr.Read()
                    dRow = dt.NewRow()
                    If IsDBNull(dr("SSD_Id")) = False Then
                        dRow("DirectorPkID") = dr("SSD_Id")
                    End If
                    If IsDBNull(dr("SSD_DirectorName")) = False Then
                        dRow("Name") = dr("SSD_DirectorName")
                    End If
                    If IsDBNull(dr("SSD_DOB")) = False Then
                        dRow("DOB") = objclsGRACeGeneral.FormatDtForRDBMS(dr("SSD_DOB").ToString, "D")
                    End If
                    If IsDBNull(dr("SSD_DIN")) = False Then
                        dRow("DIN") = dr("SSD_DIN")
                    End If
                    If IsDBNull(dr("SSD_MobileNo")) = False Then
                        dRow("MobileNo") = dr("SSD_MobileNo")
                    End If
                    If IsDBNull(dr("SSD_Email")) = False Then
                        dRow("Email") = dr("SSD_Email")
                    End If
                    If IsDBNull(dr("SSD_Remarks")) = False Then
                        dRow("Remarks") = dr("SSD_Remarks")
                    End If
                    dRow("Status") = dr("SSD_DelFlag")
                    dt.Rows.Add(dRow)
                End While
            End If
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function LoadSUbHeading(ByVal sAc As String, ByVal iACID As Integer, ByVal iScheduleid As Integer, ByVal iCustid As Integer) As DataTable
        Dim sSql As String
        Dim dtTab As New DataTable, dt As New DataTable
        Dim dRow As DataRow
        Dim orgTypeId As Integer = 0
        Try
            orgTypeId = getOrgtype(sAc, iACID, iCustid)
            'dtTab.Columns.Add("SubheadingID")
            'dtTab.Columns.Add("SubheadingName")
            sSql = "select ASSH_ID as SubheadingID , ASSH_Name as SubheadingName  from ACC_ScheduleSubHeading where ASSh_Orgtype=" & orgTypeId & " And ASSH_scheduletype=" & iScheduleid & ""
            sSql = sSql & " Order By ASSH_ID"
            dt = objDBL.SQLExecuteDataTable(sAc, sSql)
            Return dt
        Catch ex As Exception
            Throw ex
        End Try
    End Function
    Public Function LoadItems(ByVal sAc As String, ByVal iACID As Integer, ByVal iScheduleid As Integer, ByVal iCustid As Integer) As DataTable
        Dim sSql As String
        Dim dtTab As New DataTable, dt As New DataTable
        Dim dRow As DataRow
        Dim orgTypeId As Integer = 0
        Try
            orgTypeId = getOrgtype(sAc, iACID, iCustid)
            sSql = "select ASI_ID as ItemID, ASI_Name as ItemName from ACC_ScheduleItems where ASi_Orgtype=" & orgTypeId & " And ASi_scheduletype=" & iScheduleid & ""
            sSql = sSql & " Order By Asi_ID"
            dt = objDBL.SQLExecuteDataTable(sAc, sSql)
            'For i = 0 To dt.Rows.Count - 1
            '    dRow = dtTab.NewRow()
            '    dRow("ItemID") = dt.Rows(i)("ASI_ID")
            '    dRow("ItemName") = objGen.ReplaceSafeSQL(dt.Rows(i)("ASI_Name"))
            '    dtTab.Rows.Add(dRow)
            'Next
            Return dt
        Catch ex As Exception
            Throw ex
        End Try
    End Function
    Public Function getOrgtype(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer)
        Dim sSql As String
        Dim OrgtypeId As Integer
        Try
            sSql = "select CUST_ORGTYPEID from SAD_CUSTOMER_MASTER where CUST_ID=" & iCustId & " and CUST_DELFLG= 'A'"
            OrgtypeId = objDBL.SQLExecuteScalarInt(sAC, sSql)
            Return OrgtypeId
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getHeadingID(ByVal sAC As String, ByVal iACID As Integer, ByVal Orgtypeid As Integer, ByVal iSubheading As Integer)
        Dim sSql As String
        Dim iHeadingid As Integer
        Try
            sSql = "select AST_HeadingID from ACC_ScheduleTemplates where AST_Companytype=" & Orgtypeid & " and AST_SubHeadingID=" & iSubheading & ""
            iHeadingid = objDBL.SQLExecuteScalarInt(sAC, sSql)
            Return iHeadingid
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function LoadSubheadingdetais(ByVal sAC As String, ByVal iACID As Integer, ByVal Iyearid As Integer, ByVal iCustId As Integer, ByVal iScheduletypeid As Integer, ByVal iHeadingid As Integer, ByVal iSubheading As Integer, ByVal sSubheading_name As String) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim dTotAmount As Double = 0
        Dim dr As DataRow
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            sSql = "select distinct(b.ATBUD_ID),ATBUD_Description as ATBUD_Description,a.ASSH_ID, a.ASSH_Name as headingname,"
            sSql = sSql & " ISNULL(Sum(ATBU_Closing_TotalCredit_Amount+ATBU_Closing_TotalDebit_Amount),0)  as Total from Acc_TrailBalance_Upload"
            sSql = sSql & " left join Acc_TrailBalance_Upload_Details b on b.ATBUD_Masid  = ATBU_ID   left join ACC_ScheduleSubHeading a on a.ASSH_ID=  b.ATBUD_Subheading"
            sSql = sSql & " where ATBUD_Schedule_type=" & iScheduletypeid & " and ATBUD_CustId=" & iCustId & " and b.atbud_compid = " & iACID & " and b.ATBUD_Headingid=" & iHeadingid & ""
            sSql = sSql & " and b.ATBUD_Subheading=" & iSubheading & " and b.ATBUD_itemid<>0"
            sSql = sSql & " group by ATBUD_ID,ATBUD_Description,ASSH_ID,ASSH_Name order by ATBUD_ID"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            If dt.Rows.Count > 0 Then
                For i = 0 To dt.Rows.Count - 1
                    dr = dtdetails.NewRow
                    dr("Srno") = i = 1
                    dr("Headingname") = dt(i)("ATBUD_Description")
                    dr("HeaderSLNo") = dt(i)("Total")
                    dTotAmount = dTotAmount + dt(i)("Total")
                    dtdetails.Rows.Add(dr)
                Next
            End If
            If sSubheading_name = "(b) Inventories" Or sSubheading_name = "(a) Cost of materials consumed" Then
                sSql = "SELECT Sum(ACSI_Total) As Total, CASE ACSI_classification
WHEN 'FG' THEN 'Finished Goods' WHEN 'RM' THEN 'Raw Materials' Else 'NA'  End  as ACSI_classification FROM ACC_Closingstock_Items where ACSI_Custid=" & iCustId & " And ACSI_YEARId= " & Iyearid & " And ACSI_STATUS='C'  GROUP BY ACSI_classification"
                dt = objDBL.SQLExecuteDataTable(sAC, sSql)
                If dt.Rows.Count > 0 Then
                    For i = 0 To dt.Rows.Count - 1
                        dr = dtdetails.NewRow
                        dr("Srno") = i = 1
                        dr("Headingname") = dt(i)("ACSI_classification")
                        dr("HeaderSLNo") = dt(i)("Total")
                        dTotAmount = dTotAmount + dt(i)("Total")
                        dtdetails.Rows.Add(dr)
                    Next
                End If
            End If
            If dt.Rows.Count > 0 Then
                dr = dtdetails.NewRow
                dr("Srno") = ""
                dr("Headingname") = "<B>" & "Grand Total" & "</B>"
                dr("HeaderSLNo") = "<B>" & Convert.ToDecimal(dTotAmount).ToString("#,##0.00") & "</B>"
                dtdetails.Rows.Add(dr)
            End If
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getJEEntries(ByVal sAC As String, ByVal iACID As Integer, ByVal Iyearid As Integer, ByVal iCustId As Integer, ByVal iScheduletypeid As Integer, ByVal iRepType As Integer) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim dTotCrAmount As Double = 0
        Dim dTotDrAmount As Double = 0
        Dim dr As DataRow
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("Credit")
            dtdetails.Columns.Add("Debit")
            dtdetails.Columns.Add("TranscNo")
            sSql = "select AJTB_ID,AJTB_TranscNo,AJTB_Deschead,ATBUD_Description,Sum(AJTB_Debit+AJTB_Credit) as Total,AJTB_Credit,AJTB_Debit  from Acc_JETransactions_Details"
            sSql = sSql & " left join Acc_TrailBalance_Upload_Details a on  a.ATBUD_ID=AJTB_Deschead"
            sSql = sSql & " where AJTB_CustId=" & iCustId & " and AJTB_CompID = " & iACID & " and AJTB_YearID=" & Iyearid & ""
            sSql = sSql & " group by AJTB_ID,AJTB_Deschead,ATBUD_Description,AJTB_Credit,AJTB_Debit,AJTB_TranscNo order by AJTB_ID"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            If dt.Rows.Count > 0 Then
                For i = 0 To dt.Rows.Count - 1
                    dr = dtdetails.NewRow
                    dr("Srno") = i + 1
                    dr("Headingname") = dt(i)("ATBUD_Description")
                    dr("Credit") = dt(i)("AJTB_Credit")
                    dr("Debit") = dt(i)("AJTB_Debit")
                    dr("TranscNo") = dt(i)("AJTB_TranscNo")
                    dTotCrAmount = dTotCrAmount + dt(i)("AJTB_Credit")
                    dTotDrAmount = dTotCrAmount + dt(i)("AJTB_Debit")
                    dtdetails.Rows.Add(dr)
                Next
            End If
            If dt.Rows.Count > 0 Then
                dr = dtdetails.NewRow
                dr("Srno") = ""
                dr("Headingname") = "<B>" & "Grand Total" & "</B>"
                dr("Credit") = "<B>" & Convert.ToDecimal(dTotCrAmount).ToString("#,##0.00") & "</B>"
                dr("Debit") = "<B>" & Convert.ToDecimal(dTotCrAmount).ToString("#,##0.00") & "</B>"
                dtdetails.Rows.Add(dr)
            End If
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getClosingstock(ByVal sAC As String, ByVal iACID As Integer, ByVal Iyearid As Integer, ByVal iCustId As Integer, ByVal iScheduletypeid As Integer, ByVal iRepType As Integer) As DataTable
        Dim sSql As String : Dim dt, dtdetails As New DataTable
        Dim dTotAmount As Double = 0
        Dim dr As DataRow
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("Classification")
            dtdetails.Columns.Add("Unitprice")
            dtdetails.Columns.Add("Quantity")
            dtdetails.Columns.Add("UOM")
            dtdetails.Columns.Add("Amount")
            sSql = "select ACSI_Itemdesc,ACSI_classification,ACSI_Rate,ACSI_Qty,ACSI_Type,ACSI_Total from ACC_Closingstock_Items "
            sSql = sSql & " where ACSI_Custid=" & iCustId & " and ACSI_CompId = " & iACID & " and ACSI_YEARId=" & Iyearid & ""
            sSql = sSql & " order by ACSI_id"
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            If dt.Rows.Count > 0 Then
                For i = 0 To dt.Rows.Count - 1
                    dr = dtdetails.NewRow
                    dr("Srno") = i + 1
                    dr("Headingname") = dt(i)("ACSI_Itemdesc")
                    dr("Classification") = dt(i)("ACSI_classification")
                    dr("Unitprice") = dt(i)("ACSI_Rate")
                    dr("Quantity") = dt(i)("ACSI_Qty")
                    dr("UOM") = dt(i)("ACSI_Type")
                    dr("Amount") = dt(i)("ACSI_Total")
                    dTotAmount = dTotAmount + dt(i)("ACSI_Total")
                    dtdetails.Rows.Add(dr)
                Next
            End If
            If dt.Rows.Count > 0 Then
                dr = dtdetails.NewRow
                dr("Srno") = ""
                dr("UOM") = "<B>" & "Grand Total" & "</B>"
                dr("Amount") = "<B>" & Convert.ToDecimal(dTotAmount).ToString("#,##0.00") & "</B>"
                dtdetails.Rows.Add(dr)
            End If
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetPandLFinalAmt(ByVal sNameSpace As String, ByVal iYearID As Integer, ByVal iCustomerID As Integer, ByVal iSchedType As Integer, ByVal sBranches As String) As Double
        Dim sSQL As String = ""
        Dim dTotalDieselAmount As String = ""
        Dim dt As New DataTable
        Try
            sSQL = "Select  Acc_PnL_Amount from Acc_ProfitAndLossAmount where Acc_PnL_Custid =" & iCustomerID & " And Acc_PnL_Yearid=" & iYearID & "   and Acc_PnL_BranchId = '" & sBranches & "' "
            dt = objDBL.SQLExecuteDataSet(sNameSpace, sSQL).Tables(0)
            If dt.Rows.Count > 0 Then
                If IsDBNull(dt.Rows(0)("Acc_PnL_Amount").ToString()) = False Then
                    dTotalDieselAmount = Convert.ToDecimal(dt.Rows(0)("Acc_PnL_Amount").ToString()).ToString("#,##0.00")
                Else
                    dTotalDieselAmount = 0.0
                End If
            Else
                dTotalDieselAmount = 0.0
            End If
            If Val(dTotalDieselAmount) = 0 Then
                dTotalDieselAmount = 0.0
            End If
            Return dTotalDieselAmount
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function getCashFlow(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeIdd As Integer, ByVal iRepType As Integer, ByVal iChkPt As Integer) As DataTable
        Dim sSql As String : Dim dtheading, dtdetails, dtdescdetails As New DataTable
        Dim dtitem As New DataTable
        Dim dtsubheading As New DataTable
        Dim dtSubitem As New DataTable
        Dim dr As DataRow
        Dim IdeciTotal As String = ""
        Dim headingTotal As Double = 0
        Dim S1TotalAllHeadings As Double = 0
        Dim S2TotalAllHeadings As Double = 0
        Dim S3TotalAllHeadings As Double = 0
        Dim s4TotalHeadings As Double = 0
        Dim s5TotalHeadings As Double = 0
        Dim PrevheadingTotal As Double = 0
        Dim PrevS1TotalAllHeadings As Double = 0
        Dim PrevS2TotalAllHeadings As Double = 0
        Dim PrevS3TotalAllHeadings As Double = 0
        Dim Prevs4TotalHeadings As Double = 0
        Dim Prevs5TotalHeadings As Double = 0
        Dim tot1 As Double = 0
        Dim tot2 As Double = 0
        Dim Total_FRm_Manufacturing As Double = 0
        Dim Total As Double = 0
        Dim Total3 As Double = 0
        Dim TotalHeading1 As Double = 0
        Dim num As Integer = 0
        Dim TOTalHeading As Double = 0
        Dim TOTalHeadingDb As Double = 0
        Dim TOTalHeadingCr As Double = 0
        Dim CreditTotal As Double = 0
        Dim DebitTotal As Double = 0
        Dim PrevTOTalHeading As Double = 0
        Dim PrevTOTalHeadingDb As Double = 0
        Dim PrevTOTalHeadingCr As Double = 0
        Dim PrevCreditTotal As Double = 0
        Dim PrevDebitTotal As Double = 0
        Dim subCreditTotal As Double = 0
        Dim subDebitTotal As Double = 0
        Dim inc As Integer = 0
        Dim StockEntry As Double = 0
        Dim dPandLamt As Double = 0.0
        Dim dPrevPandLamt As Double = 0.0
        Dim orgTypeId As Integer = 0
        Dim dtHeadschedTemp, dtsubHeadschedTemp, dtsubItemSched As New DataTable
        Dim d5, d6, d7, d8, d9, d10, d11, d12, d13, d14, d15, d16 As String
        Dim pD5, pD6, pD7, pD8, pD9, pD10, pD11, pD12, pD13, pD14, pD15, pD16 As String
        Dim dTotalDifference As Double = 0.0
        Try
            dtdetails.Columns.Add("SrNo")
            dtdetails.Columns.Add("Headingname")
            dtdetails.Columns.Add("HeaderSLNo")
            dtdetails.Columns.Add("SubHeaderSLNo")
            dtdetails.Columns.Add("Notes")
            dtdetails.Columns.Add("PrevyearTotoal")
            dtdetails.Columns.Add("Difference")
            iSchedulrTypeIdd = 4
            orgTypeId = getOrgtype(sAC, iACID, ICustid)
            sSql = "   Select  AST_HeadingID,ASH_Name As headingname FROM ACC_ScheduleTemplates
                           Left Join ACC_ScheduleHeading a on a.ash_id=AST_HeadingID
                           WHERE AST_Schedule_type = 4 And AST_Companytype = " & orgTypeId & " and AST_AccHeadId=1
                           group by AST_HeadingID, ASH_Name "
            dtHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
            If dtHeadschedTemp.Rows.Count > 0 Then
                For x = 0 To dtHeadschedTemp.Rows.Count - 1
                    '  iNote = 1 
                    sSql = "select distinct(ATBUD_Headingid),ASH_Name headingname,  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, "
                    sSql = sSql & " ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal, a.ASH_Notes, "
                    sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, "
                    sSql = sSql & " ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal "
                    sSql = sSql & "  from Acc_TrailBalance_Upload_Details "
                    sSql = sSql & " left join ACC_ScheduleHeading a on a.ASH_ID=  ATBUD_Headingid and a.ASH_Notes=1 "
                    sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid  And d.ATBU_YEARId=" & IyearID & "  "
                    sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & " "
                    sSql = sSql & " where ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_compid = " & iACID & " And ATBUD_CustId=" & ICustid & " and ATBUD_Headingid=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                    sSql = sSql & " and EXISTS(SELECT * FROM ACC_ScheduleTemplates s WHERE s.AST_HeadingID = ATBUD_Headingid AND AST_AccHeadId in (1,2))group by ATBUD_Headingid,ASH_Name,ASH_Notes order by ATBUD_Headingid"
                    dtheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                    If dtheading.Rows.Count > 0 Then
                        For i = 0 To dtheading.Rows.Count - 1
                            If IsDBNull(dtheading(i)("headingname")) = False Then
                                dr = dtdetails.NewRow
                                dr("SrNo") = i + 1
                                dr("Headingname") = "<B>" & dtheading(i)("headingname") & "</B>"
                                If dtheading(i)("CrTotal") > dtheading(i)("DbTotal") Then
                                    TOTalHeading = dtheading(i)("CrTotal") - dtheading(i)("DbTotal")
                                    CreditTotal = CreditTotal + TOTalHeading
                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
                                Else
                                    TOTalHeading = dtheading(i)("DbTotal") - dtheading(i)("CrTotal")
                                    DebitTotal = DebitTotal + TOTalHeading
                                    dr("HeaderSLNo") = Convert.ToDecimal(TOTalHeading).ToString("#,##0.00")
                                End If
                                ' PrevTOtal
                                If dtheading(i)("PrevCrTotal") > dtheading(i)("PrevDbTotal") Then
                                    PrevTOTalHeading = dtheading(i)("PrevCrTotal") - dtheading(i)("PrevDbTotal")
                                    PrevCreditTotal = PrevCreditTotal + PrevTOTalHeading
                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
                                Else
                                    PrevTOTalHeading = dtheading(i)("PrevDbTotal") - dtheading(i)("PrevCrTotal")
                                    PrevDebitTotal = PrevDebitTotal + PrevTOTalHeading
                                    dr("PrevyearTotoal") = Convert.ToDecimal(PrevTOTalHeading).ToString("#,##0.00")
                                End If
                                dtdetails.Rows.Add(dr)
                                S1TotalAllHeadings = headingTotal + TOTalHeading
                                PrevS1TotalAllHeadings = PrevheadingTotal + PrevTOTalHeading
                                sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates
                                               Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID
                                               WHERE AST_Schedule_type = " & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=1 and AST_HeadingID=" & dtheading(i)("ATBUD_Headingid") & "
                                               group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                                dtsubHeadschedTemp = objDBL.SQLExecuteDataTable(sAC, sSql)
                                If dtsubHeadschedTemp.Rows.Count > 0 Then
                                    num = dtdetails.Rows.Count - 1
                                    dtdetails(num)("HeaderSLNo") = ""
                                    dtdetails(num)("PrevyearTotoal") = ""
                                    For y = 0 To dtsubHeadschedTemp.Rows.Count - 1
                                        'Sub Heading
                                        sSql = ""
                                        sSql = " select distinct(ATBUD_Subheading),a.ASSH_Name as headingname, a.AsSh_Notes as Notes,"
                                        sSql = sSql & "  ISNULL(Sum(d.ATBU_Closing_TotalCredit_Amount+0),0)  as CrTotal, ISNULL(Sum(d.ATBU_Closing_TotalDebit_Amount+0),0)  as DbTotal,  "
                                        sSql = sSql & "  ISNULL(Sum(e.ATBU_Closing_TotalCredit_Amount+0),0)  as PrevCrTotal, ISNULL(Sum(e.ATBU_Closing_TotalDebit_Amount+0),0)  as PrevDbTotal,  "
                                        sSql = sSql & "  sum(d.ATBU_Closing_TotalCredit_Amount + d.ATBU_Closing_TotalDebit_Amount) - "
                                        sSql = sSql & "  sum(e.ATBU_Closing_TotalCredit_Amount + e.ATBU_Closing_TotalDebit_Amount) As Diff "
                                        sSql = sSql & " from Acc_TrailBalance_Upload_Details"
                                        sSql = sSql & " left join ACC_ScheduleSubHeading a on a.ASSH_ID= ATBUD_Subheading"
                                        sSql = sSql & " left join Acc_TrailBalance_Upload d on d.ATBU_ID = ATBUD_Masid And d.ATBU_YEARId=" & IyearID & ""
                                        sSql = sSql & " left join Acc_TrailBalance_Upload e on e.ATBU_ID = ATBUD_Masid And e.ATBU_YEARId=" & IyearID - 1 & ""
                                        sSql = sSql & " where    ATBUD_Schedule_type =" & iSchedulrTypeIdd & " and ATBUD_CustId=" & ICustid & " and ATBUD_Subheading= " & dtsubHeadschedTemp(y)("AST_SubHeadingID") & " "
                                        sSql = sSql & " group by ATBUD_Subheading,ASSH_Name,AsSh_Notes order by ATBUD_Subheading"
                                        dtsubheading = objDBL.SQLExecuteDataTable(sAC, sSql)
                                        If dtsubheading.Rows.Count > 0 Then
                                            For j = 0 To dtsubheading.Rows.Count - 1
                                                If IsDBNull(dtsubheading(j)("headingname")) = False Then
                                                    dr = dtdetails.NewRow
                                                    dr("SrNo") = i + 1 & "-" & j + 1
                                                    dr("Notes") = dtsubheading(j)("Notes")
                                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubheading(j)("headingname")
                                                    'Reserves and surplus
                                                    If dtsubheading(j)("headingname") = "(b) Reserves and surplus" Then
                                                        dPandLamt = 0
                                                        dPandLamt = GetPandLFinalAmt(sAC, IyearID, ICustid, 3, "")
                                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                                            subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                                            CreditTotal = CreditTotal + dPandLamt
                                                            subCreditTotal = subCreditTotal + dPandLamt
                                                            dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                                        Else
                                                            subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                                            subDebitTotal = subDebitTotal + dPandLamt
                                                            DebitTotal = DebitTotal + dPandLamt
                                                            If Val(subDebitTotal) = 0 Then
                                                                dr("HeaderSLNo") = 0.00
                                                            Else
                                                                dr("HeaderSLNo") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
                                                            End If
                                                        End If
                                                        dPrevPandLamt = 0
                                                        dPrevPandLamt = GetPandLFinalAmt(sAC, IyearID - 1, ICustid, 3, "")
                                                        If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                                            subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
                                                            subCreditTotal = subCreditTotal + dPrevPandLamt
                                                            PrevCreditTotal = PrevCreditTotal + dPrevPandLamt
                                                            dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                                        Else
                                                            subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
                                                            PrevDebitTotal = PrevDebitTotal + dPrevPandLamt
                                                            If Val(PrevDebitTotal) = 0 Then
                                                                dr("PrevyearTotoal") = 0.00
                                                            Else
                                                                dr("PrevyearTotoal") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
                                                            End If
                                                        End If
                                                    Else
                                                        If dtsubheading(j)("CrTotal") > dtsubheading(j)("DbTotal") Then
                                                            subCreditTotal = dtsubheading(j)("CrTotal") - dtsubheading(j)("DbTotal")
                                                            dr("HeaderSLNo") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                                        Else
                                                            subDebitTotal = dtsubheading(j)("DbTotal") - dtsubheading(j)("CrTotal")
                                                            If subDebitTotal = 0 Then
                                                            End If
                                                            dr("HeaderSLNo") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
                                                        End If
                                                        If dtsubheading(j)("PrevCrTotal") > dtsubheading(j)("PrevDbTotal") Then
                                                            subCreditTotal = dtsubheading(j)("PrevCrTotal") - dtsubheading(j)("PrevDbTotal")
                                                            dr("PrevyearTotoal") = Convert.ToDecimal(subCreditTotal).ToString("#,##0.00")
                                                        Else
                                                            subDebitTotal = dtsubheading(j)("PrevDbTotal") - dtsubheading(j)("PrevCrTotal")
                                                            dr("PrevyearTotoal") = "(" & Convert.ToDecimal(subDebitTotal).ToString("#,##0.00") & ")"
                                                        End If
                                                    End If
                                                    dr("Difference") = dtsubheading(j)("Diff")
                                                    dTotalDifference = dTotalDifference + dtsubheading(j)("Diff")
                                                    dtdetails.Rows.Add(dr)
                                                End If
                                            Next
                                        Else
                                            dr = dtdetails.NewRow
                                            dr("SrNo") = ""
                                            dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubHeadschedTemp(y)("headingname")
                                            dr("Notes") = dtsubHeadschedTemp(y)("Notes")
                                            dr("HeaderSLNo") = "-"
                                            dr("PrevyearTotoal") = "-"
                                            dtdetails.Rows.Add(dr)
                                        End If
                                    Next
                                Else
                                End If
                            End If
                        Next
                        dr = dtdetails.NewRow
                        dr("Srno") = ""
                        dr("Headingname") = "<B>" & "Total" & "</B>"
                        If CreditTotal > DebitTotal Then
                            S1TotalAllHeadings = CreditTotal - DebitTotal
                            dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
                        Else
                            S1TotalAllHeadings = CreditTotal - DebitTotal
                            dr("HeaderSLNo") = Convert.ToDecimal(S1TotalAllHeadings).ToString("#,##0.00")
                        End If
                        If PrevCreditTotal > PrevDebitTotal Then
                            PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
                        Else
                            PrevS1TotalAllHeadings = PrevCreditTotal - PrevDebitTotal
                            dr("PrevyearTotoal") = Convert.ToDecimal(PrevS1TotalAllHeadings).ToString("#,##0.00")
                        End If
                        dr("Difference") = dTotalDifference
                        s4TotalHeadings = s4TotalHeadings + S1TotalAllHeadings
                        Prevs4TotalHeadings = Prevs4TotalHeadings + PrevS1TotalAllHeadings
                        dtdetails.Rows.Add(dr)
                        CreditTotal = 0 : DebitTotal = 0
                        PrevCreditTotal = 0 : PrevDebitTotal = 0
                        dTotalDifference = 0.0
                    Else
                        dr = dtdetails.NewRow
                        dr("SrNo") = ""
                        dr("Headingname") = "<B>" & dtHeadschedTemp(x)("headingname") & "</B>"
                        dr("HeaderSLNo") = ""
                        dr("PrevyearTotoal") = ""
                        dtdetails.Rows.Add(dr)
                        sSql = "   Select  AST_SubHeadingID,AsSH_Name as headingname,ASSH_Notes as Notes FROM ACC_ScheduleTemplates "
                        sSql = sSql & "                   Left Join ACC_ScheduleSubHeading a on a.assh_id=AST_subHeadingID "
                        sSql = sSql & "                  WHERE AST_Schedule_type  =" & iSchedulrTypeIdd & " And AST_Companytype =" & orgTypeId & "and AST_AccHeadId=1 and AST_HeadingID=" & dtHeadschedTemp(x)("AST_HeadingID") & " "
                        sSql = sSql & "                   group by AST_SubHeadingID, ASsH_Name,ASSH_Notes  "
                        dtsubItemSched = objDBL.SQLExecuteDataTable(sAC, sSql)
                        If dtsubItemSched.Rows.Count > 0 Then
                            For m = 0 To dtsubItemSched.Rows.Count - 1
                                If IsDBNull(dtsubItemSched(m)("headingname")) = False Then
                                    dr = dtdetails.NewRow
                                    dr("Headingname") = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" & dtsubItemSched(m)("headingname")
                                    If dtsubItemSched(m)("Notes") = 0 Then
                                        dr("Notes") = dtsubItemSched(m)("Notes")
                                    Else
                                        dr("Notes") = "-"
                                    End If
                                    dtdetails(num)("HeaderSLNo") = "-"
                                    dtdetails(num)("PrevyearTotoal") = "-"
                                    dtdetails.Rows.Add(dr)
                                End If
                            Next
                        End If
                    End If
                Next
            End If
            dr = dtdetails.NewRow
            dtdetails.Rows.Add(dr)
            Return dtdetails
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function getPnl() As String
        Dim sSql As String = ""
        Dim Imaxid As Integer = 0
        Dim dt As New DataTable
        Try
            If sPandLAmount <> "" Then
                Return sPandLAmount
            Else
                Return ""
            End If

        Catch ex As Exception
            Throw ex
        End Try
    End Function
    Public Function UpdatePnL(ByVal sAc As String, ByVal iACID As Integer, ByVal sPnlamount As String, ByVal iCustid As Integer, ByVal iUserid As Integer, ByVal iYearid As Integer, ByVal sBranches As String) As Boolean
        Dim sSql As String = ""
        Dim Imaxid As Integer = 0
        Dim dt As New DataTable
        Try
            sSql = ""
            If sPnlamount <> "" Then
                sSql = " select  Acc_PnL_Pkid from Acc_ProfitAndLossAmount where Acc_PnL_Custid =" & iCustid & " and Acc_PnL_Yearid=" & iYearid & " and Acc_PnL_BranchId = '" & sBranches & "' "
                dt = objDBL.SQLExecuteDataSet(sAc, sSql).Tables(0)
                If dt.Rows.Count > 0 Then
                    sSql = " Update Acc_ProfitAndLossAmount set Acc_PnL_Amount='" & sPnlamount & "' where Acc_PnL_Pkid = " & dt(0)("Acc_PnL_Pkid") & " "
                    objDBL.SQLExecuteNonQuery(sAc, sSql)
                Else
                    sSql = "select count(acc_pnl_pkid)+1 from Acc_ProfitAndLossAmount "
                    Imaxid = objDBL.SQLExecuteScalarInt(sAc, sSql)
                    sSql = "" : sSql = "Insert into Acc_ProfitAndLossAmount(Acc_PnL_Pkid,Acc_PnL_Custid,Acc_PnL_Amount,Acc_PnL_CrBy,Acc_PnL_CrOn,Acc_PnL_Flag,Acc_PnL_Yearid,Acc_PnL_BranchId)"
                    sSql = sSql & " Values(" & Imaxid & "," & iCustid & ",'" & sPnlamount & "'," & iUserid & ","
                    sSql = sSql & "GETDATE()," & 1 & "," & iYearid & ",'" & sBranches & "')"
                    objDBL.SQLExecuteNonQuery(sAc, sSql)
                End If
            Else
                Return False
            End If

        Catch ex As Exception
            Throw ex
        End Try
    End Function
    Public Function LoadBranches(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal iYearID As Integer)
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "select Mas_Id as Branchid,Mas_Description as BranchName from SAD_CUST_LOCATION where Mas_CustID=" & iCustId & " and Mas_CompID=" & iACID & ""
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function

    Public Function GetCustomerAmountType(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer)
        Dim sSql As String
        Try
            sSql = "Select isnull (CUST_Amount_Type,0) as CUST_Amount_Type, isnull(CUST_RoundOff,0) as CUST_RoundOff from SAD_CUSTOMER_MASTER Where CUST_ID=" & iCustId & " and cust_Compid=" & iACID & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try

    End Function
    Public Function getCustfontstyle(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal iYearID As Integer)
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "select isnull(b.CF_ID,0) as CF_ID,isnull(b.CF_name,'') as CF_name,isnull(CUST_rptBorder,'') as CUST_rptBorder from SAD_CUSTOMER_MASTER "
            sSql = sSql & " left join Cust_fontstyle b on b.CF_ID=Cust_fontstyleid"
            sSql = sSql & " where CUST_ID=" & iCustId & " and CUST_CompID=" & iACID & ""
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            If dt(0)("CF_ID") = 0 Then
                Return dt
            Else
                Return dt
            End If
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetLOEReportForCustAuditType(ByVal sAC As String, ByVal iACID As Integer, ByVal iFYID As Integer, ByVal iCustId As Integer, ByVal iTaskId As Integer) As DataTable
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "Select CUST_NAME,LOE_Name,cmm_Desc,YMS_ID,ISNULL(LOE_ProfessionalFees,'') LOE_ProfessionalFees,ISNULL(LOET_StdsInternalAudit,'') LOET_StdsInternalAudit,ISNULL(LOET_General,'') LOET_General,"
            sSql = sSql & " ISNULL(LOET_Responsibilities,'') LOET_Responsibilities,ISNULL(LOET_Infrastructure,'') LOET_Infrastructure,ISNULL(LOET_NDA,'') LOET_NDA,ISNULL(LOET_Deliverable,'') LOET_Deliverable From SAD_CUST_LOE"
            sSql = sSql & " Left Join SAD_CUSTOMER_MASTER On CUST_ID=LOE_CustomerId"
            sSql = sSql & " Left Join LOE_Template On LOET_CustomerId=LOE_CustomerId and LOET_FunctionId=LOE_FunctionId"
            sSql = sSql & " Left Join Content_Management_Master On cmm_ID=LOE_FunctionId"
            sSql = sSql & " Left Join Year_Master On YMS_YEARID=LOE_YearId"
            sSql = sSql & " Where LOE_YearId=" & iFYID & " And LOE_CustomerId=" & iCustId & " And LOE_FunctionId=" & iTaskId & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetCustReportForCustAuditType(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer) As DataTable
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "Select CUST_NAME,cmm_Desc,CUST_CommitmentDate,CDET_PRODUCTSMANUFACTURED From SAD_CUSTOMER_MASTER"
            sSql = sSql & " Left Join SAD_CUSTOMER_DETAILS On CDET_CUSTID=CUST_ID"
            sSql = sSql & " Left Join Content_Management_Master On cmm_ID=CUST_ORGTYPEID"
            sSql = sSql & " Where CUST_ID=" & iCustId & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetConductAuditReportForCustAuditType(ByVal sAC As String, ByVal iACID As Integer, ByVal iFYID As Integer, ByVal iCustId As Integer, ByVal iTaskId As Integer) As DataTable
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "Select SA_ID,SA_AuditNo + ' - ' + CMM_Desc As SA_AuditNo,cmm_Desc From StandardAudit_Schedule"
            sSql = sSql & " Left Join Content_Management_Master On cmm_ID=SA_AuditTypeID"
            sSql = sSql & " Where SA_CustID=" & iCustId & " And SA_YearID=" & iFYID & " And SA_AuditTypeID=" & iTaskId & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetCheckPointIDFromAuditId(ByVal sAC As String, ByVal iACID As Integer, ByVal iAuditId As Integer) As DataTable
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "Select SAC_CheckPointID From StandardAudit_ScheduleCheckPointList Where SAC_SA_ID=" & iAuditId & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetConductAuditReportForCustAuditId(ByVal sAC As String, ByVal iACID As Integer, ByVal iFYID As Integer, ByVal iCustId As Integer, ByVal iAuditId As Integer) As DataTable
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "Select SA_ID,SA_AuditNo + ' - ' + CMM_Desc As SA_AuditNo,cmm_Desc From StandardAudit_Schedule"
            sSql = sSql & " Left Join Content_Management_Master On cmm_ID=SA_AuditTypeID"
            sSql = sSql & " Where SA_CustID=" & iCustId & " And SA_YearID=" & iFYID & " And SA_ID=" & iAuditId & ""
            Return objDBL.SQLExecuteDataTable(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
    'Public Function LoadSubheading(ByVal sAC As String, ByVal iACID As Integer, ByVal IyearID As Integer, ByVal ICustid As Integer, ByVal iSchedulrTypeId As Integer) As DataTable
    '    Dim sSql As String = ""
    '    Dim dt As New DataTable
    '    Try
    '        sSql = " select ROW_NUMBER() OVER (ORDER BY ATBUd_ID ASC) AS SrNo,ATBUD_Description As Description from  Acc_TrailBalance_Upload_Details"
    '        sSql = sSql & " Where ATBUD_CustId=" & ICustid & " and ATBUD_YEARId=" & IyearID & ""
    '        sSql = sSql & " And ATBUD_Headingid=0 And ATBUD_Subheading=0 And ATBUD_itemid=0 And ATBUD_SubItemId=0"
    '        dt = objDBL.SQLExecuteDataTable(sAC, sSql)
    '        Return dt
    '    Catch ex As Exception
    '        Throw
    '    End Try
    'End Function
    Public Function getCustPartnerDet(ByVal sAC As String, ByVal iACID As Integer, ByVal iCustId As Integer, ByVal sPartnerName As String)
        Dim sSql As String
        Dim dt As New DataTable
        Try
            sSql = "Select SSP_Id,SSP_PartnerName,SSP_PAN,SSP_DOJ,IsNull(SSP_ShareOfProfit,0) As SSP_ShareOfProfit,IsNull(SSP_CapitalAmount,0) As SSP_CapitalAmount,SSP_DelFlag from SAD_Statutory_PartnerDetails where SSP_CustID=" & iCustId & " and SSP_CompID=" & iACID & " and  SSP_PartnerName='" & sPartnerName & "' "
            dt = objDBL.SQLExecuteDataTable(sAC, sSql)
            Return dt
        Catch ex As Exception
            Throw
        End Try
    End Function
    Public Function GetDefalutCompanyDetails(ByVal sAC As String, ByVal iACID As Integer) As Integer
        Dim sSql As String
        Try
            sSql = "Select isnull(Company_ID,0)As Company_ID from TRACe_CompanyDetails Where Company_CompID=" & iACID & " "
            Return objDBL.SQLExecuteScalarInt(sAC, sSql)
        Catch ex As Exception
            Throw
        End Try
    End Function
End Class
